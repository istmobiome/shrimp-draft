<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="description" content="Workflow for processing 16S rRNA samples for OTU analysis using mothur. Workflow uses paired end reads, beginning with raw fastq files, ending with sequence and taxonomy tables. A Microtable Object is produced to collate the data for downstream analysis.">
<title>4. OTU Workflow – TransIsthmian Shrimp</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../workflows/ssu/med/index.html" rel="next">
<link href="../../../workflows/ssu/dada2/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-listing/list.min.js"></script>
<script src="../../../site_libs/quarto-listing/quarto-listing.js"></script>
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-707d8167ce6003fca903bfe2be84ab7f.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-e6bd33826d752a752b088f17960ea970.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-d7d32a8442357cea8cf74a4a848b80d6.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-e6bd33826d752a752b088f17960ea970.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script>

  window.document.addEventListener("DOMContentLoaded", function (_event) {
    const listingTargetEl = window.document.querySelector('#listing-otu-listing .list');
    if (!listingTargetEl) {
      // No listing discovered, do not attach.
      return; 
    }

    const options = {
      valueNames: ['listing-filename','listing-description',{ data: ['index'] },{ data: ['categories'] },{ data: ['listing-filename-sort'] }],
      
      searchColumns: ["listing-filename","listing-description"],
    };

    window['quarto-listings'] = window['quarto-listings'] || {};
    window['quarto-listings']['listing-otu-listing'] = new List('listing-otu-listing', options);

    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  });

  window.addEventListener('hashchange',() => {
    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  })
  </script><script src="../../../site_libs/quarto-diagram/mermaid.min.js"></script><script src="../../../site_libs/quarto-diagram/mermaid-init.js"></script><link href="../../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="../../../assets/css/styles.css">
</head>
<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../images/icon.png" alt="Istmobiome logo." class="navbar-logo light-content"><img src="../../../images/icon.png" alt="Istmobiome logo." class="navbar-logo dark-content"></a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link active" href="../../../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../workflows/portal/index.html"> 
<span class="menu-text">Data Portal</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../workflows/ssu/index.html"> 
<span class="menu-text">16S rRNA</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../workflows/mg/index.html"> 
<span class="menu-text">Metagenomics</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../workflows/pub/index.html"> 
<span class="menu-text">Paper</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/istmobiome/trans-shrimp/"> <i class="bi bi-github" role="img" aria-label="Trans Shrimp">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../workflows/ssu/index.html">16S rRNA</a></li><li class="breadcrumb-item"><a href="../../../workflows/ssu/otu/index.html">4. OTU Workflow</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../workflows/ssu/index.html">16S rRNA</a></li><li class="breadcrumb-item"><a href="../../../workflows/ssu/otu/index.html">4. OTU Workflow</a></li></ol></nav>
      <div class="quarto-title-block"><div><h1 class="title">4. OTU Workflow</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i></button></div></div>
                  <div>
        <div class="description">
          <p>Workflow for processing 16S rRNA samples for OTU analysis using mothur. Workflow uses paired end reads, beginning with raw fastq files, ending with sequence and taxonomy tables. A Microtable Object is produced to collate the data for downstream analysis.</p>
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../../index.html" class="sidebar-logo-link">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../workflows/portal/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Portal</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../workflows/ssu/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">16S rRNA</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../workflows/ssu/sampledata/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Sample Metadata</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../workflows/ssu/dada2/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. DADA2 ASV Workflow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../workflows/ssu/otu/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">4. OTU Workflow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../workflows/ssu/med/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. MED Workflow</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../workflows/mg/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Metagenomics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../workflows/mg/setup/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Build Databases</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../workflows/mg/assembly/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Co-Assembly &amp; Annotations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../workflows/mg/aa-results/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Assembly &amp; Annotation Results</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../workflows/pub/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Publication Material</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../workflows/pub/references/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Workflow References</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../workflows/pub/archive_data/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Submitting &amp; Archiving Data/Code</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="1"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#workflow-input" id="toc-workflow-input" class="nav-link active" data-scroll-target="#workflow-input">Workflow Input</a></li>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li>
<a href="#read-processing" id="toc-read-processing" class="nav-link" data-scroll-target="#read-processing">Read Processing</a>
  <ul class="collapse">
<li><a href="#getting-started" id="toc-getting-started" class="nav-link" data-scroll-target="#getting-started">Getting Started</a></li>
  <li><a href="#reducing-sequencing-pcr-errors" id="toc-reducing-sequencing-pcr-errors" class="nav-link" data-scroll-target="#reducing-sequencing-pcr-errors">Reducing Sequencing &amp; PCR Errors</a></li>
  <li><a href="#processing-improved-reads" id="toc-processing-improved-reads" class="nav-link" data-scroll-target="#processing-improved-reads">Processing Improved Reads</a></li>
  <li><a href="#aligning-reads" id="toc-aligning-reads" class="nav-link" data-scroll-target="#aligning-reads">Aligning Reads</a></li>
  <li><a href="#precluster" id="toc-precluster" class="nav-link" data-scroll-target="#precluster">Precluster</a></li>
  <li><a href="#remove-negative-controls" id="toc-remove-negative-controls" class="nav-link" data-scroll-target="#remove-negative-controls">Remove Negative Controls</a></li>
  <li><a href="#remove-chimeras" id="toc-remove-chimeras" class="nav-link" data-scroll-target="#remove-chimeras">Remove Chimeras</a></li>
  <li>
<a href="#assign-taxonomy" id="toc-assign-taxonomy" class="nav-link" data-scroll-target="#assign-taxonomy">Assign Taxonomy</a>
  <ul class="collapse">
<li><a href="#make-a-custom-db" id="toc-make-a-custom-db" class="nav-link" data-scroll-target="#make-a-custom-db">Make a custom DB</a></li>
  </ul>
</li>
  <li><a href="#remove-contaminants" id="toc-remove-contaminants" class="nav-link" data-scroll-target="#remove-contaminants">Remove Contaminants</a></li>
  <li><a href="#track-reads-through-workflow" id="toc-track-reads-through-workflow" class="nav-link" data-scroll-target="#track-reads-through-workflow">Track Reads through Workflow</a></li>
  <li><a href="#preparing-for-analysis" id="toc-preparing-for-analysis" class="nav-link" data-scroll-target="#preparing-for-analysis">Preparing for analysis</a></li>
  <li><a href="#clustering" id="toc-clustering" class="nav-link" data-scroll-target="#clustering">Clustering</a></li>
  </ul>
</li>
  <li>
<a href="#dataset-prep" id="toc-dataset-prep" class="nav-link" data-scroll-target="#dataset-prep">Dataset Prep</a>
  <ul class="collapse">
<li><a href="#getting-files-from-mothur" id="toc-getting-files-from-mothur" class="nav-link" data-scroll-target="#getting-files-from-mothur">Getting Files from Mothur</a></li>
  <li>
<a href="#prep-data-for-microeco" id="toc-prep-data-for-microeco" class="nav-link" data-scroll-target="#prep-data-for-microeco">Prep Data for <code>microeco</code></a>
  <ul class="collapse">
<li><a href="#a.-taxonomy-table" id="toc-a.-taxonomy-table" class="nav-link" data-scroll-target="#a.-taxonomy-table">A. Taxonomy Table</a></li>
  <li><a href="#b.-sequence-table" id="toc-b.-sequence-table" class="nav-link" data-scroll-target="#b.-sequence-table">B. Sequence Table</a></li>
  <li><a href="#c.-sample-table" id="toc-c.-sample-table" class="nav-link" data-scroll-target="#c.-sample-table">C. Sample Table</a></li>
  </ul>
</li>
  <li>
<a href="#experiment-level-objects" id="toc-experiment-level-objects" class="nav-link" data-scroll-target="#experiment-level-objects">Experiment-level Objects</a>
  <ul class="collapse">
<li><a href="#d.-add-representative-sequence" id="toc-d.-add-representative-sequence" class="nav-link" data-scroll-target="#d.-add-representative-sequence">D. Add Representative Sequence</a></li>
  </ul>
</li>
  <li>
<a href="#curate-the-data-set" id="toc-curate-the-data-set" class="nav-link" data-scroll-target="#curate-the-data-set">Curate the Data Set</a>
  <ul class="collapse">
<li><a href="#remove-low-count-samples" id="toc-remove-low-count-samples" class="nav-link" data-scroll-target="#remove-low-count-samples">Remove Low-Count Samples</a></li>
  </ul>
</li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
</li>
  <li><a href="#download-results" id="toc-download-results" class="nav-link" data-scroll-target="#download-results">Download Results</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/istmobiome/trans-shrimp/blob/main/workflows/ssu/otu/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/istmobiome/trans-shrimp/edit/main/workflows/ssu/otu/index.qmd" target="_blank" class="toc-action"><i class="bi empty"></i>Edit this page</a></li><li><a href="https://github.com/istmobiome/trans-shrimp/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content"><section id="workflow-input" class="level2"><h2 class="anchored" data-anchor-id="workflow-input">Workflow Input</h2>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Data &amp; Scripts
</div>
</div>
<div class="callout-body-container callout-body">
<p>Fastq sequence files, scripts, and other assets for running this workflow can be found on the <a href="../../../workflows/portal/data-otu.html">OTU Data Portal</a> page.</p>
<p>The Data Portal page also contains a link to the curated output of this pipeline–-feature-sample count table, taxonomy table, sample metadata, &amp; representative fasta sequences. Data is available as stand-alone text files, OR bundled in microtable and phyloseq objects. Archive also includes a table tracking sample read changes.</p>
</div>
</div>
<section id="required-packages-software" class="level4"><h4 class="anchored" data-anchor-id="required-packages-software">Required Packages &amp; Software</h4>
<p>To run this workflow you need to have <a href="https://mothur.org/wiki/installation/">mothur installed</a> and you will need the <a href="https://www.tidyverse.org">tidyverse</a> package.</p>
</section></section><section id="overview" class="level2"><h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This is a standard pipeline for generating OTUs using <a href="https://mothur.org/">mothur</a><span class="citation" data-cites="schloss2009mothur">(<a href="#ref-schloss2009mothur" role="doc-biblioref">Schloss et al. 2009</a>)</span>. We generally followed the mothur <a href="https://mothur.org/wiki/miseq_sop/">MiSeq SOP</a> when building this pipeline. Since this SOP is heavily annotated we will keep our comments here to a minimum.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-eval="true" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"></figure><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TB
  A(&lt;b&gt;&lt;a href='https://mothur.org/wiki/make.file/'&gt;make.file&lt;/a&gt;&lt;/b&gt;) --&gt; B(&lt;b&gt;&lt;a href='https://mothur.org/wiki/make.contigs/'&gt;make.contigs&lt;/a&gt;&lt;/b&gt;)
  B --&gt; C(&lt;b&gt;&lt;b&gt;&lt;a href='https://mothur.org/wiki/screen.seqs/'&gt;screen.seqs&lt;/a&gt;&lt;/b&gt;&lt;br/&gt;&lt;a href='https://mothur.org/wiki/unique.seqs/'&gt;unique.seqs&lt;/a&gt;&lt;/b&gt;)
  C --&gt; E(&lt;b&gt;&lt;a href='https://mothur.org/wiki/align.seqs/'&gt;align.seqs&lt;/a&gt;&lt;/b&gt;)
  L(reference db&lt;br/&gt; e.g. silva seed) --&gt; F
  F(&lt;b&gt;&lt;a href='https://mothur.org/wiki/pcr.seqs/'&gt;pcr.seqs&lt;/a&gt;&lt;/b&gt;&lt;/br&gt;trim ref db&lt;/br&gt;to V4 region) --&gt; E
  E --&gt; I(&lt;b&gt;&lt;a href='https://mothur.org/wiki/screen.seqs/'&gt;screen.seqs&lt;/a&gt;&lt;br/&gt;&lt;a href='https://mothur.org/wiki/filter.seqs/'&gt;filter.seqs&lt;/a&gt;&lt;br/&gt;&lt;a href='https://mothur.org/wiki/unique.seqs/'&gt;unique.seqs&lt;/a&gt;&lt;/b&gt;)
  I --&gt; K[Pass to MED]
  I --&gt; J(&lt;b&gt;&lt;a href='https://mothur.org/wiki/pre.cluster/'&gt;pre.cluster&lt;/a&gt;&lt;/b&gt;)
  J --&gt; M(remove&lt;/br&gt;negative controls)
</pre>
</div>
<p></p>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-eval="true" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"></figure><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TB
  L("&lt;b&gt;&lt;a href='https://mothur.org/wiki/get.groups/'&gt;get.groups&lt;/a&gt;&lt;/b&gt;&lt;br/&gt;(NC Samples)")
  L --&gt; M(&lt;b&gt;&lt;a href='https://mothur.org/wiki/remove.seqs/'&gt;remove.seqs&lt;/a&gt;&lt;/b&gt;)
  L --&gt; N(&lt;b&gt;&lt;a href='https://mothur.org/wiki/remove.groups/'&gt;remove.groups&lt;/a&gt;&lt;/b&gt;)
  M --&gt; O(&lt;b&gt;&lt;a href='https://mothur.org/wiki/chimera.vsearch/'&gt;chimera.vsearch&lt;/a&gt;&lt;/b&gt;)
  N --&gt; O
  O --&gt; P(&lt;b&gt;&lt;a href='https://mothur.org/wiki/classify.seqs/'&gt;classify.seqs&lt;/a&gt;&lt;/b&gt;)
  P --&gt; Q(&lt;b&gt;&lt;a href='https://mothur.org/wiki/remove.lineage/'&gt;remove.lineage&lt;/a&gt;&lt;/b&gt;)
  Q --&gt; R(&lt;b&gt;&lt;a href='https://mothur.org/wiki/cluster.split/'&gt;cluster.split&lt;/a&gt;&lt;/b&gt;)
  Q --&gt; S(&lt;b&gt;&lt;a href='https://mothur.org/wiki/dist.seqs/'&gt;dist.seqs&lt;/a&gt;&lt;/b&gt;)

title[Remove&lt;br/&gt;Negative&lt;br/&gt;Controls]
style title stroke:#333,stroke-width:0px,mermaid-font-size:2.8rem
</pre>
</div>
<p></p>
</div>
</div>
</div>
</div>
</div>
</section><section id="read-processing" class="level1"><h1>Read Processing</h1>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Expand to see environment variables
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We are running mothur in <a href="https://mothur.org/wiki/batch_mode/">Batch Mode</a> and using Environment Variables to generalize the batch commands for reuse. The format of environmental variables is <code>[tag]=[value]</code>. mothur will automatically pull in the systems environment variable, which we can set in bash and then run the batch file:</p>
<pre><code>$ export DATA=01_TRIMMED_DATA/
$ export TYPE=gz
$ export PROC=30

$ export REF_LOC=reference_dbs
$ export TAXREF_FASTA=gsrdb.fasta
$ export TAXREF_TAX=gsrdb.tax
$ export ALIGNREF=silva.v4.fasta

$ export CONTAMINENTS=Chloroplast-Mitochondria-unknown-Eukaryota</code></pre>
</div>
</div>
</div>
<section id="getting-started" class="level2"><h2 class="anchored" data-anchor-id="getting-started">Getting Started</h2>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Expand for the MOTHUR batchfile
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<pre><code>########################################################################
#$ export DATA=01_TRIMMED_DATA/
#$ export TYPE=gz
#$ export PROC=30

#$ export REF_LOC=reference_dbs
#$ export TAXREF_FASTA=gsrdb.fasta
#$ export TAXREF_TAX=gsrdb.tax
#$ export ALIGNREF=silva.v4.fasta

#$ export CONTAMINENTS=Chloroplast-Mitochondria-unknown-Eukaryota
########################################################################
set.dir(output=pipelineFiles/)
make.file(inputdir=$DATA/, type=$TYPE, prefix=shrimp)
########################################################################
#### had to fix shimp.files bc mothur splits name at first underscore (_)
########################################################################
make.contigs(file=shrimp.files, processors=$PROC)
summary.seqs(fasta=shrimp.trim.contigs.fasta, count=shrimp.contigs.count_table, processors=$PROC)
count.groups(count=shrimp.contigs.count_table)
screen.seqs(fasta=current, count=current, maxambig=0, minlength=252, maxlength=254, maxhomop=6, processors=$PROC)
summary.seqs(fasta=current, count=current, processors=$PROC)
count.groups(count=current)
unique.seqs(fasta=current, count=current)
summary.seqs(count=current, processors=$PROC)
########################################################################
#### Aligning reads
########################################################################
# https://mothur.org/wiki/silva_reference_files/
#### Prep reference file
pcr.seqs(fasta=$REF_LOC/silva.seed_v138_2.align, start=13862, end=23445, keepdots=F, processors=$PROC)
rename.file(input=pipelineFiles/silva.seed_v138_2.pcr.align, new=pipelineFiles/$ALIGNREF)
summary.seqs(fasta=pipelineFiles/$ALIGNREF, processors=$PROC)
#### Align reads
align.seqs(fasta=shrimp.trim.contigs.good.unique.fasta, reference=pipelineFiles/$ALIGNREF, processors=$PROC)
summary.seqs(fasta=shrimp.trim.contigs.good.unique.align, count=shrimp.trim.contigs.good.count_table, processors=$PROC)
########################################################################
#### Further processing
########################################################################
screen.seqs(fasta=current, count=current, start=1, end=9583, processors=$PROC)
summary.seqs(fasta=current, count=current, processors=$PROC)
count.groups(count=current)
filter.seqs(fasta=current, vertical=T, trump=., processors=$PROC)
unique.seqs(fasta=current, count=current)
summary.seqs(fasta=current, count=current, processors=$PROC)
########################################################################
#### Copy files FOR MED
########################################################################
system(cp pipelineFiles/shrimp.trim.contigs.good.unique.good.filter.unique.fasta pipelineFiles_med/)
system(cp pipelineFiles/shrimp.trim.contigs.good.unique.good.filter.count_table pipelineFiles_med/)
########################################################################
#### Proceed with mothur workflow
########################################################################
pre.cluster(fasta=current, count=current, diffs=2, processors=$PROC)
summary.seqs(fasta=current, count=current, processors=$PROC)
count.groups(count=current)
########################################################################
#### Remove Negative Control samples (files generated in R)
########################################################################

########## IN R ########################################################
#tmp_accnos &lt;- readr::read_delim(here(med_here, "nc_screen/shrimp.files"), delim = "\t", col_names = FALSE)
#tmp_accnos[, 2:3] &lt;- NULL
#tmp_accnos &lt;- tmp_accnos[grepl("Control_", tmp_accnos$X1), ]
#readr::write_delim(tmp_accnos, file = here(med_here, "nc_screen/nc_samples.accnos"), col_names = FALSE)
########################################################################
get.groups(fasta=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.fasta, count=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.count_table, accnos=nc_samples.accnos)
rename.file(input=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.fasta, new=nc.fasta)
rename.file(input=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.count_table, new=nc.count_table)
summary.seqs(fasta=nc.fasta, count=nc.count_table, processors=$PROC)
list.seqs(count=nc.count_table)
count.seqs(count=nc.count_table, compress=f)
get.seqs(accnos=nc.accnos, fasta=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.fasta, count=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.count_table)
rename.file(input=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.fasta, new=subset.fasta)
rename.file(input=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.count_table, new=subset.count_table)
count.seqs(count=subset.count_table, compress=f)
########################################################################
########## IN R ########################################################
########################################################################
#full_count_tab &lt;- readr::read_delim(here(med_here, "nc_screen/subset.full.count_table"), delim = "\t", col_names = TRUE)
#control_cols     &lt;- grep("^Control_", names(full_count_tab), value = TRUE)
#noncontrol_cols  &lt;- setdiff(names(full_count_tab)[-(1:2)], control_cols)
## now do the rowwise sums
#read_totals &lt;- full_count_tab %&gt;%
#  rowwise() %&gt;%
#  mutate(
#    total_reads_nc   = sum(c_across(all_of(control_cols)), na.rm = TRUE),
#    total_reads_non_nc = sum(c_across(all_of(noncontrol_cols)), na.rm = TRUE)
#  ) %&gt;%
#  ungroup() %&gt;%
#  select(1, 2, total_reads_nc, total_reads_non_nc)
#
#read_totals &lt;- read_totals %&gt;% dplyr::rename("total_reads" = 2)
#tmp_read_totals &lt;- read_totals %&gt;% dplyr::mutate(perc_reads_in_nc = 100*(total_reads_nc / (total_reads_nc + total_reads_non_nc)), .after = "total_reads_non_nc")
#tmp_read_totals$perc_reads_in_nc &lt;- round(tmp_read_totals$perc_reads_in_nc, digits = 6)
#
#control_cols     &lt;- grep("^Control_", names(full_count_tab), value = TRUE)
#noncontrol_cols  &lt;- setdiff(names(full_count_tab)[-(1:2)], control_cols)
## rowwise tally of non-zero columns
#samp_totals &lt;- full_count_tab %&gt;%
#  rowwise() %&gt;%
#  mutate(
#    num_nc_samp     = sum(c_across(all_of(control_cols)) != 0, na.rm = TRUE),
#    num_non_nc_samp = sum(c_across(all_of(noncontrol_cols)) != 0, na.rm = TRUE)
#  ) %&gt;%
#  ungroup() %&gt;%
#  select(1, num_nc_samp, num_non_nc_samp)
#
#samp_totals$total_samp &lt;- samp_totals$num_nc_samp + samp_totals$num_non_nc_samp
#samp_totals &lt;- samp_totals %&gt;%  dplyr::relocate("total_samp", .after = "Representative_Sequence")
#samp_totals &lt;- samp_totals %&gt;% dplyr::mutate(perc_nc_samp = 100*( num_nc_samp / (num_nc_samp + num_non_nc_samp)), .after = "num_non_nc_samp")
#
#nc_check &lt;- dplyr::left_join(tmp_read_totals, samp_totals, by = "Representative_Sequence")
#write_delim(nc_check, here(med_here, "nc_screen/reads_in_nc_samples.txt"),delim = "\t")
#
#nc_remove &lt;- nc_check %&gt;% filter(perc_reads_in_nc &gt; 10 | perc_nc_samp &gt; 10)
#nc_remain &lt;- dplyr::anti_join(nc_check, nc_remove)
#rem_nc_reads &lt;- sum(nc_remove$total_reads_nc)
#rem_sam_reads &lt;- sum(nc_remove$total_reads_non_nc)
#per_reads_rem &lt;- round(100*( rem_nc_reads / (rem_nc_reads + rem_sam_reads)), digits = 3)
#
#ret_nc_reads &lt;- sum(nc_remain$total_reads_nc)
#ret_sam_reads &lt;- sum(nc_remain$total_reads_non_nc)
#per_reads_ret &lt;- round(100*( ret_nc_reads / (ret_nc_reads + ret_sam_reads)), digits = 3)
########################################################################
remove.seqs(accnos=nc_repseq_remove.accnos, fasta=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.fasta, count=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.count_table)
count.groups(count=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.count_table)
########################################################################
########## IN R ########################################################
########################################################################
#tmp_before &lt;- read_tsv(here(med_here, "nc_screen/shrimp.trim.contigs.good.unique.good.filter.unique.precluster.count.summary"), col_names = FALSE, col_select = 1)
#tmp_after &lt;- read_tsv(here(med_here, "nc_screen/shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.count.summary"), col_names = FALSE, col_select = 1)
#tmp_nc_lost &lt;- anti_join(tmp_before, tmp_after)
#tmp_nc_lost$X1
#
#nc_to_remove &lt;- semi_join(tmp_before, tmp_after)
#nc_to_remove &lt;- nc_to_remove %&gt;% dplyr::filter(stringr::str_starts(X1, "Control"))
# 
#readr::write_delim(nc_to_remove, file = here(med_here, "nc_screen/nc_samples_remove.accnos"), col_names = FALSE)
########################################################################
remove.groups(count=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.count_table, fasta=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.fasta, accnos=nc_samples_remove.accnos)
summary.seqs(fasta=current, count=current, processors=30)
count.groups(count=current)
chimera.vsearch(fasta=current, count=current, dereplicate=t, processors=$PROC)
summary.seqs(fasta=current, count=current, processors=30)
count.groups(count=current)
classify.seqs(fasta=current, count=current, reference=reference_dbs/gsrdb.fasta, taxonomy=reference_dbs/gsrdb.tax, processors=3)
remove.lineage(fasta=current, count=current, taxonomy=current, taxon=Chloroplast-Mitochondria-unknown-Eukaryota)
summary.tax(taxonomy=current, count=current)
count.groups(count=current)

##########################
##rename.file(
fasta=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.pick.fasta, count=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.pick.count_table, taxonomy=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.gsrdb.wang.pick.taxonomy, prefix=final)

##########################
###    CLUSTERING      ###
##########################

##########################
###    cluster.split   ###
##########################

cluster.split(fasta=final.fasta, count=final.count_table, taxonomy=final.taxonomy, taxlevel=4, cluster=f, processors=30) 
cluster.split(file=final.file, count=final.count_table, processors=30)

system(mkdir pipelineFiles/cluster.split.gsrdb)
system(mv pipelineFiles/final.opti_mcc.list pipelineFiles/cluster.split.gsrdb/)
system(mv pipelineFiles/final.file pipelineFiles/cluster.split.gsrdb/)
system(mv pipelineFiles/final.dist pipelineFiles/cluster.split.gsrdb/)

##########################
###    cluster         ###
##########################

dist.seqs(fasta=final.fasta, cutoff=0.03, processors=30)
cluster(column=final.dist, count=final.count_table)

quit()</code></pre>
</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>set.dir(output=pipelineFiles/)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Mothur's directories:
outputDir=pipelineFiles/</code></pre>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>make.file(inputdir=$DATA, type=$TYPE, prefix=shrimp)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a># OR</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>make.file(inputdir=01_TRIMMED_DATA/, type=gz, prefix=shrimp)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Setting input directories to: 
    01_TRIMMED_DATA/

Output File Names: 
shrimp.files</code></pre>
</section><section id="reducing-sequencing-pcr-errors" class="level2"><h2 class="anchored" data-anchor-id="reducing-sequencing-pcr-errors">Reducing Sequencing &amp; PCR Errors</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>make.contigs(file=current, processors=$PROC)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a># OR</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>make.contigs(file=shrimp.files, processors=30)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>We will get the following message if sample names contain dash (<code>-</code>) characters. Mothur will change this for us.</p>
<pre><code>[WARNING]: group Control-10 contains illegal characters in the name. 
Group names should not include :, -, or / characters.  The ':' character 
is a special character used in trees. Using ':' will result in your tree 
being unreadable by tree reading software.  The '-' character is a special 
character used by mothur to parse group names.  Using the '-' character 
will prevent you from selecting groups. The '/' character will created 
unreadable filenames when mothur includes the group in an output filename.

[NOTE] Updating Control-10 to Control_10 to avoid downstream issues.

...

Total of all groups is 44710450

It took 1257 secs to process 44710450 sequences.

Output File Names: 
shrimp.trim.contigs.fasta
shrimp.scrap.contigs.fasta
shrimp.contigs_report
shrimp.contigs.count_table</code></pre>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>summary.seqs(fasta=current, count=current, processors=$PROC)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>summary.seqs(fasta=shrimp.trim.contigs.fasta, count=shrimp.contigs.count_table, processors=30)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Expand to see data set summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Start</th>
<th style="text-align: center;">End</th>
<th style="text-align: center;">NBases</th>
<th style="text-align: center;">Ambigs</th>
<th style="text-align: center;">Polymer</th>
<th style="text-align: center;">NumSeqs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Minimum</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">226</td>
<td style="text-align: center;">226</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">1117762</td>
</tr>
<tr class="odd">
<td style="text-align: left;">25%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">11177613</td>
</tr>
<tr class="even">
<td style="text-align: left;">Median:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">22355226</td>
</tr>
<tr class="odd">
<td style="text-align: left;">75%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">33532838</td>
</tr>
<tr class="even">
<td style="text-align: left;">97.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">43592689</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Maximum:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">480</td>
<td style="text-align: center;">480</td>
<td style="text-align: center;">95</td>
<td style="text-align: center;">233</td>
<td style="text-align: center;">44710450</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mean:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<pre><code># of unique seqs:   44710450
total # of seqs:    44710450

It took 782 secs to summarize 44710450 sequences.

Output File Names:
shrimp.trim.contigs.summary</code></pre>
</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>count.groups(count=current)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>count.groups(count=shrimp.contigs.count_table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Size of smallest group: 58.

Total seqs: 44710450.</code></pre>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>screen.seqs(fasta=current, count=current, maxambig=0, minlength=252, maxlength=254, maxhomop=6, processors=$PROC)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>screen.seqs(fasta=current, count=current, maxambig=0, minlength=252, maxlength=254, maxhomop=6, processors=30)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Using 30 processors.

It took 107 secs to screen 44710450 sequences, removed 8308318.
/******************************************/
Running command: remove.seqs(accnos=shrimp.trim.contigs.bad.accnos.temp, count=shrimp.contigs.count_table)
Removed 8308318 sequences from shrimp.contigs.count_table.

Output File Names:
shrimp.contigs.pick.count_table

/******************************************/

Output File Names:
shrimp.trim.contigs.good.fasta
shrimp.trim.contigs.bad.accnos
shrimp.contigs.good.count_table

It took 557 secs to screen 44710450 sequences.</code></pre>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>summary.seqs(fasta=current, count=current, processors=$PROC)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>summary.seqs(fasta=shrimp.trim.contigs.good.fasta, count=shrimp.contigs.good.count_table, processors=30)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Expand to see data set summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Start</th>
<th style="text-align: center;">End</th>
<th style="text-align: center;">NBases</th>
<th style="text-align: center;">Ambigs</th>
<th style="text-align: center;">Polymer</th>
<th style="text-align: center;">NumSeqs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Minimum</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">910054</td>
</tr>
<tr class="odd">
<td style="text-align: left;">25%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">9100534</td>
</tr>
<tr class="even">
<td style="text-align: left;">Median:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">18201067</td>
</tr>
<tr class="odd">
<td style="text-align: left;">75%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">27301600</td>
</tr>
<tr class="even">
<td style="text-align: left;">97.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">35492079</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Maximum:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">36402132</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mean:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<pre><code># of unique seqs:   36402132
total # of seqs:    36402132

It took 610 secs to summarize 36402132 sequences.

Output File Names:
shrimp.trim.contigs.good.summary</code></pre>
</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>count.groups(count=current)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>count.groups(count=shrimp.contigs.good.count_table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Size of smallest group: 57.

Total seqs: 36402132.
Output File Names: 
shrimp.contigs.good.count.summary</code></pre>
</section><section id="processing-improved-reads" class="level2"><h2 class="anchored" data-anchor-id="processing-improved-reads">Processing Improved Reads</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>unique.seqs(fasta=current, count=current)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>unique.seqs(fasta=shrimp.trim.contigs.good.fasta, count=shrimp.contigs.good.count_table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>36402132    4224192

Output File Names: 
shrimp.trim.contigs.good.unique.fasta
shrimp.trim.contigs.good.count_table</code></pre>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>summary.seqs(count=current, processors=$PROC)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>summary.seqs(count=shrimp.trim.contigs.good.count_table, processors=30)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Expand to see data set summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Start</th>
<th style="text-align: center;">End</th>
<th style="text-align: center;">NBases</th>
<th style="text-align: center;">Ambigs</th>
<th style="text-align: center;">Polymer</th>
<th style="text-align: center;">NumSeqs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Minimum</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">910054</td>
</tr>
<tr class="odd">
<td style="text-align: left;">25%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">9100534</td>
</tr>
<tr class="even">
<td style="text-align: left;">Median:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">18201067</td>
</tr>
<tr class="odd">
<td style="text-align: left;">75%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">27301600</td>
</tr>
<tr class="even">
<td style="text-align: left;">97.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">35492079</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Maximum:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">36402132</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mean:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<pre><code># of unique seqs:   4224192
total # of seqs:    36402132

It took 78 secs to summarize 36402132 sequences.

Output File Names:
shrimp.trim.contigs.good.unique.summary</code></pre>
</div>
</div>
</div>
</section><section id="aligning-reads" class="level2"><h2 class="anchored" data-anchor-id="aligning-reads">Aligning Reads</h2>
<p>Since we are using the <code>silva.nr_v132.align</code> to align sequences, we can check where our reads start and end with the <a href="https://www.arb-silva.de/aligner/">ARB-SILVA web aligner</a>. After uploading a few sequences we find they start at postion 13862 and end at position 23445. Neat. We will pad these numbers to make sure we do not miss anything.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>pcr.seqs(fasta=$REF_LOC/silva.seed_v138_2.align, start=13862, end=23445, keepdots=F, processors=$PROC)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>pcr.seqs(fasta=reference_dbs/silva.seed_v138_2.align, start=13862, end=23445, keepdots=F, processors=30)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Using 30 processors.
[NOTE]: no sequences were bad, removing silva.nr_v132.bad.accnos

It took 10 secs to screen 8696 sequences.

Output File Names: 
silva.seed_v138_2.pcr.align</code></pre>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>rename.file(input=pipelineFiles/silva.nr_v132.pcr.align, new=pipelineFiles/$ALIGNREF)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>rename.file(input=pipelineFiles/silva.seed_v138_2.pcr.align, new=pipelineFiles/silva.v4.fasta)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>summary.seqs(fasta=pipelineFiles/$ALIGNREF, processors=$PROC)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>summary.seqs(fasta=pipelineFiles/silva.v4.fasta, processors=30)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Expand to see data set summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Start</th>
<th style="text-align: center;">End</th>
<th style="text-align: center;">NBases</th>
<th style="text-align: center;">Ambigs</th>
<th style="text-align: center;">Polymer</th>
<th style="text-align: center;">NumSeqs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Minimum</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">8722</td>
<td style="text-align: center;">221</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9583</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">218</td>
</tr>
<tr class="odd">
<td style="text-align: left;">25%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9583</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">2175</td>
</tr>
<tr class="even">
<td style="text-align: left;">Median:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9583</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">4349</td>
</tr>
<tr class="odd">
<td style="text-align: left;">75%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9583</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">6523</td>
</tr>
<tr class="even">
<td style="text-align: left;">97.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9583</td>
<td style="text-align: center;">421</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">8479</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Maximum:</td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">9584</td>
<td style="text-align: center;">1082</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">8696</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mean:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9582</td>
<td style="text-align: center;">288</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<pre><code># of Seqs:  8696

It took 1 secs to summarize 8696 sequences.

Output File Names:
silva.v4.summary</code></pre>
</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>align.seqs(fasta=current, reference=$REF_LOC/$ALIGNREF, processors=$PROC)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>align.seqs(fasta=shrimp.trim.contigs.good.unique.fasta, reference=pipelineFiles/silva.v4.fasta, processors=30)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Using 30 processors.

Reading in the silva.v4.fasta template sequences... DONE.
It took 34 to read  213119 sequences.

Aligning sequences from shrimp.trim.contigs.good.unique.fasta ...
It took 2 to read  8696 sequences.

[WARNING]: 854 of your sequences generated alignments that 
eliminated too many bases, a list is provided in 
shrimp.trim.contigs.good.unique.flip.accnos.
[NOTE]: 444 of your sequences were reversed to produce a better alignment.

It took 780 seconds to align 4224192 sequences.

Output File Names: 
shrimp.trim.contigs.good.unique.align
shrimp.trim.contigs.good.unique.align_report
shrimp.trim.contigs.good.unique.flip.accnos</code></pre>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>summary.seqs(fasta=current, count=current, processors=$PROC)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>summary.seqs(fasta=shrimp.trim.contigs.good.unique.align, count=shrimp.trim.contigs.good.count_table, processors=30)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Expand to see data set summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Start</th>
<th style="text-align: center;">End</th>
<th style="text-align: center;">NBases</th>
<th style="text-align: center;">Ambigs</th>
<th style="text-align: center;">Polymer</th>
<th style="text-align: center;">NumSeqs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Minimum</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9583</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">910054</td>
</tr>
<tr class="odd">
<td style="text-align: left;">25%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9583</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">9100534</td>
</tr>
<tr class="even">
<td style="text-align: left;">Median:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9583</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">18201067</td>
</tr>
<tr class="odd">
<td style="text-align: left;">75%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9583</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">27301600</td>
</tr>
<tr class="even">
<td style="text-align: left;">97.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9583</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">35492079</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Maximum:</td>
<td style="text-align: center;">9583</td>
<td style="text-align: center;">9584</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">36402132</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mean:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9581</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<pre><code># of unique seqs:   4224192
total # of seqs:    36402132

It took 141 secs to summarize 36402132 sequences.

Output File Names:
shrimp.trim.contigs.good.unique.summary</code></pre>
</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>screen.seqs(fasta=current, count=current, start=1968, end=11550, processors=$PROC)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>screen.seqs(fasta=shrimp.trim.contigs.good.unique.align, count=shrimp.trim.contigs.good.count_table, start=1, end=9583, processors=30)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Using 30 processors.

It took 66 secs to screen 4224192 sequences, removed 21326.

/******************************************/
Running command: 
remove.seqs(accnos=shrimp.trim.contigs.good.unique.bad.accnos.temp, 
count=shrimp.trim.contigs.good.count_table)
Removed 79070 sequences from shrimp.trim.contigs.good.count_table.

Output File Names:
shrimp.trim.contigs.good.pick.count_table

/******************************************/

Output File Names:
shrimp.trim.contigs.good.unique.good.align
shrimp.trim.contigs.good.unique.bad.accnos
shrimp.trim.contigs.good.good.count_table</code></pre>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>summary.seqs(fasta=current, count=current, processors=$PROC)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>summary.seqs(fasta=shrimp.trim.contigs.good.unique.good.align, count=shrimp.trim.contigs.good.good.count_table, processors=30)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Expand to see data set summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Start</th>
<th style="text-align: center;">End</th>
<th style="text-align: center;">NBases</th>
<th style="text-align: center;">Ambigs</th>
<th style="text-align: center;">Polymer</th>
<th style="text-align: center;">NumSeqs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Minimum</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9583</td>
<td style="text-align: center;">208</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9583</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">908077</td>
</tr>
<tr class="odd">
<td style="text-align: left;">25%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9583</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">9080766</td>
</tr>
<tr class="even">
<td style="text-align: left;">Median:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9583</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">18161532</td>
</tr>
<tr class="odd">
<td style="text-align: left;">75%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9583</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">27242297</td>
</tr>
<tr class="even">
<td style="text-align: left;">97.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9583</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">35414986</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Maximum:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9584</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">36323062</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mean:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">9583</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<pre><code># of unique seqs:   4202866
total # of seqs:    36323062

It took 152 secs to summarize 36323062 sequences.

Output File Names:
shrimp.trim.contigs.good.unique.good.summary</code></pre>
</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>count.groups(count=current)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>count.groups(count=shrimp.trim.contigs.good.good.count_table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Size of smallest group: 57.

Total seqs: 36323062.

Output File Names: 
shrimp.trim.contigs.good.good.count.summary</code></pre>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>filter.seqs(fasta=current, vertical=T, trump=., processors=$PROC)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>filter.seqs(fasta=shrimp.trim.contigs.good.unique.good.align, vertical=T, trump=., processors=30)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Using 30 processors.
Creating Filter...
It took 31 secs to create filter for 4202866 sequences.


Running Filter...
It took 26 secs to filter 4202866 sequences.

Length of filtered alignment: 554
Number of columns removed: 9030
Length of the original alignment: 9584
Number of sequences used to construct filter: 4202866

Output File Names: 
shrimp.filter
shrimp.trim.contigs.good.unique.good.filter.fasta</code></pre>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>unique.seqs(fasta=current, count=current)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>unique.seqs(fasta=shrimp.trim.contigs.good.unique.good.filter.fasta, count=shrimp.trim.contigs.good.good.count_table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>4202866 4178668

Output File Names: 
shrimp.trim.contigs.good.unique.good.filter.unique.fasta
shrimp.trim.contigs.good.unique.good.filter.count_table</code></pre>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb41"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>summary.seqs(fasta=current, count=current, processors=$PROC)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>summary.seqs(fasta=shrimp.trim.contigs.good.unique.good.filter.unique.fasta, count=shrimp.trim.contigs.good.unique.good.filter.count_table, processors=30)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Expand to see data set summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Start</th>
<th style="text-align: center;">End</th>
<th style="text-align: center;">NBases</th>
<th style="text-align: center;">Ambigs</th>
<th style="text-align: center;">Polymer</th>
<th style="text-align: center;">NumSeqs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Minimum</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">208</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">908077</td>
</tr>
<tr class="odd">
<td style="text-align: left;">25%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">9080766</td>
</tr>
<tr class="even">
<td style="text-align: left;">Median:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">18161532</td>
</tr>
<tr class="odd">
<td style="text-align: left;">75%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">27242297</td>
</tr>
<tr class="even">
<td style="text-align: left;">97.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">35414986</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Maximum:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">36323062</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mean:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<pre><code># of unique seqs:   4178668
total # of seqs:    36323062

It took 10 secs to summarize 36323062 sequences.

Output File Names:
shrimp.trim.contigs.good.unique.good.filter.unique.summary</code></pre>
</div>
</div>
</div>
<p>We now have a fully aligned and curated dataset that we can now pass off to the <a href="workflows/ssu/med/">MED pipeline</a>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb43"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>system(cp pipelineFiles/shrimp.trim.contigs.good.unique.good.filter.unique.fasta pipelineFiles_med/)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>system(cp pipelineFiles/shrimp.trim.contigs.good.unique.good.filter.count_table pipelineFiles_med/)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Moving on, to the next step of the mothur OTU pipeline.</p>
</section><section id="precluster" class="level2"><h2 class="anchored" data-anchor-id="precluster">Precluster</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb44"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>pre.cluster(fasta=current, count=current, diffs=2, processors=$PROC)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Expand to see partial output of <code>pre.cluster</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<pre><code>Using 30 processors.

/******************************************/
Splitting by sample: 

Using 30 processors.

Selecting sequences for groups Control_1-Control_10-Control_11-Control_12
-Control_13-Control_14-Control_15-Control_16-Control_17-Control_18

Selected 828 sequences from WA_A_FORM_EG_7457.
Selected 2958 sequences from WA_A_FORM_EG_7752.
Selected 5589 sequences from WA_A_FORM_EG_9400.
Selected 4632 sequences from WA_A_FORM_GL_7402.
Selected 3860 sequences from WA_A_FORM_GL_7403.
Selected 5518 sequences from WA_A_FORM_GL_7455.

/******************************************/

Deconvoluting count table results...
It took 17 secs to merge 2465292 sequences group data.
/******************************************/
Running get.seqs: 
Selected 1675449 sequences from shrimp.trim.contigs.good.unique.good.filter.unique.fasta.
/******************************************/
It took 8102 secs to run pre.cluster.

Using 3 processors.

Output File Names: 
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.fasta
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.count_table
</code></pre>
</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb46"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>summary.seqs(fasta=current, count=current, processors=$PROC)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Expand to see data set summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Start</th>
<th style="text-align: center;">End</th>
<th style="text-align: center;">NBases</th>
<th style="text-align: center;">Ambigs</th>
<th style="text-align: center;">Polymer</th>
<th style="text-align: center;">NumSeqs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Minimum</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">208</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">908077</td>
</tr>
<tr class="odd">
<td style="text-align: left;">25%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">9080766</td>
</tr>
<tr class="even">
<td style="text-align: left;">Median:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">18161532</td>
</tr>
<tr class="odd">
<td style="text-align: left;">75%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">27242297</td>
</tr>
<tr class="even">
<td style="text-align: left;">97.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">35414986</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Maximum:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">36323062</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mean:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<pre><code># of unique seqs:   1675449
total # of seqs:    36323062

It took 35 secs to summarize 36323062 sequences.

Output File Names:
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.summary</code></pre>
</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb48"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>count.groups(count=current)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Size of smallest group: 57.

Total seqs: 36323062.

Output File Names: 
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.count.summary</code></pre>
</section><section id="remove-negative-controls" class="level2"><h2 class="anchored" data-anchor-id="remove-negative-controls">Remove Negative Controls</h2>
<p>As with the OTU workflow, we remove NC samples, but in this case we skip the <code>pre.cluster</code> step. Our goal here to remove all NC samples from the dataset, as well as any reads that are predominantly found in NC samples. More on what that means in a minute. Before we do anything we need to identify all reads present in NC samples.</p>
<p>Here is what we are going to do:</p>
<ol type="1">
<li>Subset the NC samples (and associated reads) from the <code>fasta</code> and <code>count.table</code>. To do this in mothur we need all of the NC sample names collected in an <code>.accnos</code> file, which is a text file used in mothur that contains a single column of names–these can be sequences, OTU labels, or sample names. This list is used to select or remove specific items from other mothur files. That way we can process subsets of the data without having to retype long lists of names.</li>
</ol>
<p>To generate the <code>.accnos</code> file of NC samples we can use the <code>shrimp.files</code> file generated at the beginning of the mothur pipeline.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tmp_accnos</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="va">work_here</span>, <span class="st">"nc_screen/shrimp.files"</span><span class="op">)</span>, </span>
<span>                                delim <span class="op">=</span> <span class="st">"\t"</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">tmp_accnos</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">tmp_accnos</span> <span class="op">&lt;-</span> <span class="va">tmp_accnos</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"Control_"</span>, <span class="va">tmp_accnos</span><span class="op">$</span><span class="va">X1</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_delim</a></span><span class="op">(</span><span class="va">tmp_accnos</span>, file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="va">work_here</span>, <span class="st">"nc_screen/nc_samples.accnos"</span><span class="op">)</span>, </span>
<span>                   col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ol start="2" type="1">
<li>Now we have a list of all NC sample names. The mothur command <code>get.groups</code> in conjunction with <code>accnos</code> file allows us to subset the full <code>fasta</code> and <code>count_table</code>
</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb51"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>get.groups(fasta=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.fasta, count=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.count_table, accnos=nc_samples.accnos)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Selected 192842 sequences from your count file.
Selected 4148 sequences from your fasta file.

Output File names:
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.count_table
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.fasta
</code></pre>
<ol start="3" type="1">
<li>Next we rename the new files to something more informative (and shorter).</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb53"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>rename.file(input=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.fasta, new=nc.fasta)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>rename.file(input=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.count_table, new=nc.count_table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ol start="4" type="1">
<li>And a quick summary of the NC subset.</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb54"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>summary.seqs(fasta=nc.fasta, count=nc.count_table, processors=$PROC)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Expand to see negative control summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Start</th>
<th style="text-align: center;">End</th>
<th style="text-align: center;">NBases</th>
<th style="text-align: center;">Ambigs</th>
<th style="text-align: center;">Polymer</th>
<th style="text-align: center;">NumSeqs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Minimum</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">248</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">4822</td>
</tr>
<tr class="odd">
<td style="text-align: left;">25%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">48211</td>
</tr>
<tr class="even">
<td style="text-align: left;">Median:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">96422</td>
</tr>
<tr class="odd">
<td style="text-align: left;">75%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">144632</td>
</tr>
<tr class="even">
<td style="text-align: left;">97.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">188021</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Maximum:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">192842</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mean:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<pre><code># of unique seqs:   4148
total # of seqs:    192842

It took 0 secs to summarize 192842 sequences.

Output File Names:
neg_control.summary</code></pre>
</div>
</div>
</div>
<ol start="5" type="1">
<li>Sweet. We use the command <code>list.seqs</code> to get a complete list of all repseq names in the NC subset.</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb56"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>list.seqs(count=nc.count_table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Output File Names: 
nc.accnos</code></pre>
<p>This gives us all repseq IDs in the NC samples.</p>
<ol start="6" type="1">
<li>We could simply use the <code>nc.accnos</code> file from the <code>list.seqs</code> command to remove repseqs found in negative control (NC) samples from the main dataset. This seems reasonable enough. Except mothur will remove <strong>all</strong> repseqs found in a NC sample, in other words, any repseq in the accnos file. For example, let’s consider the following scenario where we have two repseqs:</li>
</ol>
<p><code>repseq01</code> is abundant in many NC samples but not found in any other samples.<br><code>repseq02</code> on the other hand is represented by say one read in a single NC sample but very abundant in other samples.</p>
<p>It makes sense to remove <code>repseq01</code> but not necessarily <code>repseq02</code>. Essentially, for each <code>repseq</code> in the <code>nc.accnos</code> file we want to calculate:</p>
<ul>
<li>The total number of reads in NC samples.<br>
</li>
<li>The total number of reads in non-NC samples.<br>
</li>
<li>The percent of reads in the NC samples.</li>
<li>The total number of NC samples containing at least 1 read.<br>
</li>
<li>The total number of non-NC samples containing at least 1 read.<br>
</li>
<li>The percent of NC samples containing reads.</li>
</ul>
<p>Where a final data table might look something like this</p>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 9%">
<col style="width: 13%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 16%">
<col style="width: 21%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">repseq</th>
<th style="text-align: center;">rc_nc</th>
<th style="text-align: center;">rc_samps</th>
<th style="text-align: center;">%in_nc</th>
<th style="text-align: center;">nc_samp</th>
<th style="text-align: center;">no_nc_samp</th>
<th style="text-align: center;">%_in_nc_samp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">repseq001</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">37.5</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">33.31</td>
</tr>
<tr class="even">
<td style="text-align: left;">repseq002</td>
<td style="text-align: center;">196</td>
<td style="text-align: center;">308</td>
<td style="text-align: center;">38.9</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">38</td>
<td style="text-align: center;">30.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">repseq003</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">23</td>
<td style="text-align: center;">11.1</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">14.5</td>
</tr>
</tbody>
</table>
<p>To accomplish this we will parse out relevant data from the <code>.count_table</code> files. We got the idea on how best to do this from a <a href="https://forum.mothur.org/t/negative-control/2754">discussion on the mothur forum</a>.</p>
<p>To save space and minimize file size, mothur formats the <a href="https://mothur.org/wiki/count_file/"><code>.count_table</code></a> using a sparse format by storing only non zero sample counts. However, we need the full format which lists each repseq and its abundance counts for each sample. Using the command <code>count.seqs</code> in conjunction with the <code>.count_table</code> will return a full format table.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb58"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>count.seqs(count=nc.count_table, compress=f)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Output File Names:
nc.full.count_table</code></pre>
<p>Then we use the accnos file (<code>nc.accnos</code>)–containing repseqs found in NC samples, to generate a subset of the complete dataset containing only the reseqs found in NC samples.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb60"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>get.seqs(accnos=nc.accnos, fasta=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.fasta, count=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.count_table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Selected 4148 sequences from shrimp.trim.contigs.good.unique.good.filter.unique.precluster.fasta.
Selected 15029155 sequences from shrimp.trim.contigs.good.unique.good.filter.unique.precluster.count_table.

Output File Names:
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.fasta
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.count_table</code></pre>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb62"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>rename.file(input=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.fasta, new=subset.fasta)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>rename.file(input=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.count_table, new=subset.count_table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>And again run <code>count.seqs</code> to get a full format table of the complete dataset, which we subsetted earlier to contain only repseqs found in NC samples.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb63"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>count.seqs(count=subset.count_table, compress=f)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Output File Names:
subset.full.count_table</code></pre>
<p>Finally we can parse out read count data from the two <code>subset.full.count_table</code> files.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">full_count_tab</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="va">work_here</span>, <span class="st">"nc_screen/subset.full.count_table"</span><span class="op">)</span>, </span>
<span>                                    delim <span class="op">=</span> <span class="st">"\t"</span>, col_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># figure out which columns to use</span></span>
<span><span class="va">control_cols</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"^Control_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">full_count_tab</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">noncontrol_cols</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">full_count_tab</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span>, <span class="va">control_cols</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># now do the rowwise sums</span></span>
<span><span class="va">read_totals</span> <span class="op">&lt;-</span> <span class="va">full_count_tab</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    total_reads_nc   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu">c_across</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">control_cols</span><span class="op">)</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    total_reads_non_nc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu">c_across</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">noncontrol_cols</span><span class="op">)</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="va">total_reads_nc</span>, <span class="va">total_reads_non_nc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">read_totals</span> <span class="op">&lt;-</span> <span class="va">read_totals</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"total_reads"</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>And here is what the new dataframe looks like. Three columns where the first is the repseq name, the second the total number of reads in NC samples, and the third the total number of reads in the entire dataset (this includes NC samples).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
-------------------------------------------------------------------------------------------------
           Representative_Sequence             total_reads   total_reads_nc   total_reads_non_nc 
--------------------------------------------- ------------- ---------------- --------------------
 M06508_12_000000000-CJG44_1_1101_16846_2451      51955          31810              20145        

 M06508_18_000000000-CNPPR_1_1101_15534_2103     304220            2                304218       

 M06508_12_000000000-CJG44_1_1101_15015_3135      9474            900                8574        

 M06508_12_000000000-CJG44_1_1101_15072_3643      39666           4326              35340        

 M06508_9_000000000-JTBW3_1_1106_8860_16108      509857            2                509855       

 M06508_9_000000000-JTBW3_1_1106_6953_16246      997443            9                997434       
-------------------------------------------------------------------------------------------------</code></pre>
</div>
</div>
<p>In total there are 4148 repseqs that were potential contaminants.</p>
<p>Now we add in a column that calculates the percent of reads in the NC samples.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tmp_read_totals</span> <span class="op">&lt;-</span> <span class="va">read_totals</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>perc_reads_in_nc <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="op">(</span></span>
<span>    <span class="va">total_reads_nc</span> <span class="op">/</span> <span class="op">(</span><span class="va">total_reads_nc</span> <span class="op">+</span> <span class="va">total_reads_non_nc</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                .after <span class="op">=</span> <span class="st">"total_reads_non_nc"</span><span class="op">)</span></span>
<span><span class="va">tmp_read_totals</span><span class="op">$</span><span class="va">perc_reads_in_nc</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">tmp_read_totals</span><span class="op">$</span><span class="va">perc_reads_in_nc</span>, digits <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>And then we calculate row sums to get the number of NC and non-NC samples containing these reads. For this we can use the <code>subset.full.count_table</code> we read in above.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">control_cols</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"^Control_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">full_count_tab</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">noncontrol_cols</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">full_count_tab</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span>, <span class="va">control_cols</span><span class="op">)</span></span>
<span><span class="co"># rowwise tally of non-zero columns</span></span>
<span><span class="va">samp_totals</span> <span class="op">&lt;-</span> <span class="va">full_count_tab</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    num_nc_samp     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu">c_across</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">control_cols</span><span class="op">)</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">0</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    num_non_nc_samp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu">c_across</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">noncontrol_cols</span><span class="op">)</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">0</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="fl">1</span>, <span class="va">num_nc_samp</span>, <span class="va">num_non_nc_samp</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Finally add a column with the total number of samples and calculate the percent of NC samples containing these reads.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">samp_totals</span><span class="op">$</span><span class="va">total_samp</span> <span class="op">&lt;-</span> <span class="va">samp_totals</span><span class="op">$</span><span class="va">num_nc_samp</span> <span class="op">+</span> <span class="va">samp_totals</span><span class="op">$</span><span class="va">num_non_nc_samp</span></span>
<span><span class="va">samp_totals</span> <span class="op">&lt;-</span> <span class="va">samp_totals</span> <span class="op">%&gt;%</span>  </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="st">"total_samp"</span>, .after <span class="op">=</span> <span class="st">"Representative_Sequence"</span><span class="op">)</span></span>
<span><span class="va">samp_totals</span> <span class="op">&lt;-</span> <span class="va">samp_totals</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>perc_nc_samp <span class="op">=</span> </span>
<span>                  <span class="fl">100</span><span class="op">*</span><span class="op">(</span> <span class="va">num_nc_samp</span> <span class="op">/</span> <span class="op">(</span><span class="va">num_nc_samp</span> <span class="op">+</span> <span class="va">num_non_nc_samp</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  .after <span class="op">=</span> <span class="st">"num_non_nc_samp"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>After all of this wrangling here is a snippet of the table showing the distribution of NC reads across samples.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
           Representative_Sequence             total_reads   total_reads_nc   total_reads_non_nc   perc_reads_in_nc   total_samp   num_nc_samp   num_non_nc_samp   perc_nc_samp 
--------------------------------------------- ------------- ---------------- -------------------- ------------------ ------------ ------------- ----------------- --------------
 M06508_12_000000000-CJG44_1_1101_16846_2451      51955          31810              20145               61.23            641           41              600            6.396     

 M06508_18_000000000-CNPPR_1_1101_15534_2103     304220            2                304218             0.000657          1099           2             1097            0.182     

 M06508_12_000000000-CJG44_1_1101_15015_3135      9474            900                8574                9.5             386            8              378            2.073     
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</code></pre>
</div>
</div>
<p>Now we remove any repseqs where:</p>
<ul>
<li>The number of reads found in NC samples accounted for more than 10% of total reads OR</li>
<li>The percent of NC samples containing the repseq was greater than 10% of total samples.</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nc_remove</span> <span class="op">&lt;-</span> <span class="va">nc_check</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">perc_reads_in_nc</span> <span class="op">&gt;</span> <span class="fl">10</span> <span class="op">|</span> <span class="va">perc_nc_samp</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 11%">
<col style="width: 24%">
<col style="width: 20%">
<col style="width: 21%">
<col style="width: 21%">
</colgroup>
<thead><tr class="header">
<th></th>
<th>Total rep seqs</th>
<th>NC reads</th>
<th>non NC reads</th>
<th>% NC reads</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Removed</td>
<td>3886</td>
<td>156935</td>
<td>218220</td>
<td>41.832</td>
</tr>
<tr class="even">
<td>Retained</td>
<td>262</td>
<td>35907</td>
<td>14618093</td>
<td>0.245</td>
</tr>
</tbody>
</table>
<p>We identified a total of <strong>4148</strong> representative sequences (<code>repseqs</code>) that were present in at least 1 NC sample by at least 1 read. We removed any repseq where more than 10% of total reads were found in NC samples OR any repseq found in more than 10% of NC samples. Based on these criteria we removed <strong>3886 </strong>repseqs from the data set, which accounted for <strong>156935</strong> total reads in NC samples and <strong>218220</strong> total reads in non-NC samples. Of the total reads removed <strong>41.832%</strong> came from NC samples. Of all repseqs identified in NC samples, <strong>262</strong> were retained because they fell below the threshold criteria. These repseqs accounted for <strong>35907</strong> reads in NC samples and <strong>14618093</strong> reads in non-NC samples. NC samples accounted for <strong>0.245%</strong> of these reads.</p>
<p>OK, now we can create a new <code>neg_control.accnos</code> containing only repseqs abundant in NC samples.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">write_delim</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">nc_remove</span><span class="op">$</span><span class="va">Representative_Sequence</span><span class="op">)</span>, </span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="va">work_here</span>, <span class="st">"nc_screen/nc_repseq_remove.accnos"</span><span class="op">)</span>, </span>
<span>  col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>And then use this file in conjunction with the mothur command <code>remove.seqs</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb73"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>remove.seqs(accnos=nc_repseq_remove.accnos, fasta=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.fasta, count=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.count_table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Removed 3886 sequences from shrimp.trim.contigs.good.unique.good.filter.unique.precluster.fasta.
Removed 375155 sequences from shrimp.trim.contigs.good.unique.good.filter.unique.precluster.count_table.

Output File Names:
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.fasta
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.count_table
</code></pre>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb75"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>count.groups(count=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.count_table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Size of smallest group: 1.

Total seqs: 35947907.

Output File Names:
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.count.summary</code></pre>
<p>Before we remove the NC samples we need to check whether some NC samples were already removed. When mothur runs the <code>remove.seqs</code> command it will automatically remove any samples where the read count has fallen to zero. If mothur did remove samples and we try to remove all NC samples, we will get an error. To check we can compare the <code>count.summary</code> files before and after the previous <code>remove.seqs</code> command.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tmp_before</span> <span class="op">&lt;-</span> <span class="fu">read_tsv</span><span class="op">(</span></span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="va">work_here</span>, </span>
<span>       <span class="st">"nc_screen/shrimp.trim.contigs.good.unique.good.filter.unique.precluster.count.summary"</span><span class="op">)</span>,</span>
<span>  col_names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  col_select <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_after</span> <span class="op">&lt;-</span> <span class="fu">read_tsv</span><span class="op">(</span></span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="va">work_here</span>, </span>
<span>       <span class="st">"nc_screen/shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.count.summary"</span><span class="op">)</span>,</span>
<span>  col_names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  col_select <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">tmp_nc_lost</span> <span class="op">&lt;-</span> <span class="fu">anti_join</span><span class="op">(</span><span class="va">tmp_before</span>, <span class="va">tmp_after</span><span class="op">)</span></span>
<span><span class="va">tmp_nc_lost</span><span class="op">$</span><span class="va">X1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>These are the samples that were removed when we ran <code>remove.seqs</code>. We need to eliminate these sample IDs from our list of NC samples to remove or mothur will throw an error.</p>
<pre><code>[1] "Control_15" "Control_18" "Control_21" "Control_29" "Control_5"   </code></pre>
<p>As before, we can generate a list of NC samples to use in conjunction with the <code>remove.groups</code> command to eliminate all NC samples.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nc_to_remove</span> <span class="op">&lt;-</span> <span class="fu">semi_join</span><span class="op">(</span><span class="va">tmp_before</span>, <span class="va">tmp_after</span><span class="op">)</span></span>
<span><span class="va">nc_to_remove</span> <span class="op">&lt;-</span> <span class="va">nc_to_remove</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html">str_starts</a></span><span class="op">(</span><span class="va">X1</span>, <span class="st">"Control"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_delim</a></span><span class="op">(</span><span class="va">nc_to_remove</span>, </span>
<span>                   file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="va">work_here</span>, <span class="st">"nc_screen/nc_samples_remove.accnos"</span><span class="op">)</span>, </span>
<span>                   col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>In total the following mothur command should remove 55 negative control samples.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb80"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>remove.groups(count=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.count_table, fasta=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.fasta, accnos=nc_samples_remove.accnos)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Removed 35907 sequences from your count file.
Removed 0 sequences from your fasta file.

Output File names:
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.count_table
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.fasta</code></pre>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb82"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>summary.seqs(fasta=current, count=current, processors=30)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Expand to see data set summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Start</th>
<th style="text-align: center;">End</th>
<th style="text-align: center;">NBases</th>
<th style="text-align: center;">Ambigs</th>
<th style="text-align: center;">Polymer</th>
<th style="text-align: center;">NumSeqs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Minimum</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">208</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">897801</td>
</tr>
<tr class="odd">
<td style="text-align: left;">25%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">8978001</td>
</tr>
<tr class="even">
<td style="text-align: left;">Median:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">17956001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">75%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">26934001</td>
</tr>
<tr class="even">
<td style="text-align: left;">97.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">35014201</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Maximum:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">35912000</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mean:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<pre><code># of unique seqs:   1671563
total # of seqs:    35912000

It took 74 secs to summarize 35912000 sequences.

Output File Names:
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.summary</code></pre>
</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb84"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>count.groups(count=current)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Size of smallest group: 14.

Total seqs: 35912000.

Output File Names:
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.count.summary</code></pre>
</section><section id="remove-chimeras" class="level2"><h2 class="anchored" data-anchor-id="remove-chimeras">Remove Chimeras</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb86"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>chimera.vsearch(fasta=current, count=current, dereplicate=t, processors=$PROC)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Using vsearch version v2.30.0.
Checking sequences from shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.fasta ...
/******************************************/
Splitting by sample: 

...

Removing chimeras from your input files:
/******************************************/
Running command: remove.seqs(fasta=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.fasta, accnos=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.accnos)
Removed 619952 sequences from shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.fasta.

Output File Names:
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.pick.fasta

/******************************************/

Output File Names:
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.count_table
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.chimeras
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.accnos
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.fasta</code></pre>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb88"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>summary.seqs(fasta=current, count=current, processors=30)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Expand to see data set summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Start</th>
<th style="text-align: center;">End</th>
<th style="text-align: center;">NBases</th>
<th style="text-align: center;">Ambigs</th>
<th style="text-align: center;">Polymer</th>
<th style="text-align: center;">NumSeqs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Minimum</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">208</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">863358</td>
</tr>
<tr class="odd">
<td style="text-align: left;">25%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">8633575</td>
</tr>
<tr class="even">
<td style="text-align: left;">Median:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">17267149</td>
</tr>
<tr class="odd">
<td style="text-align: left;">75%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">25900723</td>
</tr>
<tr class="even">
<td style="text-align: left;">97.5%-tile:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">33670940</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Maximum:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">254</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">34534297</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mean:</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">554</td>
<td style="text-align: center;">252</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<pre><code># of unique seqs:   1051611
total # of seqs:    34534297

It took 22 secs to summarize 34534297 sequences.

Output File Names:
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.summary</code></pre>
</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb90"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>count.groups(count=current)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Size of smallest group: 14.

Total seqs: 34534297.

Output File Names:
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.count.summary</code></pre>
</section><section id="assign-taxonomy" class="level2"><h2 class="anchored" data-anchor-id="assign-taxonomy">Assign Taxonomy</h2>
<p>The <code>classify.seqs</code> command requires properly formatted reference and taxonomy databases. For taxonomic assignment, we are using the GSR database <span class="citation" data-cites="molano2024gsr">(<a href="#ref-molano2024gsr" role="doc-biblioref">Molano, Vega-Abellaneda, and Manichanh 2024</a>)</span>. The developers of mothur maintain <a href="https://mothur.org/wiki/taxonomy_outline/">formatted versions of popular databases</a>, however the GSR-DB has not been formatted by the developers yet.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Here can download an appropriate version of the <a href="https://manichanh.vhir.org/gsrdb/download_db_links2.php">GSR database</a>.</p>
</div>
</div>
<p>To create a mothur formatted version GSR-DB<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, we perform the following steps.</p>
<section id="make-a-custom-db" class="level3"><h3 class="anchored" data-anchor-id="make-a-custom-db">Make a custom DB</h3>
<p>Here we are using the <a href="https://manichanh.vhir.org/gsrdb/GSR-DB_V4_cluster-1.tar.gz">GSR V4 database</a>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://manichanh.vhir.org/gsrdb/GSR-DB_V4_cluster-1.tar.gz</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-xvzf</span> GSR-DB_V4_cluster-1.tar.gz</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>First (in the command line) we remove first line of the taxonomy file.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> GSR-DB_V4_cluster-1_taxa.txt tmp0.txt</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="st">'1d'</span> tmp0.txt <span class="op">&gt;</span> tmp1.txt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Next, delete species and remove leading [a-z]__ from taxa names</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="at">-E</span> <span class="st">'s/s__.*//g'</span> tmp1.txt <span class="op">&gt;</span> tmp2.txt</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="at">-E</span> <span class="st">'s/[a-zA-Z]__//g'</span> tmp2.txt <span class="op">&gt;</span> gsrdb.tax</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> GSR-DB_V4_cluster-1_seqs.fasta gsrdb.fasta</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb95"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>classify.seqs(fasta=current, count=current, reference=reference_dbs/gsrdb.fasta, taxonomy=reference_dbs/gsrdb.tax, processors=3)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Using 30 processors.
Generating search database...    DONE.
It took 2 seconds generate search database.

Reading in the reference_dbs/gsrdb.txt taxonomy...  DONE.
Calculating template taxonomy tree...     DONE.
Calculating template probabilities...     DONE.
It took 6 seconds get probabilities.
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.fasta ...
[WARNING]: M06508_9_000000000-JTBW3_1_1102_26159_16839 could not be classified. 
You can use the remove.lineage command with taxon=unknown; 
to remove such sequences.
...

It took 348 secs to classify 1051611 sequences.

It took 503 secs to create the summary file for 1051611 sequences.

Output File Names:
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.gsrdb.wang.taxonomy
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.gsrdb.wang.tax.summary</code></pre>
</section></section><section id="remove-contaminants" class="level2"><h2 class="anchored" data-anchor-id="remove-contaminants">Remove Contaminants</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb97"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>remove.lineage(fasta=current, count=current, taxonomy=current, taxon=$CONTAMINENTS)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Running command: 
remove.seqs(accnos=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.gsrdb.wang.accnos, 
count=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.count_table, 
fasta=shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.fasta)

Removed 617 sequences from shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.fasta.
Removed 2776 sequences from shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.count_table.

/******************************************/

Output File Names:
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.gsrdb.wang.pick.taxonomy
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.gsrdb.wang.accnos
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.pick.count_table
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.pick.fasta</code></pre>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb99"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>summary.tax(taxonomy=current, count=current)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Using shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.pick.count_table 
as input file for the count parameter.
Using shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.gsrdb.wang.pick.taxonomy 
as input file for the taxonomy parameter.

It took 489 secs to create the summary file for 34531521 sequences.

Output File Names: 
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.gsrdb.wang.pick.tax.summary</code></pre>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb101"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>count.groups(count=current)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Size of smallest group: 14.

Total seqs: 34531521.

Output File Names: 
shrimp.trim.contigs.good.unique.good.filter.unique.precluster.pick.pick.denovo.vsearch.pick.count.summary</code></pre>
</section><section id="track-reads-through-workflow" class="level2"><h2 class="anchored" data-anchor-id="track-reads-through-workflow">Track Reads through Workflow</h2>
<p>At this point we can look at the number of reads that made it through each step of the workflow for every sample.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb103"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">read_change</span> <span class="op">&lt;-</span> <span class="fu">read_tsv</span><span class="op">(</span></span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="va">work_here</span>, <span class="st">"mothur_pipeline_read_changes.txt"</span><span class="op">)</span>,</span>
<span>  col_names <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="preparing-for-analysis" class="level2"><h2 class="anchored" data-anchor-id="preparing-for-analysis">Preparing for analysis</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb104"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>rename.file(fasta=current, count=current, taxonomy=current, prefix=final)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Current files saved by mothur:
fasta=final.fasta
taxonomy=final.taxonomy
count=final.count_table</code></pre>
</section><section id="clustering" class="level2"><h2 class="anchored" data-anchor-id="clustering">Clustering</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb106"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>cluster.split(fasta=final.fasta, count=final.count_table, taxonomy=final.taxonomy, taxlevel=4, cluster=f, processors=$PROC)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>cluster.split(file=final.file, count=final.count_table, processors=$PROC)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Using 30 processors.
Splitting the file...
/******************************************/
Selecting sequences for group Vibrionales (1 of 364)
Number of unique sequences: 92783

Selected 5390956 sequences from final.count_table.

Calculating distances for group Vibrionales (1 of 364):

Sequence    Time    Num_Dists_Below_Cutoff

It took 902 secs to find distances for 92783 sequences. 
477552179 distances below cutoff 0.03.

Output File Names:
final.0.dist

...

It took 8671 seconds to cluster
Merging the clustered files...
It took 14 seconds to merge.
[WARNING]: Cannot run sens.spec analysis without a column file, 
skipping.
Output File Names: 
final.opti_mcc.list</code></pre>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb108"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>system(mkdir cluster.split.gsrdb) </span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>system(mv final.opti_mcc.list cluster.split.gsrdb/) </span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>system(mv final.file cluster.split.gsrdb/) </span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>system(mv final.dist cluster.split.gsrdb/)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb109"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>dist.seqs(fasta=final.fasta, cutoff=0.03, processors=\$PROC) cluster(column=final.dist, count=final.count_table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Sequence    Time    Num_Dists_Below_Cutoff

It took 91935 secs to find distances for 1022766 sequences. 
1096480673 distances below cutoff 0.03.

Output File Names: 
final.dist

You did not set a cutoff, using 0.03.

Clustering final.dist

iter    time    label   num_otus    cutoff  tp  tn  fp  fn  sensitivity specificity ppv npv fdr accuracy    mcc f1score

0.03
0   0   0.03    1022766 0.03    0   5.21928e+11 0   1.09648e+09 0   1   0   0.997904    1   0.997904    0   0   
1   3187    0.03    130371  0.03    7.80436e+08 5.21829e+11 9.9517e+07  3.16045e+08 0.711764    0.999809    0.886906    0.999395    0.886906    0.999205    0.794146    0.789741    
2   3706    0.03    119919  0.03    7.82225e+08 5.21828e+11 9.99504e+07 3.14256e+08 0.713396    0.999808    0.8867  0.999398    0.8867  0.999208    0.794965    0.790663    
3   3712    0.03    119453  0.03    7.82257e+08 5.21828e+11 9.99331e+07 3.14224e+08 0.713425    0.999809    0.886722    0.999398    0.886722    0.999208    0.794991    0.790689    

It took 21013 seconds to cluster

Output File Names: 
final.opti_mcc.list
final.opti_mcc.steps
final.opti_mcc.sensspec</code></pre>
<!------------------------------------------------------------------------>
<!-------------------- Use this area to save things ---------------------->
<!------------------------------------------------------------------------>
</section></section><section id="dataset-prep" class="level1"><h1>Dataset Prep</h1>
<p>In this next part of the workflow our main goal is to create a <em>microtable object</em> using the R package <a href="https://joey711.github.io/phyloseq/">microeco</a> <span class="citation" data-cites="liu2021microeco">(<a href="#ref-liu2021microeco" role="doc-biblioref">Liu et al. 2021</a>)</span>. The microtable will be used to store the OTU by sample data as well the taxonomic, fasta, and sample data in a single object. More on that in a moment.</p>
<section id="getting-files-from-mothur" class="level2"><h2 class="anchored" data-anchor-id="getting-files-from-mothur">Getting Files from Mothur</h2>
<p>To create a microtable object we need a a sequence table, taxonomy table, and a sample data table. To generate the sequence table we need a shared file from mothur, which we can generate using the command <code>make.shared</code>. The data in a shared file represent the number of times that an OTU is observed in multiple samples.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb111"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>make.shared(list=final.opti_mcc.list, count=final.count_table, label=0.03)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>0.03

Output File Names:
final.opti_mcc.shared</code></pre>
<p>Next we use <code>classify.otu</code> to get the OTU taxonomy table.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb113"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>classify.otu(list=final.opti_mcc.list, count=final.count_table, taxonomy=final.taxonomy, label=0.03)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>0.03

Output File Names: 
final.opti_mcc.0.03.cons.taxonomy
final.opti_mcc.0.03.cons.tax.summary</code></pre>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb115"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>count.groups(shared=final.opti_mcc.shared)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>Size of smallest group: 14.

Total seqs: 34611554.

Output File Names: 
final.opti_mcc.count.summary</code></pre>
</section><section id="prep-data-for-microeco" class="level2"><h2 class="anchored" data-anchor-id="prep-data-for-microeco">Prep Data for <code>microeco</code>
</h2>
<p>Like any tool, the microeco package needs the data in a specific form. I formatted our data to match the mock data in the microeco tutorial, specifically <a href="https://chiliubio.github.io/microeco_tutorial/basic-class.html#prepare-the-example-data">this section</a>.</p>
<section id="a.-taxonomy-table" class="level3"><h3 class="anchored" data-anchor-id="a.-taxonomy-table">A. Taxonomy Table</h3>
<p>Here is what the taxonomy table looks like in the mock data.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb117"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">pandoc.table</span><span class="op">(</span><span class="va">taxonomy_table_16S</span><span class="op">[</span><span class="fl">10</span><span class="op">:</span><span class="fl">12</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, emphasize.rownames <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Our taxonomy file (below) needs a little wrangling to be properly formatted.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb118"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="fu">read_delim</span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="va">work_here</span>, <span class="st">"final.opti_mcc.0.03.cons.taxonomy"</span><span class="op">)</span>, </span>
<span>                      delim <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    OTU       Size                                                                                      Taxonomy                                                                                    
----------- -------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Otu000011   460531                           Bacteria(100);Proteobacteria(100);Gammaproteobacteria(100);Vibrionales(100);Vibrionaceae(100);Vibrionaceae_unclassified(84);                          

 Otu000012   445273   Bacteria(100);Proteobacteria(100);Alphaproteobacteria(100);Alphaproteobacteria_unclassified(100);Alphaproteobacteria_unclassified(100);Alphaproteobacteria_unclassified(100); 

 Otu000013   369620               Bacteria(100);Bacteria_unclassified(100);Bacteria_unclassified(100);Bacteria_unclassified(100);Bacteria_unclassified(100);Bacteria_unclassified(100);             
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</code></pre>
</div>
</div>
<p>Some fancy string manipulation…</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb120"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">tmp_tax</span>, </span>
<span>                             <span class="va">gsub</span>, </span>
<span>                             pattern <span class="op">=</span> <span class="st">"\\(\\d+\\)"</span>, </span>
<span>                             replacement <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">tmp_tax</span>, </span>
<span>                             <span class="va">gsub</span>, </span>
<span>                             pattern <span class="op">=</span> <span class="st">";$"</span>, </span>
<span>                             replacement <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="fu">separate_wider_delim</span><span class="op">(</span><span class="va">tmp_tax</span>, </span>
<span>                              cols <span class="op">=</span> <span class="va">Taxonomy</span>, </span>
<span>                              delim <span class="op">=</span> <span class="st">";"</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                                <span class="st">"Kingdom"</span>, <span class="st">"Phylum"</span>, </span>
<span>                                <span class="st">"Class"</span>, <span class="st">"Order"</span>, </span>
<span>                                <span class="st">"Family"</span>, <span class="st">"Genus"</span> </span>
<span>                                <span class="op">)</span></span>
<span>                              <span class="op">)</span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">tmp_tax</span>, <span class="va">gsub</span>, </span>
<span>                           pattern <span class="op">=</span> <span class="st">"^.*_unclassified$"</span>, </span>
<span>                           replacement <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp_tax</span><span class="op">$</span><span class="va">Size</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="va">tmp_tax</span>, <span class="st">"OTU"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>And we get this …</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
-------------------------------------------------------------
  &amp;nbsp;     Kingdom        Phylum              Class        
----------- ---------- ---------------- ---------------------
 Otu000011   Bacteria   Proteobacteria   Gammaproteobacteria 

 Otu000012   Bacteria   Proteobacteria   Alphaproteobacteria 

 Otu000013   Bacteria                                        
-------------------------------------------------------------</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb122"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rank_prefixes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  Kingdom <span class="op">=</span> <span class="st">"k"</span>, </span>
<span>  Phylum  <span class="op">=</span> <span class="st">"p"</span>, </span>
<span>  Class   <span class="op">=</span> <span class="st">"c"</span>, </span>
<span>  Order   <span class="op">=</span> <span class="st">"o"</span>, </span>
<span>  Family  <span class="op">=</span> <span class="st">"f"</span>, </span>
<span>  Genus   <span class="op">=</span> <span class="st">"g"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="va">tmp_tax</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span>, <span class="op">~</span><span class="fu">replace_na</span><span class="op">(</span><span class="va">.</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">rank_prefixes</span><span class="op">)</span>, </span>
<span>                <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">rank_prefixes</span><span class="op">[</span><span class="fu">cur_column</span><span class="op">(</span><span class="op">)</span><span class="op">]</span>, <span class="st">"__"</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">tidy_taxonomy</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>And then this. Excatly like the mock data.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
----------------------------------------------------------------------
  &amp;nbsp;       Kingdom          Phylum                 Class          
----------- ------------- ------------------- ------------------------
 Otu000011   k__Bacteria   p__Proteobacteria   c__Gammaproteobacteria 

 Otu000012   k__Bacteria   p__Proteobacteria   c__Alphaproteobacteria 

 Otu000013   k__Bacteria          p__                   c__           
----------------------------------------------------------------------</code></pre>
</div>
</div>
</section><section id="b.-sequence-table" class="level3"><h3 class="anchored" data-anchor-id="b.-sequence-table">B. Sequence Table</h3>
<p>Here is what the sequence table looks like in the mock data.</p>
<p>Here is what the sequence table looks like in the mock data.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
--------------------------------------------------------------------
  &amp;nbsp;    S1   S2   S3   S4   S5   S6   S7   S9   S10   S11   S12 
---------- ---- ---- ---- ---- ---- ---- ---- ---- ----- ----- -----
 OTU_4272   1    0    1    1    0    0    1    1     0     1     1  

 OTU_236    1    4    0    2    35   5    94   0    177   14    27  

 OTU_399    9    2    2    4    4    0    3    6     0     1     2  
--------------------------------------------------------------------</code></pre>
</div>
</div>
<p>These code block will return a properly formatted sequence table.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb125"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tmp_st</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span><span class="op">(</span></span>
<span>  <span class="fu">here</span><span class="op">(</span><span class="va">work_here</span>, <span class="st">"final.opti_mcc.shared"</span><span class="op">)</span>,  delim <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb126"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tmp_st</span><span class="op">$</span><span class="va">numOtus</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">tmp_st</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">tmp_st</span> <span class="op">&lt;-</span> <span class="va">tmp_st</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"tmp"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_st</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="va">tmp_st</span>, <span class="st">"tmp"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
-----------------------------------------------------------------------
  &amp;nbsp;     EP_A_AREN_EG_8651   EP_A_AREN_EG_8654   EP_A_AREN_EG_8698 
----------- ------------------- ------------------- -------------------
 Otu000001          16                 1598                 49         

 Otu000002           0                   0                   0         

 Otu000003           0                   4                   1         

 Otu000004           0                   1                   0         

 Otu000005           1                  216                1330        
-----------------------------------------------------------------------</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb128"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># only need to run this if reading in processed files</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="co"># code adds a tab to the beginning of first line</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="st">'1s/^/\t/'</span> tmp_final.opti_mcc.fixed.shared <span class="op">&gt;</span> final.opti_mcc.fixed.shared</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="c.-sample-table" class="level3"><h3 class="anchored" data-anchor-id="c.-sample-table">C. Sample Table</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
----------------------------------------------------
 &amp;nbsp;   SampleID   Group   Type       Saline      
-------- ---------- ------- ------ -----------------
   S1        S1       IW      NE    Non-saline soil 

   S2        S2       IW      NE    Non-saline soil 

   S3        S3       IW      NE    Non-saline soil 
----------------------------------------------------</code></pre>
</div>
</div>
<p>No problem.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb130"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">samdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="st">"working_files/ssu/sampledata"</span>, <span class="st">"sample_data.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">samdf</span> <span class="op">&lt;-</span> <span class="va">samdf</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"SampleID"</span><span class="op">)</span></span>
<span><span class="va">samdf</span><span class="op">$</span><span class="va">SampleID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">samdf</span><span class="op">)</span></span>
<span><span class="va">samdf</span> <span class="op">&lt;-</span> <span class="va">samdf</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">SampleID</span><span class="op">)</span></span>
<span></span>
<span><span class="va">samdf</span> <span class="op">&lt;-</span> <span class="va">samdf</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html">str_starts</a></span><span class="op">(</span><span class="va">SampleID</span>, <span class="st">"Control"</span>, negate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
------------------------------------------------------------------
      &amp;nbsp;             SampleID        OCEAN   SPECIES   TISSUE 
------------------- ------------------- ------- --------- --------
 EP_A_AREN_EG_8651   EP_A_AREN_EG_8651    EP     A_AREN      EG   

 EP_A_AREN_EG_8654   EP_A_AREN_EG_8654    EP     A_AREN      EG   

 EP_A_AREN_EG_8698   EP_A_AREN_EG_8698    EP     A_AREN      EG   
------------------------------------------------------------------</code></pre>
</div>
</div>
</section></section><section id="experiment-level-objects" class="level2"><h2 class="anchored" data-anchor-id="experiment-level-objects">Experiment-level Objects</h2>
<p>In the following section we create <code>microtable</code> and <code>phyloseq</code> objects. These are single, consolidated experiment-level data objects that organize various data types, such as OTU tables (taxa abundance), sample metadata, taxonomic classifications, as well as phylogenetic trees and reference sequences, into one structured format. This unified approach facilitates reproducible, interactive analysis and visualization by bringing all related information together.</p>
<p>We begin by creating the <code>microtable</code> and then use the function <code>meco2phyloseq</code> from the <a href="https://github.com/ChiLiubio/file2meco">file2meco</a> package to create the <code>phyloseq</code> object. This way all of the underlying data is identical across the two objects.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>These objects contain an OTU table (taxa abundances), sample metadata, and taxonomy table (mapping between OTUs and higher-level taxonomic classifications).</p>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb132"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sample_info</span> <span class="op">&lt;-</span> <span class="va">samdf</span></span>
<span><span class="va">tax_tab</span> <span class="op">&lt;-</span> <span class="va">tmp_tax</span></span>
<span><span class="va">otu_tab</span> <span class="op">&lt;-</span> <span class="va">tmp_st</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb133"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tmp_me</span> <span class="op">&lt;-</span> <span class="va">microtable</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>sample_table <span class="op">=</span> <span class="va">sample_info</span>, </span>
<span>                         otu_table <span class="op">=</span> <span class="va">otu_tab</span>, </span>
<span>                         tax_table <span class="op">=</span> <span class="va">tax_tab</span><span class="op">)</span></span>
<span><span class="va">tmp_me</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<pre><code>microtable-class object:
sample_table have 1849 rows and 13 columns
otu_table have 119453 rows and 1849 columns
tax_table have 119453 rows and 6 columns</code></pre>
<section id="d.-add-representative-sequence" class="level3"><h3 class="anchored" data-anchor-id="d.-add-representative-sequence">D. Add Representative Sequence</h3>
<p>We can also add representative sequences for each OTU/ASV. For this step, we use the mothur command <code>get.oturep</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb135"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>get.oturep(column=final.dist, list=final.opti_mcc.list, count=final.count_table, fasta=final.fasta)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The fasta file it returns needs a little T.L.C.</p>
<pre><code>You did not provide a label, using 0.03.
0.03    119453

Output File Names: 
final.opti_mcc.0.03.rep.count_table
final.opti_mcc.0.03.rep.fasta</code></pre>
<p>For that we use a tool called SeqKit <span class="citation" data-cites="shen2024seqkit2">(<a href="#ref-shen2024seqkit2" role="doc-biblioref">Shen, Sipos, and Zhao 2024</a>)</span> for fasta defline manipulation.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb137"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="ex">seqkit</span> replace <span class="at">-p</span> <span class="st">"\|.*"</span> <span class="at">-r</span> <span class="st">''</span> final.opti_mcc.0.03.rep.fasta <span class="op">&gt;</span> tmp2.fa</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="ex">seqkit</span> replace <span class="at">-p</span> <span class="st">".*</span><span class="dt">\\</span><span class="st">t"</span> <span class="at">-r</span> <span class="st">''</span> tmp2.fa <span class="op">&gt;</span> tmp3.fa</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="ex">seqkit</span> replace <span class="at">-p</span> <span class="st">"-"</span> <span class="at">-r</span> <span class="st">'$1'</span> <span class="at">-s</span> <span class="at">-w</span> 0 tmp3.fa <span class="op">&gt;</span> otu_reps.fasta</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> tmp<span class="pp">*</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb138"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rep_fasta</span> <span class="op">&lt;-</span> <span class="fu">Biostrings</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Biostrings/man/XStringSet-io.html">readDNAStringSet</a></span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="va">work_here</span>, <span class="st">"otu_reps.fasta"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp_me</span><span class="op">$</span><span class="va">rep_fasta</span> <span class="op">&lt;-</span> <span class="va">rep_fasta</span></span>
<span><span class="va">tmp_me</span><span class="op">$</span><span class="fu">tidy_dataset</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">tmp_me</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<pre><code>microtable-class object:
sample_table have 1849 rows and 14 columns
otu_table have 119453 rows and 1849 columns
tax_table have 119453 rows and 6 columns
rep_fasta have 119453 sequence</code></pre>
</section></section><section id="curate-the-data-set" class="level2"><h2 class="anchored" data-anchor-id="curate-the-data-set">Curate the Data Set</h2>
<p>Pretty much the last thing to do is remove low-count samples.</p>
<section id="remove-low-count-samples" class="level3"><h3 class="anchored" data-anchor-id="remove-low-count-samples">Remove Low-Count Samples</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb140"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">threshold</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">tmp_no_low</span> <span class="op">&lt;-</span> <span class="fu">microeco</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microeco/man/clone.html">clone</a></span><span class="op">(</span><span class="va">me_raw</span><span class="op">)</span></span>
<span><span class="va">tmp_no_low</span><span class="op">$</span><span class="va">otu_table</span> <span class="op">&lt;-</span> <span class="va">me_raw</span><span class="op">$</span><span class="va">otu_table</span> <span class="op">%&gt;%</span></span>
<span>          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="va">threshold</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp_no_low</span><span class="op">$</span><span class="fu">tidy_dataset</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">tmp_no_low</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<pre><code>41 taxa with 0 abundance are removed from the otu_table ...</code></pre>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>microtable-class object:
sample_table have 1838 rows and 14 columns
otu_table have 119412 rows and 1838 columns
tax_table have 119412 rows and 6 columns
rep_fasta have 119412 sequences</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb143"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">me_final</span> <span class="op">&lt;-</span> <span class="fu">microeco</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microeco/man/clone.html">clone</a></span><span class="op">(</span><span class="va">tmp_no_low</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Lastly, we can use the package <a href="https://github.com/ChiLiubio/file2meco"><code>file2meco</code></a> to generate a <a href="https://joey711.github.io/phyloseq/">phyloseq</a> object.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb144"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ps_final</span> <span class="op">&lt;-</span> <span class="fu">file2meco</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/file2meco/man/meco2phyloseq.html">meco2phyloseq</a></span><span class="op">(</span><span class="va">me_final</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section></section><section id="summary" class="level2"><h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>Now time to summarize the data. For this we use the R package <a href="https://microbiome.github.io">miaverse</a> <span class="citation" data-cites="felix2024mia">(<a href="#ref-felix2024mia" role="doc-biblioref">Borman et al. 2024</a>)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">me_dataset</th>
<th style="text-align: right;">total_asvs</th>
<th style="text-align: right;">total_reads</th>
<th style="text-align: right;">total_samples</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">original</td>
<td style="text-align: right;">119453</td>
<td style="text-align: right;">34611554</td>
<td style="text-align: right;">1849</td>
</tr>
<tr class="even">
<td style="text-align: left;">final</td>
<td style="text-align: right;">119412</td>
<td style="text-align: right;">34606505</td>
<td style="text-align: right;">1838</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-tbl-cap="Dataset metrics before and after curation.">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Dataset metrics before and after curation.</caption>
<thead><tr class="header">
<th style="text-align: left;">Metric</th>
<th style="text-align: left;">Start</th>
<th style="text-align: left;">End</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Min. no. of reads</td>
<td style="text-align: left;">14</td>
<td style="text-align: left;">1160</td>
</tr>
<tr class="even">
<td style="text-align: left;">Max. no. of reads</td>
<td style="text-align: left;">244661</td>
<td style="text-align: left;">244661</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total no. of reads</td>
<td style="text-align: left;">34611554</td>
<td style="text-align: left;">34606505</td>
</tr>
<tr class="even">
<td style="text-align: left;">Avg. no. of reads</td>
<td style="text-align: left;">18719</td>
<td style="text-align: left;">18828</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Median no. of reads</td>
<td style="text-align: left;">14834</td>
<td style="text-align: left;">14885</td>
</tr>
<tr class="even">
<td style="text-align: left;">Total ASVs</td>
<td style="text-align: left;">119453</td>
<td style="text-align: left;">119412</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No.&nbsp;of singleton ASVs</td>
<td style="text-align: left;">71988</td>
<td style="text-align: left;">71959</td>
</tr>
<tr class="even">
<td style="text-align: left;">% of singleton ASVs</td>
<td style="text-align: left;">60.265</td>
<td style="text-align: left;">60.261</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sparsity</td>
<td style="text-align: left;">0.996</td>
<td style="text-align: left;">0.996</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We started off with 119453 ASVs and 1849 samples. After removing low-count samples, there were 119412 ASVs and 1838 samples remaining.</p>
<p>We lost a total of 71 samples after curating the dataset. This includes 60 NC samples and 11 non-NC samples.</p>
<p>Here is a list of non-NC samples that were removed.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] "WA_A_BAHA_GL_7474" "WA_A_CRIS_GL_9624" "WA_A_CRIS_HP_7536"
 [4] "WA_A_FLOR_GL_9659" "WA_A_NUTT_EG_9410" "WA_A_PARA_GL_9474"
 [7] "WA_A_PARA_MG_9364" "WA_A_PARA_ST_9477" "WA_A_PCNS_MG_9513"
[10] "WA_A_THOM_ST_9389" "WA_A_WEBS_HP_9411"</code></pre>
</div>
</div>
</section></section><section id="download-results" class="level1 page-columns page-full"><h1>Download Results</h1>
<p>Quick access to read changes through the pipeline and repseqs detected in negative control samples.</p>
<div id="listing-otu-listing" class="column-body quarto-listing quarto-listing-container-table">
<table class="quarto-listing-table table">
<thead><tr>
<th>
File Name
</th>

<th>
Description
</th>

</tr></thead>
<tbody class="list">
<tr data-index="0" data-listing-filename-sort="reads_in_nc_samples.txt">
<td>
<a href="../../../share/ssu/otu/reads_in_nc_samples.txt" class="filename listing-filename">reads_in_nc_samples.txt</a>
</td>
<td>
<span class="listing-description">Abundance table of reads detected in Negative Control samples. </span>
</td>

</tr>
<tr data-index="1" data-listing-filename-sort="mothur_pipeline_read_changes.txt">
<td>
<a href="../../../share/ssu/otu/mothur_pipeline_read_changes.txt" class="filename listing-filename">mothur_pipeline_read_changes.txt</a>
</td>
<td>
<span class="listing-description">Read changes for all samples through mothur pipeline. </span>
</td>

</tr>
</tbody>
</table>
<div class="listing-no-matching d-none">No matching items</div>
</div>
<!------------------------------------------------------------------------>
<!-------------------- Use this area to save things ---------------------->
<!------------------------------------------------------------------------>
<!--------------------------------------->
<!-- These chunks are for curated data -->
<!--------------------------------------->
<!-------------------------------------------->
<!-- These chunks are for  processing data  -->
<!-------------------------------------------->
</section><div id="quarto-appendix" class="default"><section id="references" class="level4 appendix"><h2 class="anchored quarto-appendix-heading">References</h2><div class="quarto-appendix-contents">
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-felix2024mia" class="csl-entry" role="listitem">
Borman, Tuomas, Felix G. M. Ernst, Sudarshan A. Shetty, and Leo Lahti. 2024. <em>Mia: Microbiome Analysis</em>. <a href="https://doi.org/10.18129/B9.bioc.mia">https://doi.org/10.18129/B9.bioc.mia</a>.
</div>
<div id="ref-liu2021microeco" class="csl-entry" role="listitem">
Liu, Chi, Yaoming Cui, Xiangzhen Li, and Minjie Yao. 2021. <span>“Microeco: An r Package for Data Mining in Microbial Community Ecology.”</span> <em>FEMS Microbiology Ecology</em> 97 (2): fiaa255. <a href="https://doi.org/10.1038/s41596-025-01239-4">https://doi.org/10.1038/s41596-025-01239-4</a>.
</div>
<div id="ref-molano2024gsr" class="csl-entry" role="listitem">
Molano, Leidy-Alejandra G, Sara Vega-Abellaneda, and Chaysavanh Manichanh. 2024. <span>“GSR-DB: A Manually Curated and Optimized Taxonomical Database for 16S rRNA Amplicon Analysis.”</span> <em>Msystems</em> 9 (2): e00950–23. <a href="https://doi.org/10.1128/msystems.00950-23">https://doi.org/10.1128/msystems.00950-23</a>.
</div>
<div id="ref-schloss2009mothur" class="csl-entry" role="listitem">
Schloss, Patrick D, Sarah L Westcott, Thomas Ryabin, Justine R Hall, Martin Hartmann, Emily B Hollister, Ryan A Lesniewski, et al. 2009. <span>“Introducing Mothur: Open-Source, Platform-Independent, Community-Supported Software for Describing and Comparing Microbial Communities.”</span> <em>Applied and Environmental Microbiology</em> 75 (23): 7537–41. <a href="https://doi.org/10.1128/AEM.01541-09">https://doi.org/10.1128/AEM.01541-09</a>.
</div>
<div id="ref-shen2024seqkit2" class="csl-entry" role="listitem">
Shen, Wei, Botond Sipos, and Liuyang Zhao. 2024. <span>“SeqKit2: A Swiss Army Knife for Sequence and Alignment Processing.”</span> <em>Imeta</em> 3 (3): e191. <a href="https://doi.org/10.1002/imt2.191">https://doi.org/10.1002/imt2.191</a>.
</div>
</div>
</div></section><section id="detailed-session-info" class="level4 appendix"><h2 class="anchored quarto-appendix-heading">Detailed Session Info</h2><div class="quarto-appendix-contents">
<details><summary>Expand to see Session Info</summary><div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.5.1 (2025-06-13)
 os       macOS Ventura 13.7.8
 system   x86_64, darwin20
 ui       X11
 language (EN)
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       America/Los_Angeles
 date     2025-10-02
 pandoc   3.6.3 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/x86_64/ (via rmarkdown)
 quarto   1.8.25 @ /Applications/quarto/bin/quarto

─ Packages ───────────────────────────────────────────────────────────────────
 package                  * version   date (UTC) lib source
 Biobase                  * 2.68.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 BiocGenerics             * 0.54.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 Biostrings               * 2.76.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 downloadthis             * 0.5.0     2025-09-26 [1] Github (fmmattioni/downloadthis@18e3e5a)
 dplyr                    * 1.1.4     2023-11-17 [1] CRAN (R 4.5.0)
 fontawesome              * 0.5.3     2024-11-16 [1] CRAN (R 4.5.0)
 forcats                  * 1.0.0     2023-01-29 [1] CRAN (R 4.5.0)
 fs                       * 1.6.6     2025-04-12 [1] CRAN (R 4.5.0)
 generics                 * 0.1.4     2025-05-09 [1] CRAN (R 4.5.0)
 GenomeInfoDb             * 1.44.2    2025-08-18 [1] Bioconductor 3.21 (R 4.5.1)
 GenomicRanges            * 1.60.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 ggplot2                  * 4.0.0     2025-09-11 [1] CRAN (R 4.5.1)
 here                     * 1.0.2     2025-09-15 [1] CRAN (R 4.5.1)
 htmltools                * 0.5.8.1   2024-04-04 [1] CRAN (R 4.5.0)
 IRanges                  * 2.42.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 lubridate                * 1.9.4     2024-12-08 [1] CRAN (R 4.5.0)
 magrittr                 * 2.0.4     2025-09-12 [1] CRAN (R 4.5.1)
 MatrixGenerics           * 1.20.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 matrixStats              * 1.5.0     2025-01-07 [1] CRAN (R 4.5.0)
 mia                      * 1.15.6    2024-11-22 [1] Bioconductor 3.21 (R 4.5.0)
 microbiome               * 1.30.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 microeco                 * 1.15.0    2025-05-18 [1] CRAN (R 4.5.0)
 microViz                 * 0.12.7    2025-08-01 [1] https://david-barnett.r-universe.dev (R 4.5.1)
 MultiAssayExperiment     * 1.34.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 pander                   * 0.6.6     2025-03-01 [1] CRAN (R 4.5.0)
 phyloseq                 * 1.52.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 purrr                    * 1.1.0     2025-07-10 [1] CRAN (R 4.5.1)
 R.methodsS3              * 1.8.2     2022-06-13 [1] CRAN (R 4.5.0)
 R.oo                     * 1.27.1    2025-05-02 [1] CRAN (R 4.5.0)
 R.utils                  * 2.13.0    2025-02-24 [1] CRAN (R 4.5.0)
 reactable                * 0.4.4     2023-03-12 [1] CRAN (R 4.5.0)
 reactablefmtr            * 2.0.0     2022-03-16 [1] CRAN (R 4.5.0)
 readr                    * 2.1.5     2024-01-10 [1] CRAN (R 4.5.0)
 S4Vectors                * 0.46.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 seqinr                   * 4.2-36    2023-12-08 [1] CRAN (R 4.5.0)
 sessioninfo              * 1.2.3     2025-02-05 [1] CRAN (R 4.5.0)
 SingleCellExperiment     * 1.30.1    2025-05-05 [1] Bioconductor 3.21 (R 4.5.0)
 stringr                  * 1.5.2     2025-09-08 [1] CRAN (R 4.5.1)
 SummarizedExperiment     * 1.38.1    2025-04-28 [1] Bioconductor 3.21 (R 4.5.0)
 tibble                   * 3.3.0     2025-06-08 [1] CRAN (R 4.5.0)
 tidyr                    * 1.3.1     2024-01-24 [1] CRAN (R 4.5.0)
 tidyverse                * 2.0.0     2023-02-22 [1] CRAN (R 4.5.0)
 tinytable                * 0.13.0.10 2025-09-07 [1] https://vincentarelbundock.r-universe.dev (R 4.5.1)
 TreeSummarizedExperiment * 2.16.1    2025-05-08 [1] Bioconductor 3.21 (R 4.5.0)
 XVector                  * 0.48.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 zip                      * 2.3.3     2025-05-13 [1] CRAN (R 4.5.0)

 [1] /Library/Frameworks/R.framework/Versions/4.5-x86_64/Resources/library
 * ── Packages attached to the search path.

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
======   Devtools Session info   ===================================</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> package                  * version   date (UTC) lib source
 Biobase                  * 2.68.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 BiocGenerics             * 0.54.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 Biostrings               * 2.76.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 downloadthis             * 0.5.0     2025-09-26 [1] Github (fmmattioni/downloadthis@18e3e5a)
 dplyr                    * 1.1.4     2023-11-17 [1] CRAN (R 4.5.0)
 fontawesome              * 0.5.3     2024-11-16 [1] CRAN (R 4.5.0)
 forcats                  * 1.0.0     2023-01-29 [1] CRAN (R 4.5.0)
 fs                       * 1.6.6     2025-04-12 [1] CRAN (R 4.5.0)
 generics                 * 0.1.4     2025-05-09 [1] CRAN (R 4.5.0)
 GenomeInfoDb             * 1.44.2    2025-08-18 [1] Bioconductor 3.21 (R 4.5.1)
 GenomicRanges            * 1.60.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 ggplot2                  * 4.0.0     2025-09-11 [1] CRAN (R 4.5.1)
 here                     * 1.0.2     2025-09-15 [1] CRAN (R 4.5.1)
 htmltools                * 0.5.8.1   2024-04-04 [1] CRAN (R 4.5.0)
 IRanges                  * 2.42.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 lubridate                * 1.9.4     2024-12-08 [1] CRAN (R 4.5.0)
 magrittr                 * 2.0.4     2025-09-12 [1] CRAN (R 4.5.1)
 MatrixGenerics           * 1.20.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 matrixStats              * 1.5.0     2025-01-07 [1] CRAN (R 4.5.0)
 mia                      * 1.15.6    2024-11-22 [1] Bioconductor 3.21 (R 4.5.0)
 microbiome               * 1.30.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 microeco                 * 1.15.0    2025-05-18 [1] CRAN (R 4.5.0)
 microViz                 * 0.12.7    2025-08-01 [1] https://david-barnett.r-universe.dev (R 4.5.1)
 MultiAssayExperiment     * 1.34.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 pander                   * 0.6.6     2025-03-01 [1] CRAN (R 4.5.0)
 phyloseq                 * 1.52.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 purrr                    * 1.1.0     2025-07-10 [1] CRAN (R 4.5.1)
 R.methodsS3              * 1.8.2     2022-06-13 [1] CRAN (R 4.5.0)
 R.oo                     * 1.27.1    2025-05-02 [1] CRAN (R 4.5.0)
 R.utils                  * 2.13.0    2025-02-24 [1] CRAN (R 4.5.0)
 reactable                * 0.4.4     2023-03-12 [1] CRAN (R 4.5.0)
 reactablefmtr            * 2.0.0     2022-03-16 [1] CRAN (R 4.5.0)
 readr                    * 2.1.5     2024-01-10 [1] CRAN (R 4.5.0)
 S4Vectors                * 0.46.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 seqinr                   * 4.2-36    2023-12-08 [1] CRAN (R 4.5.0)
 sessioninfo              * 1.2.3     2025-02-05 [1] CRAN (R 4.5.0)
 SingleCellExperiment     * 1.30.1    2025-05-05 [1] Bioconductor 3.21 (R 4.5.0)
 stringr                  * 1.5.2     2025-09-08 [1] CRAN (R 4.5.1)
 SummarizedExperiment     * 1.38.1    2025-04-28 [1] Bioconductor 3.21 (R 4.5.0)
 tibble                   * 3.3.0     2025-06-08 [1] CRAN (R 4.5.0)
 tidyr                    * 1.3.1     2024-01-24 [1] CRAN (R 4.5.0)
 tidyverse                * 2.0.0     2023-02-22 [1] CRAN (R 4.5.0)
 tinytable                * 0.13.0.10 2025-09-07 [1] https://vincentarelbundock.r-universe.dev (R 4.5.1)
 TreeSummarizedExperiment * 2.16.1    2025-05-08 [1] Bioconductor 3.21 (R 4.5.0)
 XVector                  * 0.48.0    2025-04-15 [1] Bioconductor 3.21 (R 4.5.0)
 zip                      * 2.3.3     2025-05-13 [1] CRAN (R 4.5.0)

 [1] /Library/Frameworks/R.framework/Versions/4.5-x86_64/Resources/library
 * ── Packages attached to the search path.</code></pre>
</div>
</div>
</details></div></section><section id="last-updated-on" class="level4 appendix"><h2 class="anchored quarto-appendix-heading">Last updated on</h2><div class="quarto-appendix-contents">
<p>2025-10-02</p>



<!-- -->

</div></section><section class="level4 appendix"><h2 class="quarto-appendix-heading">Collected Links</h2><div class="quarto-appendix-contents">
<ul>
<li><a href="../../../workflows/portal/data-otu.html">OTU Data Portal</a></li>
<li><a href="https://mothur.org/wiki/installation/">mothur installed</a></li>
<li><a href="https://www.tidyverse.org">tidyverse</a></li>
<li><a href="https://mothur.org/">mothur</a></li>
<li><a href="https://mothur.org/wiki/miseq_sop/">MiSeq SOP</a></li>
<li><a href="https://mothur.org/wiki/batch_mode/">Batch Mode</a></li>
<li><a href="https://www.arb-silva.de/aligner/">ARB-SILVA web aligner</a></li>
<li><a href="workflows/ssu/med/">MED pipeline</a></li>
<li><a href="https://forum.mothur.org/t/negative-control/2754">discussion on the mothur forum</a></li>
<li><a href="https://mothur.org/wiki/count_file/"><code>.count_table</code></a></li>
<li><a href="https://mothur.org/wiki/taxonomy_outline/">formatted versions of popular databases</a></li>
<li><a href="https://manichanh.vhir.org/gsrdb/download_db_links2.php">GSR database</a></li>
<li><a href="https://manichanh.vhir.org/gsrdb/GSR-DB_V4_cluster-1.tar.gz">GSR V4 database</a></li>
<li><a href="https://joey711.github.io/phyloseq/">microeco</a></li>
<li><a href="https://chiliubio.github.io/microeco_tutorial/basic-class.html#prepare-the-example-data">this section</a></li>
<li><a href="https://github.com/ChiLiubio/file2meco">file2meco</a></li>
<li><a href="https://joey711.github.io/phyloseq/">phyloseq</a></li>
<li><a href="https://microbiome.github.io">miaverse</a></li>
<li><a href="https://quarto.org/">Quarto</a></li>
<li><a href="https://metacrobe.github.io/">metacrobe</a></li>
<li><a href="https://istmobiome.rbind.io/">The Istmobiome Project</a></li>
</ul></div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>From the developers: GSR database (Greengenes, SILVA, and RDP database) is an integrated and manually curated database for bacterial and archaeal 16S amplicon taxonomy analysis. Unlike previous integration approaches, this database creation pipeline includes a taxonomy unification step to ensure consistency in taxonomical annotations. The database was validated with three mock communities and two real datasets and compared with existing 16S databases such as Greengenes, GTDB, ITGDB, SILVA, RDP, and MetaSquare. Results showed that the GSR database enhances taxonomical annotations of 16S sequences, outperforming current 16S databases at the species level. The GSR database is available for full-length 16S sequences and the most commonly used hypervariable regions: V4, V1-V3, V3-V4, and V3-V5.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/istmobiome\.github\.io\/trans-shrimp\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../../../workflows/ssu/dada2/index.html" class="pagination-link" aria-label="2. DADA2 ASV Workflow">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">2. DADA2 ASV Workflow</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../../workflows/ssu/med/index.html" class="pagination-link" aria-label="5. MED Workflow">
        <span class="nav-page-text">5. MED Workflow</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb149" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "4. OTU Workflow"</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> |</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="co">  Workflow for processing 16S rRNA samples for OTU analysis using mothur. Workflow uses paired end reads, beginning with raw fastq files, ending with sequence and taxonomy tables. A Microtable Object is produced to collate the data for downstream analysis. </span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a><span class="an">listing:</span><span class="co"> </span></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a><span class="co">    id: otu-listing</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a><span class="co">    contents: data-otu.yml</span></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a><span class="co">    type: table</span></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a><span class="co">    sort-ui: false</span></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a><span class="co">    filter-ui: false</span></span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a><span class="co">    fields: </span></span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a><span class="co">      - filename</span></span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a><span class="co">      - description</span></span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a><span class="co">    field-links: </span></span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a><span class="co">      - filename</span></span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a><span class="co">    field-display-names: </span></span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a><span class="co">      filename: File Name</span></span>
<span id="cb149-18"><a href="#cb149-18" aria-hidden="true" tabindex="-1"></a><span class="co">      description: Description</span></span>
<span id="cb149-19"><a href="#cb149-19" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb149-20"><a href="#cb149-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-21"><a href="#cb149-21" aria-hidden="true" tabindex="-1"></a>{{&lt; include /include/_setup.qmd &gt;}}</span>
<span id="cb149-22"><a href="#cb149-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-25"><a href="#cb149-25" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-26"><a href="#cb149-26" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-27"><a href="#cb149-27" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb149-28"><a href="#cb149-28" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: set wd for here</span></span>
<span id="cb149-29"><a href="#cb149-29" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb149-30"><a href="#cb149-30" aria-hidden="true" tabindex="-1"></a>workflow_name <span class="ot">&lt;-</span> <span class="st">"otu"</span> <span class="co"># e.g., med, dada2, etc</span></span>
<span id="cb149-31"><a href="#cb149-31" aria-hidden="true" tabindex="-1"></a>work_here <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"working_files/ssu/"</span>, workflow_name)</span>
<span id="cb149-32"><a href="#cb149-32" aria-hidden="true" tabindex="-1"></a>share_here <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"share/ssu/"</span>, workflow_name)</span>
<span id="cb149-33"><a href="#cb149-33" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">"assets/scripts"</span>, <span class="st">"summarize_objs.R"</span>))</span>
<span id="cb149-34"><a href="#cb149-34" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">"assets/scripts"</span>, <span class="st">"mia_metrics.R"</span>))</span>
<span id="cb149-35"><a href="#cb149-35" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-36"><a href="#cb149-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-37"><a href="#cb149-37" aria-hidden="true" tabindex="-1"></a><span class="fu">## Workflow Input</span></span>
<span id="cb149-38"><a href="#cb149-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-39"><a href="#cb149-39" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb149-40"><a href="#cb149-40" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data &amp; Scripts</span></span>
<span id="cb149-41"><a href="#cb149-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-42"><a href="#cb149-42" aria-hidden="true" tabindex="-1"></a>Fastq sequence files, scripts, and other assets for running this workflow can be found on the <span class="co">[</span><span class="ot">OTU Data Portal</span><span class="co">](/workflows/portal/data-otu.qmd)</span> page. </span>
<span id="cb149-43"><a href="#cb149-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-44"><a href="#cb149-44" aria-hidden="true" tabindex="-1"></a>The Data Portal page also contains a link to the curated output of this pipeline–-feature-sample count table, taxonomy table, sample metadata, &amp; representative fasta sequences. Data is available as stand-alone text files, OR bundled in microtable and phyloseq objects. Archive also includes a table tracking sample read changes.</span>
<span id="cb149-45"><a href="#cb149-45" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb149-46"><a href="#cb149-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-47"><a href="#cb149-47" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Required Packages &amp; Software</span></span>
<span id="cb149-48"><a href="#cb149-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-49"><a href="#cb149-49" aria-hidden="true" tabindex="-1"></a>To run this workflow you need to have <span class="co">[</span><span class="ot">mothur installed</span><span class="co">](https://mothur.org/wiki/installation/)</span> and you will need the <span class="co">[</span><span class="ot">tidyverse</span><span class="co">](https://www.tidyverse.org)</span> package. </span>
<span id="cb149-50"><a href="#cb149-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-51"><a href="#cb149-51" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview</span></span>
<span id="cb149-52"><a href="#cb149-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-53"><a href="#cb149-53" aria-hidden="true" tabindex="-1"></a>This is a standard pipeline for generating OTUs using <span class="co">[</span><span class="ot">mothur</span><span class="co">](https://mothur.org/)[</span><span class="ot">@schloss2009mothur</span><span class="co">]</span>. We generally followed the mothur <span class="co">[</span><span class="ot">MiSeq SOP</span><span class="co">](https://mothur.org/wiki/miseq_sop/)</span> when building this pipeline. Since this SOP is heavily annotated we will keep our comments here to a minimum. </span>
<span id="cb149-54"><a href="#cb149-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-55"><a href="#cb149-55" aria-hidden="true" tabindex="-1"></a>:::{.columns}</span>
<span id="cb149-56"><a href="#cb149-56" aria-hidden="true" tabindex="-1"></a>:::{.column width="50%"}</span>
<span id="cb149-57"><a href="#cb149-57" aria-hidden="true" tabindex="-1"></a>{{&lt; include include/_otu_flowchart_1.qmd &gt;}}</span>
<span id="cb149-58"><a href="#cb149-58" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb149-59"><a href="#cb149-59" aria-hidden="true" tabindex="-1"></a>:::{.column width="50%"}</span>
<span id="cb149-60"><a href="#cb149-60" aria-hidden="true" tabindex="-1"></a>{{&lt; include include/_otu_flowchart_2.qmd &gt;}}</span>
<span id="cb149-61"><a href="#cb149-61" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb149-62"><a href="#cb149-62" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb149-63"><a href="#cb149-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-64"><a href="#cb149-64" aria-hidden="true" tabindex="-1"></a><span class="fu"># Read Processing</span></span>
<span id="cb149-65"><a href="#cb149-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-66"><a href="#cb149-66" aria-hidden="true" tabindex="-1"></a>{{&lt; include include/_OTU_Part1.qmd &gt;}}</span>
<span id="cb149-67"><a href="#cb149-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-68"><a href="#cb149-68" aria-hidden="true" tabindex="-1"></a><span class="fu"># Dataset Prep</span></span>
<span id="cb149-69"><a href="#cb149-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-70"><a href="#cb149-70" aria-hidden="true" tabindex="-1"></a>In this next part of the workflow our main goal is to create a *microtable object* using the R package <span class="co">[</span><span class="ot">microeco</span><span class="co">](https://joey711.github.io/phyloseq/)</span> <span class="co">[</span><span class="ot">@liu2021microeco</span><span class="co">]</span>. The microtable will be used to store the OTU by sample data as well the taxonomic, fasta, and sample data in a single object. More on that in a moment.</span>
<span id="cb149-71"><a href="#cb149-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-74"><a href="#cb149-74" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-75"><a href="#cb149-75" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb149-76"><a href="#cb149-76" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-77"><a href="#cb149-77" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb149-78"><a href="#cb149-78" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb149-79"><a href="#cb149-79" aria-hidden="true" tabindex="-1"></a><span class="co">#remove(list = ls())</span></span>
<span id="cb149-80"><a href="#cb149-80" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">here</span>(<span class="st">"page_build"</span>, <span class="st">"otu_part2.rdata"</span>))</span>
<span id="cb149-81"><a href="#cb149-81" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span>
<span id="cb149-82"><a href="#cb149-82" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-83"><a href="#cb149-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-84"><a href="#cb149-84" aria-hidden="true" tabindex="-1"></a><span class="fu">## Getting Files from Mothur</span></span>
<span id="cb149-85"><a href="#cb149-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-86"><a href="#cb149-86" aria-hidden="true" tabindex="-1"></a>To create a microtable object we need a a sequence table, taxonomy table, and a sample data table. To generate the sequence table we need a shared file from mothur, which we can generate using the command <span class="in">`make.shared`</span>. The data in a shared file represent the number of times that an OTU is observed in multiple samples. </span>
<span id="cb149-87"><a href="#cb149-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-90"><a href="#cb149-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{verbatim}</span></span>
<span id="cb149-91"><a href="#cb149-91" aria-hidden="true" tabindex="-1"></a><span class="in">make.shared(list=final.opti_mcc.list, count=final.count_table, label=0.03)</span></span>
<span id="cb149-92"><a href="#cb149-92" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-93"><a href="#cb149-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-94"><a href="#cb149-94" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb149-95"><a href="#cb149-95" aria-hidden="true" tabindex="-1"></a><span class="in">0.03</span></span>
<span id="cb149-96"><a href="#cb149-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-97"><a href="#cb149-97" aria-hidden="true" tabindex="-1"></a><span class="in">Output File Names:</span></span>
<span id="cb149-98"><a href="#cb149-98" aria-hidden="true" tabindex="-1"></a><span class="in">final.opti_mcc.shared</span></span>
<span id="cb149-99"><a href="#cb149-99" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-100"><a href="#cb149-100" aria-hidden="true" tabindex="-1"></a>Next we use <span class="in">`classify.otu`</span> to get the OTU taxonomy table. </span>
<span id="cb149-101"><a href="#cb149-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-104"><a href="#cb149-104" aria-hidden="true" tabindex="-1"></a><span class="in">```{verbatim}</span></span>
<span id="cb149-105"><a href="#cb149-105" aria-hidden="true" tabindex="-1"></a><span class="in">classify.otu(list=final.opti_mcc.list, count=final.count_table, taxonomy=final.taxonomy, label=0.03)</span></span>
<span id="cb149-106"><a href="#cb149-106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-107"><a href="#cb149-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-108"><a href="#cb149-108" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb149-109"><a href="#cb149-109" aria-hidden="true" tabindex="-1"></a><span class="in">0.03</span></span>
<span id="cb149-110"><a href="#cb149-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-111"><a href="#cb149-111" aria-hidden="true" tabindex="-1"></a><span class="in">Output File Names: </span></span>
<span id="cb149-112"><a href="#cb149-112" aria-hidden="true" tabindex="-1"></a><span class="in">final.opti_mcc.0.03.cons.taxonomy</span></span>
<span id="cb149-113"><a href="#cb149-113" aria-hidden="true" tabindex="-1"></a><span class="in">final.opti_mcc.0.03.cons.tax.summary</span></span>
<span id="cb149-114"><a href="#cb149-114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-115"><a href="#cb149-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-118"><a href="#cb149-118" aria-hidden="true" tabindex="-1"></a><span class="in">```{verbatim}</span></span>
<span id="cb149-119"><a href="#cb149-119" aria-hidden="true" tabindex="-1"></a><span class="in">count.groups(shared=final.opti_mcc.shared)</span></span>
<span id="cb149-120"><a href="#cb149-120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-121"><a href="#cb149-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-122"><a href="#cb149-122" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb149-123"><a href="#cb149-123" aria-hidden="true" tabindex="-1"></a><span class="in">Size of smallest group: 14.</span></span>
<span id="cb149-124"><a href="#cb149-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-125"><a href="#cb149-125" aria-hidden="true" tabindex="-1"></a><span class="in">Total seqs: 34611554.</span></span>
<span id="cb149-126"><a href="#cb149-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-127"><a href="#cb149-127" aria-hidden="true" tabindex="-1"></a><span class="in">Output File Names: </span></span>
<span id="cb149-128"><a href="#cb149-128" aria-hidden="true" tabindex="-1"></a><span class="in">final.opti_mcc.count.summary</span></span>
<span id="cb149-129"><a href="#cb149-129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-130"><a href="#cb149-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-131"><a href="#cb149-131" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prep Data for `microeco`</span></span>
<span id="cb149-132"><a href="#cb149-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-133"><a href="#cb149-133" aria-hidden="true" tabindex="-1"></a>Like any tool, the microeco package needs the data in a specific form. I formatted our data to match the mock data in the microeco tutorial, specifically <span class="co">[</span><span class="ot">this section</span><span class="co">](https://chiliubio.github.io/microeco_tutorial/basic-class.html#prepare-the-example-data)</span>.</span>
<span id="cb149-134"><a href="#cb149-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-135"><a href="#cb149-135" aria-hidden="true" tabindex="-1"></a><span class="fu">### A. Taxonomy Table</span></span>
<span id="cb149-136"><a href="#cb149-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-137"><a href="#cb149-137" aria-hidden="true" tabindex="-1"></a>Here is what the taxonomy table looks like in the mock data.</span>
<span id="cb149-138"><a href="#cb149-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-141"><a href="#cb149-141" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-142"><a href="#cb149-142" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-143"><a href="#cb149-143" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb149-144"><a href="#cb149-144" aria-hidden="true" tabindex="-1"></a><span class="fu">pandoc.table</span>(taxonomy_table_16S[<span class="dv">10</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">emphasize.rownames =</span> <span class="cn">FALSE</span>)</span>
<span id="cb149-145"><a href="#cb149-145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-146"><a href="#cb149-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-147"><a href="#cb149-147" aria-hidden="true" tabindex="-1"></a>Our taxonomy file (below) needs a little wrangling to be properly formatted. </span>
<span id="cb149-148"><a href="#cb149-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-151"><a href="#cb149-151" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-152"><a href="#cb149-152" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb149-153"><a href="#cb149-153" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-154"><a href="#cb149-154" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="fu">here</span>(work_here, <span class="st">"final.opti_mcc.0.03.cons.taxonomy"</span>), </span>
<span id="cb149-155"><a href="#cb149-155" aria-hidden="true" tabindex="-1"></a>                      <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb149-156"><a href="#cb149-156" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-157"><a href="#cb149-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-160"><a href="#cb149-160" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-161"><a href="#cb149-161" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-162"><a href="#cb149-162" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb149-163"><a href="#cb149-163" aria-hidden="true" tabindex="-1"></a><span class="co">#tax1 &lt;- tmp_tax</span></span>
<span id="cb149-164"><a href="#cb149-164" aria-hidden="true" tabindex="-1"></a><span class="fu">pandoc.table</span>(tax1[<span class="dv">11</span><span class="sc">:</span><span class="dv">13</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">emphasize.rownames =</span> <span class="cn">FALSE</span>, <span class="at">split.tables =</span> <span class="cn">Inf</span>)</span>
<span id="cb149-165"><a href="#cb149-165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-166"><a href="#cb149-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-167"><a href="#cb149-167" aria-hidden="true" tabindex="-1"></a>Some fancy string manipulation...</span>
<span id="cb149-168"><a href="#cb149-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-171"><a href="#cb149-171" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-172"><a href="#cb149-172" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb149-173"><a href="#cb149-173" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-174"><a href="#cb149-174" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sapply</span>(tmp_tax, </span>
<span id="cb149-175"><a href="#cb149-175" aria-hidden="true" tabindex="-1"></a>                             gsub, </span>
<span id="cb149-176"><a href="#cb149-176" aria-hidden="true" tabindex="-1"></a>                             <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">(</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">)"</span>, </span>
<span id="cb149-177"><a href="#cb149-177" aria-hidden="true" tabindex="-1"></a>                             <span class="at">replacement =</span> <span class="st">""</span>))</span>
<span id="cb149-178"><a href="#cb149-178" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sapply</span>(tmp_tax, </span>
<span id="cb149-179"><a href="#cb149-179" aria-hidden="true" tabindex="-1"></a>                             gsub, </span>
<span id="cb149-180"><a href="#cb149-180" aria-hidden="true" tabindex="-1"></a>                             <span class="at">pattern =</span> <span class="st">";$"</span>, </span>
<span id="cb149-181"><a href="#cb149-181" aria-hidden="true" tabindex="-1"></a>                             <span class="at">replacement =</span> <span class="st">""</span>))</span>
<span id="cb149-182"><a href="#cb149-182" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> <span class="fu">separate_wider_delim</span>(tmp_tax, </span>
<span id="cb149-183"><a href="#cb149-183" aria-hidden="true" tabindex="-1"></a>                              <span class="at">cols =</span> Taxonomy, </span>
<span id="cb149-184"><a href="#cb149-184" aria-hidden="true" tabindex="-1"></a>                              <span class="at">delim =</span> <span class="st">";"</span>, <span class="at">names =</span> <span class="fu">c</span>(</span>
<span id="cb149-185"><a href="#cb149-185" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Kingdom"</span>, <span class="st">"Phylum"</span>, </span>
<span id="cb149-186"><a href="#cb149-186" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Class"</span>, <span class="st">"Order"</span>, </span>
<span id="cb149-187"><a href="#cb149-187" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Family"</span>, <span class="st">"Genus"</span> </span>
<span id="cb149-188"><a href="#cb149-188" aria-hidden="true" tabindex="-1"></a>                                )</span>
<span id="cb149-189"><a href="#cb149-189" aria-hidden="true" tabindex="-1"></a>                              )</span>
<span id="cb149-190"><a href="#cb149-190" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sapply</span>(tmp_tax, gsub, </span>
<span id="cb149-191"><a href="#cb149-191" aria-hidden="true" tabindex="-1"></a>                           <span class="at">pattern =</span> <span class="st">"^.*_unclassified$"</span>, </span>
<span id="cb149-192"><a href="#cb149-192" aria-hidden="true" tabindex="-1"></a>                           <span class="at">replacement =</span> <span class="st">""</span>))</span>
<span id="cb149-193"><a href="#cb149-193" aria-hidden="true" tabindex="-1"></a>tmp_tax<span class="sc">$</span>Size <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb149-194"><a href="#cb149-194" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(tmp_tax, <span class="st">"OTU"</span>)</span>
<span id="cb149-195"><a href="#cb149-195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-196"><a href="#cb149-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-197"><a href="#cb149-197" aria-hidden="true" tabindex="-1"></a>And we get this ...</span>
<span id="cb149-198"><a href="#cb149-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-201"><a href="#cb149-201" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-202"><a href="#cb149-202" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-203"><a href="#cb149-203" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb149-204"><a href="#cb149-204" aria-hidden="true" tabindex="-1"></a><span class="co">#tax2 &lt;- tmp_tax</span></span>
<span id="cb149-205"><a href="#cb149-205" aria-hidden="true" tabindex="-1"></a><span class="fu">pandoc.table</span>(tax2[<span class="dv">11</span><span class="sc">:</span><span class="dv">13</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">emphasize.rownames =</span> <span class="cn">FALSE</span>, <span class="at">split.tables =</span> <span class="cn">Inf</span>)</span>
<span id="cb149-206"><a href="#cb149-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-207"><a href="#cb149-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-210"><a href="#cb149-210" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-211"><a href="#cb149-211" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb149-212"><a href="#cb149-212" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-213"><a href="#cb149-213" aria-hidden="true" tabindex="-1"></a>rank_prefixes <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb149-214"><a href="#cb149-214" aria-hidden="true" tabindex="-1"></a>  <span class="at">Kingdom =</span> <span class="st">"k"</span>, </span>
<span id="cb149-215"><a href="#cb149-215" aria-hidden="true" tabindex="-1"></a>  <span class="at">Phylum  =</span> <span class="st">"p"</span>, </span>
<span id="cb149-216"><a href="#cb149-216" aria-hidden="true" tabindex="-1"></a>  <span class="at">Class   =</span> <span class="st">"c"</span>, </span>
<span id="cb149-217"><a href="#cb149-217" aria-hidden="true" tabindex="-1"></a>  <span class="at">Order   =</span> <span class="st">"o"</span>, </span>
<span id="cb149-218"><a href="#cb149-218" aria-hidden="true" tabindex="-1"></a>  <span class="at">Family  =</span> <span class="st">"f"</span>, </span>
<span id="cb149-219"><a href="#cb149-219" aria-hidden="true" tabindex="-1"></a>  <span class="at">Genus   =</span> <span class="st">"g"</span></span>
<span id="cb149-220"><a href="#cb149-220" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb149-221"><a href="#cb149-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-222"><a href="#cb149-222" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> tmp_tax <span class="sc">%&gt;%</span></span>
<span id="cb149-223"><a href="#cb149-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">replace_na</span>(., <span class="st">""</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb149-224"><a href="#cb149-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">names</span>(rank_prefixes), </span>
<span id="cb149-225"><a href="#cb149-225" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span> <span class="fu">paste0</span>(rank_prefixes[<span class="fu">cur_column</span>()], <span class="st">"__"</span>, .))) <span class="sc">%&gt;%</span></span>
<span id="cb149-226"><a href="#cb149-226" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy_taxonomy</span>()</span>
<span id="cb149-227"><a href="#cb149-227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-228"><a href="#cb149-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-229"><a href="#cb149-229" aria-hidden="true" tabindex="-1"></a>And then this. Excatly like the mock data. </span>
<span id="cb149-230"><a href="#cb149-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-233"><a href="#cb149-233" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-234"><a href="#cb149-234" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-235"><a href="#cb149-235" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb149-236"><a href="#cb149-236" aria-hidden="true" tabindex="-1"></a><span class="co">#tax3 &lt;- tmp_tax</span></span>
<span id="cb149-237"><a href="#cb149-237" aria-hidden="true" tabindex="-1"></a><span class="fu">pandoc.table</span>(tax3[<span class="dv">11</span><span class="sc">:</span><span class="dv">13</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">emphasize.rownames =</span> <span class="cn">FALSE</span>, <span class="at">split.tables =</span> <span class="cn">Inf</span>)</span>
<span id="cb149-238"><a href="#cb149-238" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-239"><a href="#cb149-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-240"><a href="#cb149-240" aria-hidden="true" tabindex="-1"></a><span class="fu">### B. Sequence Table</span></span>
<span id="cb149-241"><a href="#cb149-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-242"><a href="#cb149-242" aria-hidden="true" tabindex="-1"></a>Here is what the sequence table looks like in the mock data.</span>
<span id="cb149-243"><a href="#cb149-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-244"><a href="#cb149-244" aria-hidden="true" tabindex="-1"></a>Here is what the sequence table looks like in the mock data.</span>
<span id="cb149-245"><a href="#cb149-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-248"><a href="#cb149-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-249"><a href="#cb149-249" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb149-250"><a href="#cb149-250" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-251"><a href="#cb149-251" aria-hidden="true" tabindex="-1"></a><span class="fu">pandoc.table</span>(otu_table_16S[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>], <span class="at">emphasize.rownames =</span> <span class="cn">FALSE</span>)</span>
<span id="cb149-252"><a href="#cb149-252" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-253"><a href="#cb149-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-254"><a href="#cb149-254" aria-hidden="true" tabindex="-1"></a>These code block will return a properly formatted sequence table. </span>
<span id="cb149-255"><a href="#cb149-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-258"><a href="#cb149-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-259"><a href="#cb149-259" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb149-260"><a href="#cb149-260" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-261"><a href="#cb149-261" aria-hidden="true" tabindex="-1"></a>tmp_st <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_delim</span>(</span>
<span id="cb149-262"><a href="#cb149-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">here</span>(work_here, <span class="st">"final.opti_mcc.shared"</span>),  <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb149-263"><a href="#cb149-263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-264"><a href="#cb149-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-267"><a href="#cb149-267" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-268"><a href="#cb149-268" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb149-269"><a href="#cb149-269" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-270"><a href="#cb149-270" aria-hidden="true" tabindex="-1"></a>tmp_st<span class="sc">$</span>numOtus <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb149-271"><a href="#cb149-271" aria-hidden="true" tabindex="-1"></a>tmp_st<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb149-272"><a href="#cb149-272" aria-hidden="true" tabindex="-1"></a>tmp_st <span class="ot">&lt;-</span> tmp_st <span class="sc">%&gt;%</span></span>
<span id="cb149-273"><a href="#cb149-273" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>), <span class="at">names_to =</span> <span class="st">"tmp"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb149-274"><a href="#cb149-274" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="fu">c</span>(<span class="dv">1</span>))</span>
<span id="cb149-275"><a href="#cb149-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-276"><a href="#cb149-276" aria-hidden="true" tabindex="-1"></a>tmp_st <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(tmp_st, <span class="st">"tmp"</span>)</span>
<span id="cb149-277"><a href="#cb149-277" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-278"><a href="#cb149-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-281"><a href="#cb149-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-282"><a href="#cb149-282" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb149-283"><a href="#cb149-283" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-284"><a href="#cb149-284" aria-hidden="true" tabindex="-1"></a><span class="co"># st &lt;- tmp_st</span></span>
<span id="cb149-285"><a href="#cb149-285" aria-hidden="true" tabindex="-1"></a><span class="fu">pandoc.table</span>(st[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">emphasize.rownames =</span> <span class="cn">FALSE</span>)</span>
<span id="cb149-286"><a href="#cb149-286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-287"><a href="#cb149-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-290"><a href="#cb149-290" aria-hidden="true" tabindex="-1"></a><span class="in">```{zsh}</span></span>
<span id="cb149-291"><a href="#cb149-291" aria-hidden="true" tabindex="-1"></a><span class="co"># only need to run this if reading in processed files</span></span>
<span id="cb149-292"><a href="#cb149-292" aria-hidden="true" tabindex="-1"></a><span class="co"># code adds a tab to the beginning of first line</span></span>
<span id="cb149-293"><a href="#cb149-293" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="st">'1s/^/\t/'</span> tmp_final.opti_mcc.fixed.shared <span class="op">&gt;</span> final.opti_mcc.fixed.shared</span>
<span id="cb149-294"><a href="#cb149-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-295"><a href="#cb149-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-296"><a href="#cb149-296" aria-hidden="true" tabindex="-1"></a><span class="fu">### C. Sample Table</span></span>
<span id="cb149-297"><a href="#cb149-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-300"><a href="#cb149-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-301"><a href="#cb149-301" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb149-302"><a href="#cb149-302" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-303"><a href="#cb149-303" aria-hidden="true" tabindex="-1"></a><span class="fu">pandoc.table</span>(sample_info_16S[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="at">emphasize.rownames =</span> <span class="cn">FALSE</span>, <span class="at">split.tables =</span> <span class="cn">Inf</span>)</span>
<span id="cb149-304"><a href="#cb149-304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-305"><a href="#cb149-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-306"><a href="#cb149-306" aria-hidden="true" tabindex="-1"></a>No problem. </span>
<span id="cb149-307"><a href="#cb149-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-310"><a href="#cb149-310" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-311"><a href="#cb149-311" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb149-312"><a href="#cb149-312" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-313"><a href="#cb149-313" aria-hidden="true" tabindex="-1"></a>samdf <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"working_files/ssu/sampledata"</span>, <span class="st">"sample_data.rds"</span>))</span>
<span id="cb149-314"><a href="#cb149-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-315"><a href="#cb149-315" aria-hidden="true" tabindex="-1"></a>samdf <span class="ot">&lt;-</span> samdf <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"SampleID"</span>)</span>
<span id="cb149-316"><a href="#cb149-316" aria-hidden="true" tabindex="-1"></a>samdf<span class="sc">$</span>SampleID <span class="ot">&lt;-</span> <span class="fu">rownames</span>(samdf)</span>
<span id="cb149-317"><a href="#cb149-317" aria-hidden="true" tabindex="-1"></a>samdf <span class="ot">&lt;-</span> samdf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">relocate</span>(SampleID)</span>
<span id="cb149-318"><a href="#cb149-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-319"><a href="#cb149-319" aria-hidden="true" tabindex="-1"></a>samdf <span class="ot">&lt;-</span> samdf <span class="sc">%&gt;%</span></span>
<span id="cb149-320"><a href="#cb149-320" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb149-321"><a href="#cb149-321" aria-hidden="true" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_starts</span>(SampleID, <span class="st">"Control"</span>, <span class="at">negate =</span> <span class="cn">TRUE</span>)</span>
<span id="cb149-322"><a href="#cb149-322" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb149-323"><a href="#cb149-323" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-324"><a href="#cb149-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-327"><a href="#cb149-327" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-328"><a href="#cb149-328" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb149-329"><a href="#cb149-329" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-330"><a href="#cb149-330" aria-hidden="true" tabindex="-1"></a><span class="fu">pandoc.table</span>(samdf[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="at">emphasize.rownames =</span> <span class="cn">FALSE</span>, <span class="at">split.tables =</span> <span class="cn">Inf</span>)</span>
<span id="cb149-331"><a href="#cb149-331" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-332"><a href="#cb149-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-333"><a href="#cb149-333" aria-hidden="true" tabindex="-1"></a><span class="fu">## Experiment-level Objects</span></span>
<span id="cb149-334"><a href="#cb149-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-335"><a href="#cb149-335" aria-hidden="true" tabindex="-1"></a>In the following section we create <span class="in">`microtable`</span> and <span class="in">`phyloseq`</span> objects. These are single, consolidated experiment-level data objects that organize various data types, such as OTU tables (taxa abundance), sample metadata, taxonomic classifications, as well as phylogenetic trees and reference sequences, into one structured format. This unified approach facilitates reproducible, interactive analysis and visualization by bringing all related information together. </span>
<span id="cb149-336"><a href="#cb149-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-337"><a href="#cb149-337" aria-hidden="true" tabindex="-1"></a>We begin by creating the <span class="in">`microtable`</span> and then use the function <span class="in">`meco2phyloseq`</span> from the <span class="co">[</span><span class="ot">file2meco</span><span class="co">](https://github.com/ChiLiubio/file2meco)</span> package to create the <span class="in">`phyloseq`</span> object. This way all of the underlying data is identical across the two objects. </span>
<span id="cb149-338"><a href="#cb149-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-339"><a href="#cb149-339" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb149-340"><a href="#cb149-340" aria-hidden="true" tabindex="-1"></a>These objects contain an OTU table (taxa abundances), sample metadata, and taxonomy table (mapping between OTUs and higher-level taxonomic classifications).</span>
<span id="cb149-341"><a href="#cb149-341" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb149-342"><a href="#cb149-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-345"><a href="#cb149-345" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-346"><a href="#cb149-346" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb149-347"><a href="#cb149-347" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-348"><a href="#cb149-348" aria-hidden="true" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> samdf</span>
<span id="cb149-349"><a href="#cb149-349" aria-hidden="true" tabindex="-1"></a>tax_tab <span class="ot">&lt;-</span> tmp_tax</span>
<span id="cb149-350"><a href="#cb149-350" aria-hidden="true" tabindex="-1"></a>otu_tab <span class="ot">&lt;-</span> tmp_st</span>
<span id="cb149-351"><a href="#cb149-351" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-352"><a href="#cb149-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-355"><a href="#cb149-355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-356"><a href="#cb149-356" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb149-357"><a href="#cb149-357" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-358"><a href="#cb149-358" aria-hidden="true" tabindex="-1"></a>tmp_me <span class="ot">&lt;-</span> microtable<span class="sc">$</span><span class="fu">new</span>(<span class="at">sample_table =</span> sample_info, </span>
<span id="cb149-359"><a href="#cb149-359" aria-hidden="true" tabindex="-1"></a>                         <span class="at">otu_table =</span> otu_tab, </span>
<span id="cb149-360"><a href="#cb149-360" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tax_table =</span> tax_tab)</span>
<span id="cb149-361"><a href="#cb149-361" aria-hidden="true" tabindex="-1"></a>tmp_me</span>
<span id="cb149-362"><a href="#cb149-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-363"><a href="#cb149-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-364"><a href="#cb149-364" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb149-365"><a href="#cb149-365" aria-hidden="true" tabindex="-1"></a><span class="in">microtable-class object:</span></span>
<span id="cb149-366"><a href="#cb149-366" aria-hidden="true" tabindex="-1"></a><span class="in">sample_table have 1849 rows and 13 columns</span></span>
<span id="cb149-367"><a href="#cb149-367" aria-hidden="true" tabindex="-1"></a><span class="in">otu_table have 119453 rows and 1849 columns</span></span>
<span id="cb149-368"><a href="#cb149-368" aria-hidden="true" tabindex="-1"></a><span class="in">tax_table have 119453 rows and 6 columns</span></span>
<span id="cb149-369"><a href="#cb149-369" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-370"><a href="#cb149-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-371"><a href="#cb149-371" aria-hidden="true" tabindex="-1"></a><span class="fu">### D. Add Representative Sequence</span></span>
<span id="cb149-372"><a href="#cb149-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-373"><a href="#cb149-373" aria-hidden="true" tabindex="-1"></a>We can also add representative sequences for each OTU/ASV. For this step, we use the mothur command <span class="in">`get.oturep`</span>. </span>
<span id="cb149-374"><a href="#cb149-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-377"><a href="#cb149-377" aria-hidden="true" tabindex="-1"></a><span class="in">```{verbatim}</span></span>
<span id="cb149-378"><a href="#cb149-378" aria-hidden="true" tabindex="-1"></a><span class="in">get.oturep(column=final.dist, list=final.opti_mcc.list, count=final.count_table, fasta=final.fasta)</span></span>
<span id="cb149-379"><a href="#cb149-379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-380"><a href="#cb149-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-381"><a href="#cb149-381" aria-hidden="true" tabindex="-1"></a>The fasta file it returns needs a little T.L.C.</span>
<span id="cb149-382"><a href="#cb149-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-383"><a href="#cb149-383" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-384"><a href="#cb149-384" aria-hidden="true" tabindex="-1"></a><span class="in">You did not provide a label, using 0.03.</span></span>
<span id="cb149-385"><a href="#cb149-385" aria-hidden="true" tabindex="-1"></a><span class="in">0.03    119453</span></span>
<span id="cb149-386"><a href="#cb149-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-387"><a href="#cb149-387" aria-hidden="true" tabindex="-1"></a><span class="in">Output File Names: </span></span>
<span id="cb149-388"><a href="#cb149-388" aria-hidden="true" tabindex="-1"></a><span class="in">final.opti_mcc.0.03.rep.count_table</span></span>
<span id="cb149-389"><a href="#cb149-389" aria-hidden="true" tabindex="-1"></a><span class="in">final.opti_mcc.0.03.rep.fasta</span></span>
<span id="cb149-390"><a href="#cb149-390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-391"><a href="#cb149-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-392"><a href="#cb149-392" aria-hidden="true" tabindex="-1"></a>For that we use a tool called SeqKit <span class="co">[</span><span class="ot">@shen2024seqkit2</span><span class="co">]</span> for fasta defline manipulation.</span>
<span id="cb149-393"><a href="#cb149-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-396"><a href="#cb149-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{zsh}</span></span>
<span id="cb149-397"><a href="#cb149-397" aria-hidden="true" tabindex="-1"></a><span class="ex">seqkit</span> replace <span class="at">-p</span> <span class="st">"\|.*"</span> <span class="at">-r</span> <span class="st">''</span> final.opti_mcc.0.03.rep.fasta <span class="op">&gt;</span> tmp2.fa</span>
<span id="cb149-398"><a href="#cb149-398" aria-hidden="true" tabindex="-1"></a><span class="ex">seqkit</span> replace <span class="at">-p</span> <span class="st">".*</span><span class="dt">\\</span><span class="st">t"</span> <span class="at">-r</span> <span class="st">''</span> tmp2.fa <span class="op">&gt;</span> tmp3.fa</span>
<span id="cb149-399"><a href="#cb149-399" aria-hidden="true" tabindex="-1"></a><span class="ex">seqkit</span> replace <span class="at">-p</span> <span class="st">"-"</span> <span class="at">-r</span> <span class="st">'$1'</span> <span class="at">-s</span> <span class="at">-w</span> 0 tmp3.fa <span class="op">&gt;</span> otu_reps.fasta</span>
<span id="cb149-400"><a href="#cb149-400" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> tmp<span class="pp">*</span></span>
<span id="cb149-401"><a href="#cb149-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-402"><a href="#cb149-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-405"><a href="#cb149-405" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-406"><a href="#cb149-406" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb149-407"><a href="#cb149-407" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-408"><a href="#cb149-408" aria-hidden="true" tabindex="-1"></a>rep_fasta <span class="ot">&lt;-</span> Biostrings<span class="sc">::</span><span class="fu">readDNAStringSet</span>(<span class="fu">here</span>(work_here, <span class="st">"otu_reps.fasta"</span>))</span>
<span id="cb149-409"><a href="#cb149-409" aria-hidden="true" tabindex="-1"></a>tmp_me<span class="sc">$</span>rep_fasta <span class="ot">&lt;-</span> rep_fasta</span>
<span id="cb149-410"><a href="#cb149-410" aria-hidden="true" tabindex="-1"></a>tmp_me<span class="sc">$</span><span class="fu">tidy_dataset</span>()</span>
<span id="cb149-411"><a href="#cb149-411" aria-hidden="true" tabindex="-1"></a>tmp_me</span>
<span id="cb149-412"><a href="#cb149-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-413"><a href="#cb149-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-414"><a href="#cb149-414" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-415"><a href="#cb149-415" aria-hidden="true" tabindex="-1"></a><span class="in">microtable-class object:</span></span>
<span id="cb149-416"><a href="#cb149-416" aria-hidden="true" tabindex="-1"></a><span class="in">sample_table have 1849 rows and 14 columns</span></span>
<span id="cb149-417"><a href="#cb149-417" aria-hidden="true" tabindex="-1"></a><span class="in">otu_table have 119453 rows and 1849 columns</span></span>
<span id="cb149-418"><a href="#cb149-418" aria-hidden="true" tabindex="-1"></a><span class="in">tax_table have 119453 rows and 6 columns</span></span>
<span id="cb149-419"><a href="#cb149-419" aria-hidden="true" tabindex="-1"></a><span class="in">rep_fasta have 119453 sequence</span></span>
<span id="cb149-420"><a href="#cb149-420" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-421"><a href="#cb149-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-424"><a href="#cb149-424" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-425"><a href="#cb149-425" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-426"><a href="#cb149-426" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-427"><a href="#cb149-427" aria-hidden="true" tabindex="-1"></a>me_raw <span class="ot">&lt;-</span> microeco<span class="sc">::</span><span class="fu">clone</span>(tmp_me)</span>
<span id="cb149-428"><a href="#cb149-428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-429"><a href="#cb149-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-430"><a href="#cb149-430" aria-hidden="true" tabindex="-1"></a><span class="fu">## Curate the Data Set</span></span>
<span id="cb149-431"><a href="#cb149-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-432"><a href="#cb149-432" aria-hidden="true" tabindex="-1"></a>Pretty much the last thing to do is remove  low-count samples.</span>
<span id="cb149-433"><a href="#cb149-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-434"><a href="#cb149-434" aria-hidden="true" tabindex="-1"></a><span class="fu">### Remove Low-Count Samples</span></span>
<span id="cb149-435"><a href="#cb149-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-438"><a href="#cb149-438" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-439"><a href="#cb149-439" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb149-440"><a href="#cb149-440" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-441"><a href="#cb149-441" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb149-442"><a href="#cb149-442" aria-hidden="true" tabindex="-1"></a>tmp_no_low <span class="ot">&lt;-</span> microeco<span class="sc">::</span><span class="fu">clone</span>(me_raw)</span>
<span id="cb149-443"><a href="#cb149-443" aria-hidden="true" tabindex="-1"></a>tmp_no_low<span class="sc">$</span>otu_table <span class="ot">&lt;-</span> me_raw<span class="sc">$</span>otu_table <span class="sc">%&gt;%</span></span>
<span id="cb149-444"><a href="#cb149-444" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="fu">is.numeric</span>(.) <span class="sc">&amp;&amp;</span> <span class="fu">sum</span>(.) <span class="sc">&gt;=</span> threshold))</span>
<span id="cb149-445"><a href="#cb149-445" aria-hidden="true" tabindex="-1"></a>tmp_no_low<span class="sc">$</span><span class="fu">tidy_dataset</span>()</span>
<span id="cb149-446"><a href="#cb149-446" aria-hidden="true" tabindex="-1"></a>tmp_no_low</span>
<span id="cb149-447"><a href="#cb149-447" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-448"><a href="#cb149-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-449"><a href="#cb149-449" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb149-450"><a href="#cb149-450" aria-hidden="true" tabindex="-1"></a><span class="in">41 taxa with 0 abundance are removed from the otu_table ...</span></span>
<span id="cb149-451"><a href="#cb149-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-452"><a href="#cb149-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-455"><a href="#cb149-455" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-456"><a href="#cb149-456" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-457"><a href="#cb149-457" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-458"><a href="#cb149-458" aria-hidden="true" tabindex="-1"></a>me_no_low <span class="ot">&lt;-</span> microeco<span class="sc">::</span><span class="fu">clone</span>(tmp_no_low)</span>
<span id="cb149-459"><a href="#cb149-459" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-460"><a href="#cb149-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-463"><a href="#cb149-463" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-464"><a href="#cb149-464" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-465"><a href="#cb149-465" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb149-466"><a href="#cb149-466" aria-hidden="true" tabindex="-1"></a>me_no_low</span>
<span id="cb149-467"><a href="#cb149-467" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-468"><a href="#cb149-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-471"><a href="#cb149-471" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-472"><a href="#cb149-472" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb149-473"><a href="#cb149-473" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-474"><a href="#cb149-474" aria-hidden="true" tabindex="-1"></a>me_final <span class="ot">&lt;-</span> microeco<span class="sc">::</span><span class="fu">clone</span>(tmp_no_low)</span>
<span id="cb149-475"><a href="#cb149-475" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-476"><a href="#cb149-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-477"><a href="#cb149-477" aria-hidden="true" tabindex="-1"></a>Lastly, we can use the package <span class="co">[</span><span class="ot">`file2meco`</span><span class="co">](https://github.com/ChiLiubio/file2meco)</span> to generate a <span class="co">[</span><span class="ot">phyloseq</span><span class="co">](https://joey711.github.io/phyloseq/)</span> object. </span>
<span id="cb149-478"><a href="#cb149-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-481"><a href="#cb149-481" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-482"><a href="#cb149-482" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb149-483"><a href="#cb149-483" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-484"><a href="#cb149-484" aria-hidden="true" tabindex="-1"></a>ps_final <span class="ot">&lt;-</span> file2meco<span class="sc">::</span><span class="fu">meco2phyloseq</span>(me_final)</span>
<span id="cb149-485"><a href="#cb149-485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-486"><a href="#cb149-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-487"><a href="#cb149-487" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb149-488"><a href="#cb149-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-489"><a href="#cb149-489" aria-hidden="true" tabindex="-1"></a>Now time to summarize the data. For this we use the R package <span class="co">[</span><span class="ot">miaverse</span><span class="co">](https://microbiome.github.io)</span> <span class="co">[</span><span class="ot">@felix2024mia</span><span class="co">]</span>.</span>
<span id="cb149-490"><a href="#cb149-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-493"><a href="#cb149-493" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-494"><a href="#cb149-494" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-495"><a href="#cb149-495" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-496"><a href="#cb149-496" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">rownames</span>(me_raw<span class="sc">$</span>sample_table), <span class="fu">colnames</span>(me_raw<span class="sc">$</span>otu_table))</span>
<span id="cb149-497"><a href="#cb149-497" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">rownames</span>(me_final<span class="sc">$</span>sample_table), <span class="fu">colnames</span>(me_final<span class="sc">$</span>otu_table))</span>
<span id="cb149-498"><a href="#cb149-498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-499"><a href="#cb149-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-502"><a href="#cb149-502" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-503"><a href="#cb149-503" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-504"><a href="#cb149-504" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-505"><a href="#cb149-505" aria-hidden="true" tabindex="-1"></a>objs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"me_raw"</span>, <span class="st">"me_final"</span>)</span>
<span id="cb149-506"><a href="#cb149-506" aria-hidden="true" tabindex="-1"></a>pipe_summary <span class="ot">&lt;-</span> <span class="fu">summarize_objs</span>(objs)</span>
<span id="cb149-507"><a href="#cb149-507" aria-hidden="true" tabindex="-1"></a>pipe_summary<span class="sc">$</span>me_dataset <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb149-508"><a href="#cb149-508" aria-hidden="true" tabindex="-1"></a>  <span class="st">"original"</span>, <span class="st">"final"</span>)</span>
<span id="cb149-509"><a href="#cb149-509" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pipe_summary)</span>
<span id="cb149-510"><a href="#cb149-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-511"><a href="#cb149-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-514"><a href="#cb149-514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-515"><a href="#cb149-515" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-516"><a href="#cb149-516" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb149-517"><a href="#cb149-517" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(pipe_summary)</span>
<span id="cb149-518"><a href="#cb149-518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-519"><a href="#cb149-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-522"><a href="#cb149-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-523"><a href="#cb149-523" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-524"><a href="#cb149-524" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-525"><a href="#cb149-525" aria-hidden="true" tabindex="-1"></a>tmp_raw_ps <span class="ot">&lt;-</span> file2meco<span class="sc">::</span><span class="fu">meco2phyloseq</span>(me_raw)</span>
<span id="cb149-526"><a href="#cb149-526" aria-hidden="true" tabindex="-1"></a>tmp_final_ps <span class="ot">&lt;-</span> file2meco<span class="sc">::</span><span class="fu">meco2phyloseq</span>(me_final)</span>
<span id="cb149-527"><a href="#cb149-527" aria-hidden="true" tabindex="-1"></a>tmp_mia_raw <span class="ot">&lt;-</span> <span class="fu">mia_metrics</span>(tmp_raw_ps)</span>
<span id="cb149-528"><a href="#cb149-528" aria-hidden="true" tabindex="-1"></a>tmp_mia_final <span class="ot">&lt;-</span> <span class="fu">mia_metrics</span>(tmp_final_ps)</span>
<span id="cb149-529"><a href="#cb149-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-530"><a href="#cb149-530" aria-hidden="true" tabindex="-1"></a>tmp_metrics_final <span class="ot">&lt;-</span> <span class="fu">rbind</span>(tmp_mia_raw, tmp_mia_final)</span>
<span id="cb149-531"><a href="#cb149-531" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(tmp_metrics_final) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Start"</span>, <span class="st">"End"</span>)</span>
<span id="cb149-532"><a href="#cb149-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-533"><a href="#cb149-533" aria-hidden="true" tabindex="-1"></a><span class="co"># suppose ds_metrics_final has rownames "Start" and "End"</span></span>
<span id="cb149-534"><a href="#cb149-534" aria-hidden="true" tabindex="-1"></a>ds_metrics_tbl <span class="ot">&lt;-</span> tmp_metrics_final <span class="sc">%&gt;%</span></span>
<span id="cb149-535"><a href="#cb149-535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span>                         <span class="co"># transpose: metrics in rows</span></span>
<span id="cb149-536"><a href="#cb149-536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb149-537"><a href="#cb149-537" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"Metric"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb149-538"><a href="#cb149-538" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Start =</span> Start, <span class="at">End =</span> End)</span>
<span id="cb149-539"><a href="#cb149-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-540"><a href="#cb149-540" aria-hidden="true" tabindex="-1"></a>ds_metrics_tbl <span class="ot">&lt;-</span> ds_metrics_tbl <span class="sc">%&gt;%</span></span>
<span id="cb149-541"><a href="#cb149-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb149-542"><a href="#cb149-542" aria-hidden="true" tabindex="-1"></a>    <span class="at">Start =</span> <span class="fu">ifelse</span>(Start <span class="sc">%%</span> <span class="dv">1</span> <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb149-543"><a href="#cb149-543" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">formatC</span>(Start, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">0</span>),</span>
<span id="cb149-544"><a href="#cb149-544" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">formatC</span>(Start, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">3</span>)),</span>
<span id="cb149-545"><a href="#cb149-545" aria-hidden="true" tabindex="-1"></a>    <span class="at">End   =</span> <span class="fu">ifelse</span>(End <span class="sc">%%</span> <span class="dv">1</span> <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb149-546"><a href="#cb149-546" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">formatC</span>(End, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">0</span>),</span>
<span id="cb149-547"><a href="#cb149-547" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">formatC</span>(End, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">3</span>))</span>
<span id="cb149-548"><a href="#cb149-548" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb149-549"><a href="#cb149-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-550"><a href="#cb149-550" aria-hidden="true" tabindex="-1"></a>ds_metrics_tbl<span class="sc">$</span>Metric <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb149-551"><a href="#cb149-551" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Min. no. of reads"</span>,</span>
<span id="cb149-552"><a href="#cb149-552" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Max. no. of reads"</span>,</span>
<span id="cb149-553"><a href="#cb149-553" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Total no. of reads"</span>,</span>
<span id="cb149-554"><a href="#cb149-554" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Avg. no. of reads"</span>,</span>
<span id="cb149-555"><a href="#cb149-555" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Median no. of reads"</span>,</span>
<span id="cb149-556"><a href="#cb149-556" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Total ASVs"</span>,</span>
<span id="cb149-557"><a href="#cb149-557" aria-hidden="true" tabindex="-1"></a>  <span class="st">"No. of singleton ASVs"</span>,</span>
<span id="cb149-558"><a href="#cb149-558" aria-hidden="true" tabindex="-1"></a>  <span class="st">"% of singleton ASVs"</span>,</span>
<span id="cb149-559"><a href="#cb149-559" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Sparsity"</span></span>
<span id="cb149-560"><a href="#cb149-560" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb149-561"><a href="#cb149-561" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-562"><a href="#cb149-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-565"><a href="#cb149-565" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-566"><a href="#cb149-566" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-567"><a href="#cb149-567" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb149-568"><a href="#cb149-568" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Dataset metrics before and after curation."</span></span>
<span id="cb149-569"><a href="#cb149-569" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(ds_metrics_tbl, <span class="at">format =</span> <span class="st">"markdown"</span>)</span>
<span id="cb149-570"><a href="#cb149-570" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-571"><a href="#cb149-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-572"><a href="#cb149-572" aria-hidden="true" tabindex="-1"></a>We started off with <span class="in">`r nrow(me_raw$tax_table)`</span> ASVs and <span class="in">`r nrow(me_raw$sample_table)`</span> samples. After removing low-count samples, there were <span class="in">`r nrow(me_final$tax_table)`</span> ASVs and <span class="in">`r nrow(me_final$sample_table)`</span> samples remaining.</span>
<span id="cb149-573"><a href="#cb149-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-576"><a href="#cb149-576" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-577"><a href="#cb149-577" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-578"><a href="#cb149-578" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-579"><a href="#cb149-579" aria-hidden="true" tabindex="-1"></a><span class="co"># helper functions</span></span>
<span id="cb149-580"><a href="#cb149-580" aria-hidden="true" tabindex="-1"></a>make_tables <span class="ot">&lt;-</span> <span class="cf">function</span>(obj, prefix) {</span>
<span id="cb149-581"><a href="#cb149-581" aria-hidden="true" tabindex="-1"></a>  rc <span class="ot">&lt;-</span> obj<span class="sc">$</span><span class="fu">sample_sums</span>() <span class="sc">%&gt;%</span></span>
<span id="cb149-582"><a href="#cb149-582" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb149-583"><a href="#cb149-583" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"SampleID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb149-584"><a href="#cb149-584" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="sc">!!</span><span class="fu">paste0</span>(prefix, <span class="st">"_rc"</span>) <span class="sc">:</span><span class="er">=</span> <span class="dv">2</span>)</span>
<span id="cb149-585"><a href="#cb149-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-586"><a href="#cb149-586" aria-hidden="true" tabindex="-1"></a>  asv <span class="ot">&lt;-</span> obj<span class="sc">$</span>otu_table <span class="sc">%&gt;%</span></span>
<span id="cb149-587"><a href="#cb149-587" aria-hidden="true" tabindex="-1"></a>    <span class="fu">t</span>() <span class="sc">%&gt;%</span></span>
<span id="cb149-588"><a href="#cb149-588" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb149-589"><a href="#cb149-589" aria-hidden="true" tabindex="-1"></a>    { <span class="fu">rowSums</span>(. <span class="sc">&gt;</span> <span class="dv">0</span>) } <span class="sc">%&gt;%</span></span>
<span id="cb149-590"><a href="#cb149-590" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb149-591"><a href="#cb149-591" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"SampleID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb149-592"><a href="#cb149-592" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="sc">!!</span><span class="fu">paste0</span>(prefix, <span class="st">"_otu"</span>) <span class="sc">:</span><span class="er">=</span> <span class="dv">2</span>)</span>
<span id="cb149-593"><a href="#cb149-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-594"><a href="#cb149-594" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">rc =</span> rc, <span class="at">asv =</span> asv)</span>
<span id="cb149-595"><a href="#cb149-595" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb149-596"><a href="#cb149-596" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-597"><a href="#cb149-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-600"><a href="#cb149-600" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-601"><a href="#cb149-601" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-602"><a href="#cb149-602" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-603"><a href="#cb149-603" aria-hidden="true" tabindex="-1"></a><span class="co">#tmp_start &lt;- microeco::clone(me_raw)</span></span>
<span id="cb149-604"><a href="#cb149-604" aria-hidden="true" tabindex="-1"></a><span class="co">#tmp_final &lt;- microeco::clone(me_final)</span></span>
<span id="cb149-605"><a href="#cb149-605" aria-hidden="true" tabindex="-1"></a><span class="co"># --- input rc file ---</span></span>
<span id="cb149-606"><a href="#cb149-606" aria-hidden="true" tabindex="-1"></a>tmp_rc <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_delim</span>(<span class="fu">here</span>(work_here, <span class="st">"mothur_pipeline_read_changes.txt"</span>)) </span>
<span id="cb149-607"><a href="#cb149-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-608"><a href="#cb149-608" aria-hidden="true" tabindex="-1"></a><span class="co"># --- generate tables ---</span></span>
<span id="cb149-609"><a href="#cb149-609" aria-hidden="true" tabindex="-1"></a>start_tbls <span class="ot">&lt;-</span> <span class="fu">make_tables</span>(microeco<span class="sc">::</span><span class="fu">clone</span>(me_raw), <span class="st">"start"</span>)</span>
<span id="cb149-610"><a href="#cb149-610" aria-hidden="true" tabindex="-1"></a>final_tbls <span class="ot">&lt;-</span> <span class="fu">make_tables</span>(microeco<span class="sc">::</span><span class="fu">clone</span>(me_final), <span class="st">"final"</span>)</span>
<span id="cb149-611"><a href="#cb149-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-612"><a href="#cb149-612" aria-hidden="true" tabindex="-1"></a><span class="co"># --- summary ---</span></span>
<span id="cb149-613"><a href="#cb149-613" aria-hidden="true" tabindex="-1"></a>curate_summary <span class="ot">&lt;-</span> tmp_rc <span class="sc">%&gt;%</span></span>
<span id="cb149-614"><a href="#cb149-614" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">full_join</span>(start_tbls<span class="sc">$</span>rc,  <span class="at">by =</span> <span class="st">"SampleID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb149-615"><a href="#cb149-615" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(start_tbls<span class="sc">$</span>asv, <span class="at">by =</span> <span class="st">"SampleID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb149-616"><a href="#cb149-616" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(final_tbls<span class="sc">$</span>rc,  <span class="at">by =</span> <span class="st">"SampleID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb149-617"><a href="#cb149-617" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(final_tbls<span class="sc">$</span>asv, <span class="at">by =</span> <span class="st">"SampleID"</span>)</span>
<span id="cb149-618"><a href="#cb149-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-619"><a href="#cb149-619" aria-hidden="true" tabindex="-1"></a>removed_samples <span class="ot">&lt;-</span> curate_summary <span class="sc">%&gt;%</span></span>
<span id="cb149-620"><a href="#cb149-620" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">is.na</span>(final_rc)) <span class="sc">%&gt;%</span></span>
<span id="cb149-621"><a href="#cb149-621" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(SampleID)</span>
<span id="cb149-622"><a href="#cb149-622" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-623"><a href="#cb149-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-624"><a href="#cb149-624" aria-hidden="true" tabindex="-1"></a>We lost a total of <span class="in">`r length(removed_samples)`</span> samples after curating the dataset. This includes <span class="in">`r length(removed_samples[grepl("^Control_", removed_samples)])`</span> NC samples and <span class="in">`r length(removed_samples[!grepl("^Control_", removed_samples)])`</span> non-NC samples.</span>
<span id="cb149-625"><a href="#cb149-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-626"><a href="#cb149-626" aria-hidden="true" tabindex="-1"></a>Here is a list of non-NC samples that were removed. </span>
<span id="cb149-627"><a href="#cb149-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-630"><a href="#cb149-630" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-631"><a href="#cb149-631" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb149-632"><a href="#cb149-632" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-633"><a href="#cb149-633" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb149-634"><a href="#cb149-634" aria-hidden="true" tabindex="-1"></a>removed_samples[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"^Control_"</span>, removed_samples)]</span>
<span id="cb149-635"><a href="#cb149-635" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-636"><a href="#cb149-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-637"><a href="#cb149-637" aria-hidden="true" tabindex="-1"></a><span class="fu"># Download Results {#download-results}</span></span>
<span id="cb149-638"><a href="#cb149-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-639"><a href="#cb149-639" aria-hidden="true" tabindex="-1"></a>Quick access to read changes through the pipeline and repseqs detected in negative control samples.</span>
<span id="cb149-640"><a href="#cb149-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-641"><a href="#cb149-641" aria-hidden="true" tabindex="-1"></a>::: {#otu-listing .column-body}</span>
<span id="cb149-642"><a href="#cb149-642" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb149-643"><a href="#cb149-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-644"><a href="#cb149-644" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!------------------------------------------------------------------------&gt;</span></span>
<span id="cb149-645"><a href="#cb149-645" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-------------------- Use this area to save things ----------------------&gt;</span></span>
<span id="cb149-646"><a href="#cb149-646" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!------------------------------------------------------------------------&gt;</span></span>
<span id="cb149-647"><a href="#cb149-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-648"><a href="#cb149-648" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!---------------------------------------&gt;</span></span>
<span id="cb149-649"><a href="#cb149-649" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- These chunks are for curated data --&gt;</span></span>
<span id="cb149-650"><a href="#cb149-650" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!---------------------------------------&gt;</span></span>
<span id="cb149-653"><a href="#cb149-653" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-654"><a href="#cb149-654" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-655"><a href="#cb149-655" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-656"><a href="#cb149-656" aria-hidden="true" tabindex="-1"></a>workflow_name <span class="ot">&lt;-</span> <span class="st">"otu"</span></span>
<span id="cb149-657"><a href="#cb149-657" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">here</span>(share_here, <span class="fu">paste0</span>(workflow_name, <span class="st">"_curated_data"</span>)), </span>
<span id="cb149-658"><a href="#cb149-658" aria-hidden="true" tabindex="-1"></a>           <span class="at">recursive =</span> <span class="cn">FALSE</span>, <span class="at">showWarnings =</span> <span class="cn">TRUE</span>)</span>
<span id="cb149-659"><a href="#cb149-659" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-660"><a href="#cb149-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-663"><a href="#cb149-663" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-664"><a href="#cb149-664" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-665"><a href="#cb149-665" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-666"><a href="#cb149-666" aria-hidden="true" tabindex="-1"></a>tmp_path <span class="ot">&lt;-</span> <span class="fu">here</span>(share_here, <span class="fu">paste0</span>(workflow_name, <span class="st">"_curated_data/"</span>))</span>
<span id="cb149-667"><a href="#cb149-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-668"><a href="#cb149-668" aria-hidden="true" tabindex="-1"></a>files <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb149-669"><a href="#cb149-669" aria-hidden="true" tabindex="-1"></a>  <span class="at">otu =</span> <span class="fu">paste0</span>(workflow_name, <span class="st">"_otu_table.txt"</span>),</span>
<span id="cb149-670"><a href="#cb149-670" aria-hidden="true" tabindex="-1"></a>  <span class="at">tax =</span> <span class="fu">paste0</span>(workflow_name, <span class="st">"_tax_table.txt"</span>),</span>
<span id="cb149-671"><a href="#cb149-671" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample =</span> <span class="fu">paste0</span>(workflow_name, <span class="st">"_sample_table.txt"</span>),</span>
<span id="cb149-672"><a href="#cb149-672" aria-hidden="true" tabindex="-1"></a>  <span class="at">rep =</span> <span class="fu">paste0</span>(workflow_name, <span class="st">"_rep.fasta"</span>),</span>
<span id="cb149-673"><a href="#cb149-673" aria-hidden="true" tabindex="-1"></a>  <span class="at">me =</span> <span class="fu">paste0</span>(<span class="st">"me_"</span>, workflow_name, <span class="st">".rds"</span>),</span>
<span id="cb149-674"><a href="#cb149-674" aria-hidden="true" tabindex="-1"></a>  <span class="at">ps =</span> <span class="fu">paste0</span>(<span class="st">"ps_"</span>, workflow_name, <span class="st">".rds"</span>),</span>
<span id="cb149-675"><a href="#cb149-675" aria-hidden="true" tabindex="-1"></a>  <span class="at">counts =</span> <span class="fu">paste0</span>(workflow_name, <span class="st">"_track_read_counts.txt"</span>)</span>
<span id="cb149-676"><a href="#cb149-676" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb149-677"><a href="#cb149-677" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-678"><a href="#cb149-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-681"><a href="#cb149-681" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-682"><a href="#cb149-682" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-683"><a href="#cb149-683" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-684"><a href="#cb149-684" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------OTU Table--------------#</span></span>
<span id="cb149-685"><a href="#cb149-685" aria-hidden="true" tabindex="-1"></a>tmp_otu <span class="ot">&lt;-</span> me_final<span class="sc">$</span>otu_table <span class="sc">%&gt;%</span> </span>
<span id="cb149-686"><a href="#cb149-686" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="fu">paste0</span>(<span class="fu">toupper</span>(workflow_name), <span class="st">"_ID"</span>))</span>
<span id="cb149-687"><a href="#cb149-687" aria-hidden="true" tabindex="-1"></a><span class="fu">write_delim</span>(tmp_otu, <span class="fu">paste0</span>(tmp_path, files<span class="sc">$</span>otu), <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb149-688"><a href="#cb149-688" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------TAX Table--------------#</span></span>
<span id="cb149-689"><a href="#cb149-689" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> me_final<span class="sc">$</span>tax_table <span class="sc">%&gt;%</span> </span>
<span id="cb149-690"><a href="#cb149-690" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="fu">paste0</span>(<span class="fu">toupper</span>(workflow_name), <span class="st">"_ID"</span>))</span>
<span id="cb149-691"><a href="#cb149-691" aria-hidden="true" tabindex="-1"></a><span class="fu">write_delim</span>(tmp_tax, <span class="fu">paste0</span>(tmp_path, files<span class="sc">$</span>tax), <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb149-692"><a href="#cb149-692" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------SAMP Table--------------#</span></span>
<span id="cb149-693"><a href="#cb149-693" aria-hidden="true" tabindex="-1"></a><span class="fu">write_delim</span>(me_final<span class="sc">$</span>sample_table, <span class="fu">paste0</span>(tmp_path, files<span class="sc">$</span>sample), <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb149-694"><a href="#cb149-694" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------REP FASTA--------------#</span></span>
<span id="cb149-695"><a href="#cb149-695" aria-hidden="true" tabindex="-1"></a><span class="fu">write.fasta</span>(</span>
<span id="cb149-696"><a href="#cb149-696" aria-hidden="true" tabindex="-1"></a>  <span class="at">sequences =</span> <span class="fu">as.list</span>(<span class="fu">as.character</span>(me_final<span class="sc">$</span>rep_fasta)),</span>
<span id="cb149-697"><a href="#cb149-697" aria-hidden="true" tabindex="-1"></a>  <span class="at">names =</span> <span class="fu">names</span>(me_final<span class="sc">$</span>rep_fasta),</span>
<span id="cb149-698"><a href="#cb149-698" aria-hidden="true" tabindex="-1"></a>  <span class="at">file.out =</span> <span class="fu">paste0</span>(tmp_path, files<span class="sc">$</span>rep)</span>
<span id="cb149-699"><a href="#cb149-699" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb149-700"><a href="#cb149-700" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------        --------------#</span></span>
<span id="cb149-701"><a href="#cb149-701" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(me_final, <span class="fu">paste0</span>(tmp_path, files<span class="sc">$</span>me))</span>
<span id="cb149-702"><a href="#cb149-702" aria-hidden="true" tabindex="-1"></a>ps_final <span class="ot">&lt;-</span> file2meco<span class="sc">::</span><span class="fu">meco2phyloseq</span>(me_final)</span>
<span id="cb149-703"><a href="#cb149-703" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(ps_final, <span class="fu">paste0</span>(tmp_path, files<span class="sc">$</span>ps))</span>
<span id="cb149-704"><a href="#cb149-704" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------read count changes--------------#</span></span>
<span id="cb149-705"><a href="#cb149-705" aria-hidden="true" tabindex="-1"></a><span class="fu">write_delim</span>(curate_summary, <span class="fu">paste0</span>(tmp_path, files<span class="sc">$</span>counts), <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb149-706"><a href="#cb149-706" aria-hidden="true" tabindex="-1"></a><span class="fu">file.copy</span>(<span class="fu">here</span>(<span class="st">"working_files/ssu/sampledata"</span>,  <span class="st">"all_metadata.txt"</span>), </span>
<span id="cb149-707"><a href="#cb149-707" aria-hidden="true" tabindex="-1"></a>          tmp_path, </span>
<span id="cb149-708"><a href="#cb149-708" aria-hidden="true" tabindex="-1"></a>          <span class="at">overwrite =</span> <span class="cn">TRUE</span>, <span class="at">recursive =</span> <span class="cn">FALSE</span>, </span>
<span id="cb149-709"><a href="#cb149-709" aria-hidden="true" tabindex="-1"></a>          <span class="at">copy.mode =</span> <span class="cn">TRUE</span>, <span class="at">copy.date =</span> <span class="cn">FALSE</span>)</span>
<span id="cb149-710"><a href="#cb149-710" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-711"><a href="#cb149-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-714"><a href="#cb149-714" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-715"><a href="#cb149-715" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-716"><a href="#cb149-716" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-717"><a href="#cb149-717" aria-hidden="true" tabindex="-1"></a>zip<span class="sc">::</span><span class="fu">zip</span>(<span class="at">zipfile =</span> <span class="fu">here</span>(share_here, <span class="fu">paste0</span>(workflow_name, <span class="st">"_curated_data.zip"</span>)), </span>
<span id="cb149-718"><a href="#cb149-718" aria-hidden="true" tabindex="-1"></a>         <span class="at">files =</span> <span class="fu">here</span>(share_here, <span class="fu">paste0</span>(workflow_name,<span class="st">"_curated_data"</span>)), </span>
<span id="cb149-719"><a href="#cb149-719" aria-hidden="true" tabindex="-1"></a>         <span class="at">mode =</span> <span class="st">"cherry-pick"</span>)</span>
<span id="cb149-720"><a href="#cb149-720" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-721"><a href="#cb149-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-722"><a href="#cb149-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-725"><a href="#cb149-725" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-726"><a href="#cb149-726" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-727"><a href="#cb149-727" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-728"><a href="#cb149-728" aria-hidden="true" tabindex="-1"></a><span class="fu">file.copy</span>(<span class="fu">here</span>(work_here,  <span class="st">"mothur_pipeline_read_changes.txt"</span>), </span>
<span id="cb149-729"><a href="#cb149-729" aria-hidden="true" tabindex="-1"></a>          <span class="fu">here</span>(share_here), </span>
<span id="cb149-730"><a href="#cb149-730" aria-hidden="true" tabindex="-1"></a>          <span class="at">overwrite =</span> <span class="cn">TRUE</span>, <span class="at">recursive =</span> <span class="cn">FALSE</span>, </span>
<span id="cb149-731"><a href="#cb149-731" aria-hidden="true" tabindex="-1"></a>          <span class="at">copy.mode =</span> <span class="cn">TRUE</span>, <span class="at">copy.date =</span> <span class="cn">FALSE</span>)</span>
<span id="cb149-732"><a href="#cb149-732" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-733"><a href="#cb149-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-734"><a href="#cb149-734" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--------------------------------------------&gt;</span></span>
<span id="cb149-735"><a href="#cb149-735" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- These chunks are for  processing data  --&gt;</span></span>
<span id="cb149-736"><a href="#cb149-736" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--------------------------------------------&gt;</span></span>
<span id="cb149-737"><a href="#cb149-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-740"><a href="#cb149-740" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-741"><a href="#cb149-741" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-742"><a href="#cb149-742" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-743"><a href="#cb149-743" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">here</span>(share_here, <span class="fu">paste0</span>(workflow_name, <span class="st">"_processing"</span>)), </span>
<span id="cb149-744"><a href="#cb149-744" aria-hidden="true" tabindex="-1"></a>           <span class="at">recursive =</span> <span class="cn">FALSE</span>, <span class="at">showWarnings =</span> <span class="cn">TRUE</span>)</span>
<span id="cb149-745"><a href="#cb149-745" aria-hidden="true" tabindex="-1"></a>copy_here <span class="ot">&lt;-</span> <span class="fu">here</span>(share_here, <span class="fu">paste0</span>(workflow_name, <span class="st">"_processing/"</span>))</span>
<span id="cb149-746"><a href="#cb149-746" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-747"><a href="#cb149-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-750"><a href="#cb149-750" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-751"><a href="#cb149-751" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-752"><a href="#cb149-752" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-753"><a href="#cb149-753" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: from sampledata (these data are common to all 16S wf)</span></span>
<span id="cb149-754"><a href="#cb149-754" aria-hidden="true" tabindex="-1"></a>tmp_sampdata_path <span class="ot">&lt;-</span> <span class="st">"working_files/ssu/sampledata"</span></span>
<span id="cb149-755"><a href="#cb149-755" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">dir_copy</span>(<span class="at">path =</span> <span class="fu">here</span>(tmp_sampdata_path,  <span class="st">"fastq_rename_results/"</span>), </span>
<span id="cb149-756"><a href="#cb149-756" aria-hidden="true" tabindex="-1"></a>             <span class="at">new_path =</span> <span class="fu">here</span>(copy_here,  <span class="st">"fastq_rename_results/"</span>), </span>
<span id="cb149-757"><a href="#cb149-757" aria-hidden="true" tabindex="-1"></a>             <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb149-758"><a href="#cb149-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-759"><a href="#cb149-759" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">dir_copy</span>(<span class="at">path =</span> <span class="fu">here</span>(tmp_sampdata_path,  <span class="st">"fastq_rename_lookup/"</span>), </span>
<span id="cb149-760"><a href="#cb149-760" aria-hidden="true" tabindex="-1"></a>             <span class="at">new_path =</span> <span class="fu">here</span>(copy_here,  <span class="st">"fastq_rename_lookup/"</span>), </span>
<span id="cb149-761"><a href="#cb149-761" aria-hidden="true" tabindex="-1"></a>             <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb149-762"><a href="#cb149-762" aria-hidden="true" tabindex="-1"></a><span class="fu">file.copy</span>(<span class="fu">here</span>(tmp_sampdata_path,  <span class="st">"rename.sh"</span>), </span>
<span id="cb149-763"><a href="#cb149-763" aria-hidden="true" tabindex="-1"></a>          <span class="fu">here</span>(copy_here), </span>
<span id="cb149-764"><a href="#cb149-764" aria-hidden="true" tabindex="-1"></a>          <span class="at">overwrite =</span> <span class="cn">TRUE</span>, <span class="at">recursive =</span> <span class="cn">FALSE</span>, </span>
<span id="cb149-765"><a href="#cb149-765" aria-hidden="true" tabindex="-1"></a>          <span class="at">copy.mode =</span> <span class="cn">TRUE</span>, <span class="at">copy.date =</span> <span class="cn">FALSE</span>)</span>
<span id="cb149-766"><a href="#cb149-766" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-767"><a href="#cb149-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-768"><a href="#cb149-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-771"><a href="#cb149-771" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-772"><a href="#cb149-772" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-773"><a href="#cb149-773" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-774"><a href="#cb149-774" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">dir_copy</span>(<span class="at">path =</span> <span class="fu">here</span>(work_here,  <span class="fu">paste0</span>(workflow_name, <span class="st">"_hydra_scripts/"</span>)), </span>
<span id="cb149-775"><a href="#cb149-775" aria-hidden="true" tabindex="-1"></a>             <span class="at">new_path =</span> <span class="fu">here</span>(copy_here,  <span class="fu">paste0</span>(workflow_name, <span class="st">"_hydra_scripts/"</span>)), </span>
<span id="cb149-776"><a href="#cb149-776" aria-hidden="true" tabindex="-1"></a>             <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb149-777"><a href="#cb149-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-778"><a href="#cb149-778" aria-hidden="true" tabindex="-1"></a><span class="fu">file.copy</span>(<span class="fu">here</span>(work_here,  <span class="fu">paste0</span>(workflow_name, <span class="st">"_batchfile_processing/"</span>)), </span>
<span id="cb149-779"><a href="#cb149-779" aria-hidden="true" tabindex="-1"></a>          copy_here, </span>
<span id="cb149-780"><a href="#cb149-780" aria-hidden="true" tabindex="-1"></a>          <span class="at">overwrite =</span> <span class="cn">TRUE</span>, <span class="at">recursive =</span> <span class="cn">FALSE</span>, </span>
<span id="cb149-781"><a href="#cb149-781" aria-hidden="true" tabindex="-1"></a>          <span class="at">copy.mode =</span> <span class="cn">TRUE</span>, <span class="at">copy.date =</span> <span class="cn">FALSE</span>)</span>
<span id="cb149-782"><a href="#cb149-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-783"><a href="#cb149-783" aria-hidden="true" tabindex="-1"></a><span class="fu">file.copy</span>(<span class="fu">here</span>(share_here,  <span class="st">"mothur_pipeline_read_changes.txt"</span>), </span>
<span id="cb149-784"><a href="#cb149-784" aria-hidden="true" tabindex="-1"></a>          <span class="fu">here</span>(copy_here), </span>
<span id="cb149-785"><a href="#cb149-785" aria-hidden="true" tabindex="-1"></a>          <span class="at">overwrite =</span> <span class="cn">TRUE</span>, <span class="at">recursive =</span> <span class="cn">FALSE</span>, </span>
<span id="cb149-786"><a href="#cb149-786" aria-hidden="true" tabindex="-1"></a>          <span class="at">copy.mode =</span> <span class="cn">TRUE</span>, <span class="at">copy.date =</span> <span class="cn">FALSE</span>)</span>
<span id="cb149-787"><a href="#cb149-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-788"><a href="#cb149-788" aria-hidden="true" tabindex="-1"></a><span class="fu">file.copy</span>(<span class="fu">here</span>(tmp_sampdata_path,  <span class="st">"all_metadata.txt"</span>), </span>
<span id="cb149-789"><a href="#cb149-789" aria-hidden="true" tabindex="-1"></a>          <span class="fu">here</span>(copy_here), </span>
<span id="cb149-790"><a href="#cb149-790" aria-hidden="true" tabindex="-1"></a>          <span class="at">overwrite =</span> <span class="cn">TRUE</span>, <span class="at">recursive =</span> <span class="cn">FALSE</span>, </span>
<span id="cb149-791"><a href="#cb149-791" aria-hidden="true" tabindex="-1"></a>          <span class="at">copy.mode =</span> <span class="cn">TRUE</span>, <span class="at">copy.date =</span> <span class="cn">FALSE</span>)</span>
<span id="cb149-792"><a href="#cb149-792" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-793"><a href="#cb149-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-796"><a href="#cb149-796" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-797"><a href="#cb149-797" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-798"><a href="#cb149-798" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-799"><a href="#cb149-799" aria-hidden="true" tabindex="-1"></a>zip<span class="sc">::</span><span class="fu">zip</span>(<span class="at">zipfile =</span> <span class="fu">here</span>(share_here, <span class="fu">paste0</span>(workflow_name, <span class="st">"_processing.zip"</span>)), </span>
<span id="cb149-800"><a href="#cb149-800" aria-hidden="true" tabindex="-1"></a>         <span class="at">files =</span> <span class="fu">here</span>(share_here, <span class="fu">paste0</span>(workflow_name,<span class="st">"_processing"</span>)), </span>
<span id="cb149-801"><a href="#cb149-801" aria-hidden="true" tabindex="-1"></a>         <span class="at">mode =</span> <span class="st">"cherry-pick"</span>)</span>
<span id="cb149-802"><a href="#cb149-802" aria-hidden="true" tabindex="-1"></a><span class="fu">dir_delete</span>(<span class="fu">here</span>(share_here, <span class="fu">paste0</span>(workflow_name,<span class="st">"_processing"</span>)))</span>
<span id="cb149-803"><a href="#cb149-803" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-804"><a href="#cb149-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-807"><a href="#cb149-807" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-808"><a href="#cb149-808" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-809"><a href="#cb149-809" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb149-810"><a href="#cb149-810" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb149-811"><a href="#cb149-811" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb149-812"><a href="#cb149-812" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: save R script</span></span>
<span id="cb149-813"><a href="#cb149-813" aria-hidden="true" tabindex="-1"></a>workflow_name <span class="ot">&lt;-</span> <span class="st">"otu"</span></span>
<span id="cb149-814"><a href="#cb149-814" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">knitr.duplicate.label =</span> <span class="st">"allow"</span>)</span>
<span id="cb149-815"><a href="#cb149-815" aria-hidden="true" tabindex="-1"></a><span class="co"># Define sources and numbered outputs</span></span>
<span id="cb149-816"><a href="#cb149-816" aria-hidden="true" tabindex="-1"></a>sources <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb149-817"><a href="#cb149-817" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/_OTU_Part1.qmd"</span>,</span>
<span id="cb149-818"><a href="#cb149-818" aria-hidden="true" tabindex="-1"></a>  <span class="st">"index.qmd"</span></span>
<span id="cb149-819"><a href="#cb149-819" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb149-820"><a href="#cb149-820" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate corresponding temporary output files</span></span>
<span id="cb149-821"><a href="#cb149-821" aria-hidden="true" tabindex="-1"></a>tmp_outputs <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"share/ssu"</span>, <span class="fu">paste0</span>(workflow_name, <span class="st">"_workflow"</span>, <span class="fu">seq_along</span>(sources), <span class="st">".R"</span>))</span>
<span id="cb149-822"><a href="#cb149-822" aria-hidden="true" tabindex="-1"></a><span class="co"># Final combined output</span></span>
<span id="cb149-823"><a href="#cb149-823" aria-hidden="true" tabindex="-1"></a>final_output <span class="ot">&lt;-</span> <span class="fu">here</span>(share_here, <span class="fu">paste0</span>(workflow_name, <span class="st">"_workflow.R"</span>))</span>
<span id="cb149-824"><a href="#cb149-824" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Extract code from qmd to temporary R scripts</span></span>
<span id="cb149-825"><a href="#cb149-825" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">walk2</span>(sources, tmp_outputs, <span class="sc">~</span></span>
<span id="cb149-826"><a href="#cb149-826" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">purl</span>(.x, <span class="at">output =</span> .y, <span class="at">documentation =</span> <span class="dv">0</span>)</span>
<span id="cb149-827"><a href="#cb149-827" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb149-828"><a href="#cb149-828" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Concatenate all temporary R scripts into one, with separators</span></span>
<span id="cb149-829"><a href="#cb149-829" aria-hidden="true" tabindex="-1"></a><span class="fu">sink</span>(final_output)</span>
<span id="cb149-830"><a href="#cb149-830" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">walk2</span>(tmp_outputs, <span class="fu">seq_along</span>(tmp_outputs), <span class="sc">~</span>{</span>
<span id="cb149-831"><a href="#cb149-831" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">readLines</span>(.x), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb149-832"><a href="#cb149-832" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>,</span>
<span id="cb149-833"><a href="#cb149-833" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"# -------------------- END OF SCRIPT "</span>, .y, <span class="st">" --------------------</span><span class="sc">\n\n</span><span class="st">"</span>),</span>
<span id="cb149-834"><a href="#cb149-834" aria-hidden="true" tabindex="-1"></a>      <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb149-835"><a href="#cb149-835" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb149-836"><a href="#cb149-836" aria-hidden="true" tabindex="-1"></a><span class="fu">sink</span>()</span>
<span id="cb149-837"><a href="#cb149-837" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Clean up temporary files</span></span>
<span id="cb149-838"><a href="#cb149-838" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(tmp_outputs)</span>
<span id="cb149-839"><a href="#cb149-839" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-840"><a href="#cb149-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-843"><a href="#cb149-843" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb149-844"><a href="#cb149-844" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb149-845"><a href="#cb149-845" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb149-846"><a href="#cb149-846" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span>
<span id="cb149-847"><a href="#cb149-847" aria-hidden="true" tabindex="-1"></a>gdata<span class="sc">::</span><span class="fu">keep</span>(me_final, me_no_low, me_raw, curate_summary, </span>
<span id="cb149-848"><a href="#cb149-848" aria-hidden="true" tabindex="-1"></a>            ds_metrics_tbl, pipe_summary, removed_samples, </span>
<span id="cb149-849"><a href="#cb149-849" aria-hidden="true" tabindex="-1"></a>            samdf, st, tax1, tax2, tax3,</span>
<span id="cb149-850"><a href="#cb149-850" aria-hidden="true" tabindex="-1"></a>            <span class="at">sure =</span> <span class="cn">TRUE</span>)</span>
<span id="cb149-851"><a href="#cb149-851" aria-hidden="true" tabindex="-1"></a><span class="fu">save.image</span>(<span class="fu">here</span>(<span class="st">"page_build"</span>, <span class="st">"otu_part2.rdata"</span>))</span>
<span id="cb149-852"><a href="#cb149-852" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb149-853"><a href="#cb149-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-854"><a href="#cb149-854" aria-hidden="true" tabindex="-1"></a><span class="fu">#### References {.appendix}</span></span>
<span id="cb149-855"><a href="#cb149-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-856"><a href="#cb149-856" aria-hidden="true" tabindex="-1"></a>::: {#refs}</span>
<span id="cb149-857"><a href="#cb149-857" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb149-858"><a href="#cb149-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-859"><a href="#cb149-859" aria-hidden="true" tabindex="-1"></a>{{&lt; include /include/_footer.qmd &gt;}}</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Site constructed using <a href="https://quarto.org/">Quarto</a>.</p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
    <a class="nav-link" href="../../../site_info.html">
<p>Site Information</p>
</a>
  </li>  
</ul>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/istmobiome/trans-shrimp/blob/main/workflows/ssu/otu/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/istmobiome/trans-shrimp/edit/main/workflows/ssu/otu/index.qmd" target="_blank" class="toc-action"><i class="bi empty"></i>Edit this page</a></li><li><a href="https://github.com/istmobiome/trans-shrimp/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>© Copyright 2025 <a href="https://metacrobe.github.io/">metacrobe</a> &amp; <a href="https://istmobiome.rbind.io/">The Istmobiome Project</a>.</p>
</div>
  </div>
</footer>


</body></html>