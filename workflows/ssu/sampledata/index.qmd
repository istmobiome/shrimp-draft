---
title: "1. Sample Metadata"
description: |
  Workflow for wrangling sample metadata and generating informative sample names.
listing: 
    id: sd-listing
    contents: data-sd.yml
    type: table
    sort-ui: false
    filter-ui: false
    fields: 
      - filename
      - description
    field-links: 
      - filename
    field-display-names: 
      filename: File Name
      description: Description
---

{{< include /include/_setup.qmd >}}

```{r}
#| echo: false
#| eval: true
#| message: false 
#| results: hide
#| comment: set wd for here
remove(list = ls())
load(here("page_build", "ssu_sampledata.rdata"))
workflow_name <- "sampledata" # e.g., med, dada2, etc
work_here <- paste0("working_files/ssu/", workflow_name)
share_here <- paste0("share/ssu/", workflow_name)
```

## Workflow Input

::: {.callout-note icon=false}
## Data & Scripts

The table below contains links to files and scripts needed to run this workflow--specifically the `sampledata_processing.zip` archive which contains the necessary assets. Also included are the sample data tables generated at the end of the pipeline.
:::

::: {#sd-listing .column-body}
:::


## Overview

This workflow is designed to process our raw metadata files and generate more informative sample names. Our aim is to standardize metadata entries, generate new sample names, and save sample data frames that are used in downstream analyses. 

## Curate Metadata

The first step in to load all metadata files (one for each sequencing run) and combine the files. 

```{r}
#| echo: false
#| eval: false
#| comment: "for interactive testing"
project_root <- quarto::find_project_root()
# Construct the full path to your functions script
sampdata_path <- file.path(project_root, "working_files/ssu/sampledata")
```

```{r}
#| echo: true
#| eval: false
file_paths <- list.files(path = paste0(here(work_here, "/metadata_files")), 
                         pattern = "\\.csv$", full.names = TRUE)
tmp_meta <- vroom::vroom(file_paths)
colnames(tmp_meta)[1] <- "Original_name"
```

Next we remove any duplicate entries. We have duplicates because some samples were sequenced more than once due to low read count from the initial run. 

```{r}
#| echo: true
#| eval: false
dups_in_md <- tmp_meta[duplicated(tmp_meta[,1:1]),]
tmp_meta <- tmp_meta[!duplicated(tmp_meta[,1:1]),]
```

Next we remove several samples due to low initial read count. We pulled these out before doing any renaming, processing, etc. so they are only listed in the metadata files.

```{r}
#| echo: true
#| eval: false
#### Regex Code for partial matches
tmp_lc_samp <- c("7512", "8978-S", "8978-H", "7640-S")
tmp_meta <- tmp_meta[!grepl(paste(tmp_lc_samp, collapse = "|"), 
                            tmp_meta$Original_name), ]
```

And finally do a little maintenance on column names. What we are after here is standardized column names without spaces, periods, dashes, etc.  

```{r}
#| echo: true
#| eval: false
colnames(tmp_meta) <- gsub("-| |\\.+", "_", colnames(tmp_meta))
colnames(tmp_meta)[12] <- "Species_pair"
colnames(tmp_meta) <- gsub("_Original", "", colnames(tmp_meta))
```

Once this is finished we can go ahead and select columns in the metadata that are most important for downstream analysis. 

```{r}
#| echo: true
#| eval: false
tmp_meta <- tmp_meta %>% 
  dplyr::relocate(c("Ocean", "Morphospecies", "Tissue", 
                    "Habitat", "Site", "Site_2", "Taxon", 
                    "Length", "Station_no", "Species_pair", 
                    "Species_group", "Species_complex", 
                    "Plate", "Row", "Column"), 
                  .after = "Original_name")
tmp_meta[17:ncol(tmp_meta)] <- NULL
```

At this point we need to standardize some of the values in the metadata categories. This includes things like replacing spaces with underscores (`_`). The goal here is to eliminate anything that may cause issues later in the workflows. 

```{r}
#| echo: true
#| eval: false
tmp_meta <- tmp_meta %>%
  # Fix specific replacements
  mutate(
    Ocean = str_replace_all(Ocean, c(
      "Pacific" = "Eastern_Pacific",
      "Western Atlantic" = "Western_Atlantic"
    )),
    Taxon = str_replace_all(Taxon, "Snapping shrimp", "Snapping_shrimp")
  ) %>%
  
  # Normalize text by replacing spaces/dots in multiple columns
  mutate(
    Morphospecies = str_replace_all(Morphospecies, " +", "_"),
    Species_pair  = str_replace_all(Species_pair, c(
      "\\. +" = "_",
      " / "   = "-",
      " +"    = "_"
    )),
    Species_group   = str_replace_all(Species_group, c("\\. " = "_", " " = "_")),
    Species_complex = str_replace_all(Species_complex, "\\. ", "_"),
    Habitat   = str_replace_all(Habitat, " +", "_"),
    Site      = str_replace_all(Site, " +", "_"),
    Site_2    = str_replace_all(Site_2, " +", "_"),
    Plate     = str_replace_all(Plate, " ", "_")
  ) %>%
  
  # Map multiple Taxon values to "Environmental"
  mutate(
    Taxon = str_replace_all(Taxon, c(
      "Rubble"   = "Environmental", 
      "Sediment" = "Environmental", 
      "Mud"      = "Environmental",
      "Water"    = "Environmental"
    ))
  )

# Replace NA in Morphospecies with "Environmental"
tmp_meta <- tmp_meta %>%
  mutate(Morphospecies = replace_na(Morphospecies, "Environmental"))
```

## Sample Shortcodes

Next we want to create more meaningful sample names. For this we generate some *shortcodes* that capture key information about each sample, specifically:

- the sampling ocean
- the species name
- the tissue type

These we will combine with the unique individual ID number to get the new name. 

For example, something like `EP_A_HEBE_GL_8937` is the gill tissue (**GL**) from an *Alpheus hebes* (**A-HEBE**), individual ID **8937**, collected in the Eastern Pacific (**EP**). 

We use a similar convention for environmental samples, but instead of species name, we use `E_SAMP` to delineate environmental samples. For example, `WA_E_SAMP_WT_3075` is a water sample (**WT**) collected from the Western Atlantic (**WA**), unique id **3075**.

```{r}
#| echo: true
#| eval: false
#| code-fold: true
#| code-summary: "Click to see the the shortcodes for each variable."
#| comment: "list (old = new)"
tmp_ocean <- c(
  "Control" = "CON",
  "Eastern_Pacific" = "EP",
  "Western_Atlantic" = "WA"
)

tmp_tissue <- c(
  "Control" = "CON", 
  "Egg" = "EG", 
  "Gill" = "GL", 
  "Hepatopancreas" = "HP", 
  "Midgut" = "MG", 
  "Stomach" = "ST", 
  "Mud" = "MD", 
  "Rubble" = "RB", 
  "Sediment" = "SD", 
  "Water" = "WT"
)

tmp_species <- c(
  "Control" = "CON", 
  "Alpheus_arenensis" = "A_AREN", 
  "Alpheus_bahamensis" = "A_BAHA", 
  "Alpheus_bouvieri" = "A_BOUV", 
  "Alpheus_cristulifrons" = "A_CRIS", 
  "Alpheus_fasciatus" = "A_FASC", 
  "Alpheus_floridanus" = "A_FLOR", 
  "Alpheus_formosus" = "A_FORM", 
  "Alpheus_galapagensis" = "A_GALA", 
  "Alpheus_hebes" = "A_HEBE", 
  "Alpheus_hephaestus" = "A_HEPH", 
  "Alpheus_hyeyoungae" = "A_HYEY", 
  "Alpheus_javieri" = "A_JAVI", 
  "Alpheus_millsae" = "A_MILL", 
  "Alpheus_nuttingi" = "A_NUTT", 
  "Alpheus_panamensis" = "A_PANA", 
  "Alpheus_paracrinitus_no_spot" = "A_PCNS", 
  "Alpheus_paracrinitus_with_spot" = "A_PCWS", 
  "Alpheus_paraformosus" = "A_PARA", 
  "Alpheus_platycheirus" = "A_PLAT", 
  "Alpheus_rostratus" = "A_ROST", 
  "Alpheus_saxidomus" = "A_SAXI", 
  "Alpheus_simus" = "A_SIMU", 
  "Alpheus_thomasi" = "A_THOM", 
  "Alpheus_umbo" = "A_UMBO", 
  "Alpheus_utriensis" = "A_UTRI", 
  "Alpheus_verrilli" = "A_VERR", 
  "Alpheus_websteri" = "A_WEBS", 
  "Environmental" = "E_SAMP", 
  "Unknown" = "UNKN"
)
```

With these shortcodes in hand we can match each original sample names (from the fastq file names) to the shortcodes. 

```{r}
#| echo: true
#| eval: false
tmp_shortcode <- tmp_meta
tmp_shortcode <- tmp_shortcode %>% select(1:4, 8)

tmp_shortcode <- tmp_shortcode %>%
  mutate(
    Ocean_code   = Ocean,
    Species_code = Morphospecies,
    Tissue_code  = Tissue
  )

tmp_shortcode <- tmp_shortcode %>%
  mutate(
    Ocean_code   = str_replace_all(Ocean, tmp_ocean),
    Species_code = str_replace_all(Morphospecies, tmp_species),
    Tissue_code  = str_replace_all(Tissue, tmp_tissue)
  )
tmp_shortcode$Ocean_code <- tmp_shortcode$Ocean
tmp_shortcode <- tmp_shortcode %>%
  mutate(Ocean_code = str_replace_all(Ocean_code, tmp_ocean)) 

tmp_shortcode$Species_code <- tmp_shortcode$Morphospecies
tmp_shortcode <- tmp_shortcode %>%
  mutate(Species_code = str_replace_all(Species_code, tmp_species)) 

tmp_shortcode$Tissue_code <- tmp_shortcode$Tissue
tmp_shortcode <- tmp_shortcode %>%
  mutate(Tissue_code = str_replace_all(Tissue_code, tmp_tissue)) 

tmp_shortcode[2:4] <- NULL

tmp_shortcode <- tmp_shortcode %>% 
  dplyr::relocate("Taxon", .after = "Tissue_code")
```

```{r}
#| echo: false
#| eval: false
head_short <- head(tmp_shortcode)
```

```{r}
#| eval: true
#| echo: false
pandoc.table(head_short, emphasize.rownames = FALSE)
```

Still with me? Even though we have the pieces in place to standardize the sample names, we cannot do that yet because  different sample types have different initial naming conventions. For examples, Control samples are named like `Control-1`, `Control-2`, etc., while the snapping shrimp are named like `7322-M`, `7322-H`, etc. Environmental samples have totally different names, for example `Machete_scrap2`, `ML2670`, etc. This makes it a litle difficult to parse out meaningful information (specifically ID numbers) from the original sample names and apply our short codes to generate the new names. 

When we generated the short codes above we also included a column called `Taxon`. These data tell us whether a the entry is a snapping shrimp, a control, or an environmental sample. 

```{r}
#| echo: true
#| eval: false
unique(tmp_shortcode$Taxon)
```

```
[1] "Snapping_shrimp" "Control"  "Environmental"  
```

We can use the base R command `split` to separate the dataset based on the `Taxon` type so that we can process each category separately. 

```{r}
#| echo: true
#| eval: false
tmp_split_dfs <- split(tmp_shortcode, tmp_shortcode$Taxon)
```

Generating three separate data frames. 

```
tmp_split_dfs$Control

tmp_split_dfs$Environmental

tmp_split_dfs$Snapping_shrimp
```

### Control samples

```{r}
#| echo: true
#| eval: false
tmp_control <- tmp_split_dfs$Control
tmp_control$tmp <- tmp_control$Original_name

tmp_control <- tmp_control %>%
  separate_wider_delim(tmp, delim = "-", names = c("tmp1", "ID"))
tmp_control$tmp1 <- NULL
```

### Environmental samples

```{r}
#| echo: true
#| eval: false
tmp_envr <- tmp_split_dfs$Environmental
tmp_envr$tmp <- tmp_envr$Original_name

tmp_envr <- tmp_envr %>%
  separate_wider_delim(tmp,
                       delim = stringr::regex("(_)|(ML)"),
                       too_few = "align_start",
                       names_sep = "",
                       names_repair = ~ sub("value", "X", .x))

tmp_envr$tmp2 <- str_replace(tmp_envr$tmp2, "(\\d+).*", "\\1")
tmp_envr$tmp2 <- str_replace(tmp_envr$tmp2, "Sed", "sed")
tmp_envr$tmp1 <- NULL
tmp_envr <- tmp_envr %>% dplyr::rename(ID = tmp2)
```

### Shrimp samples

```{r}
#| echo: true
#| eval: false
tmp_shrmp <- tmp_split_dfs$Snapping_shrimp

tmp_shrmp$tmp <- tmp_shrmp$Original_name
tmp_shrmp %>%
  filter(Original_name == "7332-H-M")
tmp_shrmp$tmp <- gsub("7332-H-M", "7332M-H", tmp_shrmp$tmp)

tmp_shrmp <- tmp_shrmp %>%
  separate_wider_delim(tmp,
                       delim = "-",
                       names = c("tmp1", "tmp2")
                       )
tmp_shrmp %>%
  filter(Original_name == "7332-H-M")
tmp_shrmp$tmp2 <- NULL
tmp_shrmp <- tmp_shrmp %>% dplyr::rename(ID = tmp1)
```

Sweet. At this point we can generate the new unique name for each sample based on the criteria listed above. 

```{r}
#| echo: true
#| eval: false
tmp_control$SampleID <- tmp_control$Original_name
tmp_control$SampleID <- gsub("-", "_", tmp_control$SampleID)

tmp_envr <- tmp_envr %>%
  mutate(SampleID = paste(Ocean_code, 
                          Species_code, 
                          Tissue_code, 
                          ID, 
                          sep = "_"))
tmp_shrmp <- tmp_shrmp %>%
  mutate(SampleID = paste(Ocean_code, 
                          Species_code, 
                          Tissue_code, 
                          ID, 
                          sep = "_"))
```

And combine the three modified data frames. 

```{r}
#| echo: true
#| eval: false
tmp_combo <- rbind(tmp_control, tmp_envr, tmp_shrmp)
tmp_combo$Taxon <- NULL
shortcodes <- tmp_combo
```

And generate a modified metadata file containing the new sample ID plus the original and modified fastq file names. We have a four column tab delimited text file called `fastq_info.txt` that contains the original sample names, the run ID, plus the original	forward and reverse fastq file names.

```{r}
#| echo: true
#| eval: false
tmp_combo[2:5] <- NULL
tmp_fastq <- read_delim(here(work_here, "fastq_info.txt"))

all_metadata <- dplyr::left_join(tmp_meta, tmp_combo, by = "Original_name") %>%
  dplyr::left_join(., tmp_fastq, by = "Original_name")

all_metadata <- all_metadata %>% dplyr::relocate("SampleID", 
                                         .before = "Original_name")
all_metadata <- all_metadata %>% 
  dplyr::relocate("Run", .before = "Plate")

all_metadata <- all_metadata %>%
  mutate(Fastq_ID_forward_rename = paste0(SampleID, "_R1.fastq.gz")) %>%
  relocate(Fastq_ID_forward_rename, .after = Fastq_ID_forward_original) %>%
  mutate(Fastq_ID_reverse_rename = paste0(SampleID, "_R2.fastq.gz")) %>%
  relocate(Fastq_ID_reverse_rename, .after = Fastq_ID_reverse_original)
```

## Modified Metadata

And here is the modified metadata. 

::: {.callout-note appearance="simple" collapse="true"}

### Expand to column descriptions for sample table

| Header                      | Description                                            |
|-----------------------------|----------------------------------------------|
| `SampleID`                  | Sample ID based on Ocean, species, tissue, & unique ID |
| `Original_name`             | Original sample ID                                     |
| `Ocean`                     | Sampling ocean                                         |
| `Morphospecies`             | Host shrimp species                                    |
| `Tissue`                    | Shrimp tissue type                                     |
| `Habitat`                   | Sampling habitat                                       |
| `Site`                      | Sampling Site 1                                        |
| `Site_2`                    | Sampling Site 2                                        |
| `Taxon`                     | Shrimp, environmental samples, or Controls             |
| `Length`                    | Length of individual                                   |
| `Station_no`                | ASK MATT                                               |
| `Species_pair`              | ASK MATT                                               |
| `Species_group`             | ASK MATT                                               |
| `Species_complex`           | ASK MATT                                               |
| `Run`                       | Sequencing run ID                                      |
| `Plate`                     | Sequencing plate ID                                    |
| `Row`                       | Sequencing plate row number                            |
| `Column`                    | Sequencing plate column number                         |
| `Fastq_ID_forward_original` | Original fastq ID (F)                                  |
| `Fastq_ID_forward_rename`   | New fastq ID (F)                                       |
| `Fastq_ID_reverse_original` | Original fastq ID (R)                                  |
| `Fastq_ID_reverse_rename`   | New fastq ID (R)                                       |

:::


We sequenced a total of `r nrow(all_metadata)` samples, including `r nrow(all_metadata %>% filter(str_detect(Taxon, 'Snapping_shrimp')))` shrimp samples, `r nrow(all_metadata %>% filter(str_detect(Taxon, 'Environmental')))` environmental samples, and `r nrow(all_metadata %>% filter(str_detect(Taxon, 'Control')))` control samples. `r nrow(filter(all_metadata, Ocean == "Eastern_Pacific"))` total samples came from the Eastern Pacific and `r nrow(filter(all_metadata, Ocean == "Western_Atlantic"))` from the Western Atlantic.

## Rename FastQ Files

Using the modified metadata, specifically the new sample names, we can rename all fastq file prior to processing the data. To batch rename samples we created tab-delimited *lookup tables*, where the first column contains the original name of each fastq file while the second column corresponds to the new name. We did this for each sequencing run. Here is an example of the first few samples from the lookup table for run BCS_34, which we call `BCS_34.rename.txt`

```         
8937-G_R1_001.trimmed.fastq EP_A_HEBE_GL_8937_R1_001.trimmed.fastq
8937-H_R1_001.trimmed.fastq EP_A_HEBE_HP_8937_R1_001.trimmed.fastq
8937-M_R1_001.trimmed.fastq EP_A_HEBE_MG_8937_R1_001.trimmed.fastq
8937-S_R1_001.trimmed.fastq EP_A_HEBE_ST_8937_R1_001.trimmed.fastq
```

We use the new metadata file and the base R command `split` to generate initial lookup tables for each of the six sequencing runs. 

```{r}
#| echo: true
#| eval: false
tmp_split_dfs <- all_metadata
tmp_split_dfs <- tmp_split_dfs %>% 
  dplyr::select(Run, 
                Fastq_ID_forward_original, 
                Fastq_ID_forward_rename, 
                Fastq_ID_reverse_original, 
                Fastq_ID_reverse_rename)
split_dfs <- split(tmp_split_dfs, tmp_split_dfs$Run)
```

Again, a partial example from run BCS_34. 

```{r}
#| echo: false
#| eval: false
head_split_dfs <- split_dfs$BCS_34[1:3, 1:3]
```

```{r}
#| echo: false
#| eval: true
pandoc.table(head_split_dfs, emphasize.rownames = FALSE)
```

Finally, a little wrangling and then save each lookup table. 

```{r}
#| eval: false
#| echo: true
for (i in split_dfs) {
  tmp_ds <- data.frame(i)
  tmp_name <- as.character(i[1,1])
  
  tmp_runF <- tmp_ds %>% 
    dplyr::select(Run, 
                  Fastq_ID_forward_original, 
                  Fastq_ID_forward_rename)
  tmp_runF$Run <- NULL
  tmp_runF <- tmp_runF %>% dplyr::rename("X1" = 1, "X2" = 2)
  
  tmp_runR <- tmp_ds %>% 
    dplyr::select(Run,
                  Fastq_ID_reverse_original, 
                  Fastq_ID_reverse_rename)
  tmp_runR$Run <- NULL
  tmp_runR <- tmp_runR %>% dplyr::rename("X1" = 1, "X2" = 2)
  
  tmp_run <- rbind(tmp_runF, tmp_runR)
  assign(tmp_name, tmp_run)  
  write.table(
    tmp_run, 
    paste(here(share_here, "fastq_rename_lookup", tmp_name), 
          ".rename.txt", sep = ""), 
    sep = "\t", 
    quote = FALSE, 
    row.names = FALSE, 
    col.names = FALSE)
  rm(list = ls(pattern = "tmp_"))
}
```

Once we have lookup tables, we can run the bash script called `rename.sh`. This code will take the lookup table and go through each `fastq` file in the run directory and assign the new name. It will also output a timestamped rename results file showing the name changes. The script is run like so: 

```{bash}
#| echo: true
#| eval: false
bash rename.sh /path/to/files/ rename_file.txt [--dry-run]
```

Pass the script a path to the fatsq files and a lookup table. If you just want to see what changes will be made without actually making the changes you can include the flag `--dry-run`. Here is an example from this dataset:

```{bash}
#| echo: true
#| eval: false
bash rename.sh 01_TRIMMED_DATA/BCS_34_Istmo_S1-2_trimmed/ BCS_34.rename.txt
```

And you should see something like this in the results file: 

```
8937-G_R1_001.trimmed.fastq.gz -> EP_A_HEBE_GL_8937_R1.fastq.gz
8937-H_R1_001.trimmed.fastq.gz -> EP_A_HEBE_HP_8937_R1.fastq.gz
8937-M_R1_001.trimmed.fastq.gz -> EP_A_HEBE_MG_8937_R1.fastq.gz
8937-S_R1_001.trimmed.fastq.gz -> EP_A_HEBE_ST_8937_R1.fastq.gz
8938-G_R1_001.trimmed.fastq.gz -> EP_A_HEBE_GL_8938_R1.fastq.gz
8938-H_R1_001.trimmed.fastq.gz -> EP_A_HEBE_HP_8938_R1.fastq.gz
```

## Save Sample Data

The last thing to do is define a sample data frame that contains only the most relevant metadata. This table will be used in all downstream analyses to define samples. 

```{r}
#| echo: true
#| eval: false
tmp_shortcodes <- shortcodes[order(shortcodes$SampleID), ]
tmp_metadata <- all_metadata[order(all_metadata$SampleID), ]
identical(tmp_shortcodes$SampleID, tmp_metadata$SampleID)

samptab <- dplyr::left_join(tmp_metadata, tmp_shortcodes, 
                            by = c("SampleID", "Original_name"))
```

```{r}
#| echo: true
#| eval: false
sample_df <- samptab %>%
  dplyr::select(
    SampleID = SampleID,
    OCEAN    = Ocean_code,
    SPECIES  = Species_code,
    TISSUE   = Tissue_code,
    ID       = ID,
    SITE     = Site,
    SITE2    = Site_2,
    HABITAT  = Habitat,
    TAXON    = Taxon,
    PAIR     = Species_pair,
    GROUP    = Species_group,
    COMPLEX  = Species_complex,
    RUN      = Run,
    PLATE    = Plate
  )
```



Moving on. 

<!------------------------------------------------------------------------>
<!-------------------- Use this area to save things ---------------------->
<!------------------------------------------------------------------------>

<!--------------------------------------->
<!-- These chunks are for curated data -->
<!--------------------------------------->

```{r}
#| echo: false
#| eval: false
write_delim(all_metadata, here(work_here, "all_metadata.txt"), delim = "\t")
write_delim(sample_df, here(work_here, "sample_data.txt"), delim = "\t")
saveRDS(sample_df, here(work_here, "sample_data.rds"))
```


```{r}
#| echo: false
#| eval: false
file.copy(here(work_here,  "all_metadata.txt"), 
          here(share_here), 
          overwrite = TRUE, recursive = FALSE, 
          copy.mode = TRUE, copy.date = FALSE)
file.copy(here(work_here,  "sample_data.rds"), 
          here(share_here), 
          overwrite = TRUE, recursive = FALSE, 
          copy.mode = TRUE, copy.date = FALSE)
file.copy(here(work_here,  "sample_data.txt"), 
          here(share_here), 
          overwrite = TRUE, recursive = FALSE, 
          copy.mode = TRUE, copy.date = FALSE)
```

<!-------------------------------------------->
<!-- These chunks are for  processing data  -->
<!-------------------------------------------->

```{r}
#| echo: false
#| eval: false
workflow_name <- "sampledata"
work_here
dir.create(here(share_here, paste0(workflow_name, "_processing")), 
           recursive = FALSE, showWarnings = TRUE)

tmp_processing <- here(share_here, paste0(workflow_name, "_processing/"))

fs::dir_copy(path = here(work_here,  "metadata_files/"), 
             new_path = here(paste0(tmp_processing, "metadata_files/")), 
             overwrite = TRUE)

file.copy(here(work_here,  "fastq_info.txt"), 
          here(tmp_processing), 
          overwrite = TRUE, recursive = FALSE, 
          copy.mode = TRUE, copy.date = FALSE)

fs::dir_copy(path = here(work_here,  "fastq_rename_lookup/"), 
             new_path = here(paste0(tmp_processing, "fastq_rename_lookup/")), 
             overwrite = TRUE)

file.copy(here(work_here,  "rename.sh"), 
          here(tmp_processing), 
          overwrite = TRUE, recursive = FALSE, 
          copy.mode = TRUE, copy.date = FALSE)
```

```{r}
#| echo: false
#| eval: false
zip::zip(zipfile = here(share_here, paste0(workflow_name, "_processing.zip")), 
         files = here(share_here,  paste0(workflow_name, "_processing")), 
         mode = "cherry-pick")
dir_delete(here(share_here, paste0(workflow_name, "_processing")))
```


```{r}
#| echo: false
#| eval: false
objects()
gdata::keep(all_metadata, 
            BCS_26, BCS_28, BCS_29, 
            BCS_30, BCS_34, BCS_35,  
            dups_in_md, shortcodes,
            head_short, head_split_dfs, 
            sample_df, samptab, 
            sure = TRUE)
save.image(here("page_build", "ssu_sampledata.rdata"))
```

{{< include /include/_footer.qmd >}}
